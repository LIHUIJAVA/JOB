<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.px.mis.whs.dao.InvtyTabMapper">
    <!-- 保质期预警 -->
    <resultMap id="BaseResultMap" type="InvtyTab"
               autoMapping="true">
        <id column="ordr_num" property="ordrNum"/>
        <result column="whs_encd" property="whsEncd"/>
        <association property="invtyDoc"
                     javaType="com.px.mis.purc.entity.InvtyDoc" autoMapping="true">
            <id property="invtyEncd" column="invty_encd"/>
            <result property="invtyNm" column="invty_nm"/>
            <result property="measrCorpNm" column="measr_corp_nm"/>
            <result property="Stat" column="Stat"/>
        </association>
        <association property="whsDoc" javaType="whsDoc"
                     autoMapping="true">
            <id column="whs_encd" property="whsEncd"/>
            <result column="ordr_num" property="ordrNum"/>
            <result column="whs_nm" property="whsNm"/>
        </association>
    </resultMap>
    <!-- 收发存汇总 -->
    <resultMap id="TSummary" type="InvtyTab" autoMapping="true">
        <id column="ordr_num" property="ordrNum"/>
        <result column="whs_encd" property="whsEncd"/>
    </resultMap>
    <!-- 现存量查询 -->
    <resultMap id="ExtantQty" type="InvtyTab" autoMapping="true">
        <id column="ordr_num" property="ordrNum"/>
        <result column="whs_encd" property="whsEncd"/>
    </resultMap>
    <!-- 出入库流水 -->
    <resultMap id="OutIngWater" type="InvtyTab"
               autoMapping="true">
        <id column="ordr_num" property="ordrNum"/>
        <result column="whs_encd" property="whsEncd"/>
        <!-- 存货档案 -->
        <association property="invtyDoc"
                     javaType="com.px.mis.purc.entity.InvtyDoc" autoMapping="true">
            <id property="invtyEncd" column="invty_encd"/>
            <result property="invtyNm" column="invty_nm"/>
            <result property="measrCorpNm" column="measr_corp_nm"/>
            <result property="Stat" column="Stat"/>
        </association>
        <!-- 采购入 -->
        <association property="intoWhs"
                     javaType="com.px.mis.purc.entity.IntoWhs" autoMapping="true">
            <id column="into_whs_sngl_id" property="intoWhsSnglId"/>
            <result column="into_whs_dt" property="intoWhsDt"/>
            <result column="out_into_whs_typ_nm"
                    property="outIntoWhsTypNm"/>
            <result column="recv_send_cate_nm" property="recvSendCateNm"/>
            <result column="provr_nm" property="provrNm"/>
            <collection property="iList"
                        ofType="com.px.mis.purc.entity.IntoWhsSub" autoMapping="true">
                <id column="ordr_num" property="ordrNum"/>
                <result column="invty_encd" property="invtyEncd"/>
            </collection>
        </association>
        <!-- 销售出 -->
        <association property="sellOutWhs"
                     javaType="com.px.mis.purc.entity.SellOutWhs" autoMapping="true">
            <id column="sell_sngl_id" property="outWhsId"/>
            <result column="out_into_whs_typ_nm"
                    property="outIntoWhsTypNm"/>
            <result column="recv_send_cate_nm" property="recvSendCateNm"/>
            <result column="cust_nm" property="custNm"/>
            <collection property="sList"
                        ofType="com.px.mis.purc.entity.SellOutWhsSub" autoMapping="true">
                <id column="ordr_num" property="ordrNum"/>
                <result column="whs_encd" property="whsEncd"/>
            </collection>
        </association>
        <!-- 其他出入库 -->
        <association property="outIntoWhs"
                     javaType="OthOutIntoWhs" autoMapping="true">
            <id column="form_num" property="formNum"/>
            <result column="form_dt" property="formDt"/>
            <result column="out_into_whs_typ_nm"
                    property="outIntoWhsTypNm"/>
            <collection property="outIntoSubList"
                        ofType="OthOutIntoWhsSubTab" autoMapping="true">
                <id column="ordr_num" property="ordrNum"/>
                <result column="form_num" property="formNum"/>
            </collection>
        </association>
    </resultMap>
    <!-- 库存台账 -->
    <resultMap id="InvtyStand" type="InvtyTab" autoMapping="true">
        <id column="ordr_num" property="ordrNum"/>
        <result column="whs_encd" property="whsEncd"/>
        <!-- 采购入 -->
        <association property="intoWhs"
                     javaType="com.px.mis.purc.entity.IntoWhs" autoMapping="true">
            <id column="into_whs_sngl_id" property="intoWhsSnglId"/>
            <result column="into_whs_dt" property="intoWhsDt"/>
            <result column="out_into_whs_typ_nm"
                    property="outIntoWhsTypNm"/>
            <result column="recv_send_cate_nm" property="recvSendCateNm"/>
            <result column="provr_nm" property="provrNm"/>
            <collection property="iList"
                        ofType="com.px.mis.purc.entity.IntoWhsSub" autoMapping="true">
                <id column="ordr_num" property="ordrNum"/>
                <result column="invty_encd" property="invtyEncd"/>
            </collection>
        </association>
        <!-- 销售出 -->
        <association property="sellOutWhs"
                     javaType="com.px.mis.purc.entity.SellOutWhs" autoMapping="true">
            <id column="sell_sngl_id" property="outWhsId"/>
            <result column="out_into_whs_typ_nm"
                    property="outIntoWhsTypNm"/>
            <result column="recv_send_cate_nm" property="recvSendCateNm"/>
            <result column="cust_nm" property="custNm"/>
            <collection property="sList"
                        ofType="com.px.mis.purc.entity.SellOutWhsSub" autoMapping="true">
                <id column="ordr_num" property="ordrNum"/>
                <result column="whs_encd" property="whsEncd"/>
            </collection>
        </association>
        <!-- 其他出入库 -->
        <association property="outIntoWhs"
                     javaType="OthOutIntoWhs" autoMapping="true">
            <id column="form_num" property="formNum"/>
            <result column="form_dt" property="formDt"/>
            <result column="out_into_whs_typ_nm"
                    property="outIntoWhsTypNm"/>
            <collection property="outIntoSubList"
                        ofType="OthOutIntoWhsSubTab" autoMapping="true">
                <id column="ordr_num" property="ordrNum"/>
                <result column="form_num" property="formNum"/>
            </collection>
        </association>
    </resultMap>


    <!-- 保质期预警 -->
    <sql id="Base_Column_List">
        it.ordr_num, it.whs_encd, it.invty_encd, it.bat_num,
		it.now_stok,
		it.aval_qty, date_format(it.prdc_dt, '%Y-%m-%d %T' )
		it.prdc_dt, it.bao_zhi_qi,
		it.invldtn_dt,it.cntn_tax_uprc,
		it.un_tax_uprc,it.book_entry_uprc,it.tax_rate,it.cntn_tax_amt,
		it.un_tax_amt,it.regn_encd,it.gds_bit_encd,
		id.invty_cls_encd,
		id.invty_encd, id.invty_nm, id.spc_model, id.invty_cd,
		id.provr_id,id.measr_corp_id, id.bx_rule, id.bao_zhi_qi_ear_warn,
		id.bao_zhi_qi_dt,
		id.place_of_origin, id.iptax_rate, id.optax_rate,
		id.highest_pur_price,
		id.lo_sell_prc, id.ltst_cost, id.ref_cost,
		id.ref_sell_prc, id.crspd_bar_cd,
		wd.whs_encd,wd.whs_nm,mDoc.measr_corp_nm
    </sql>
    <!-- 保质期预警 -->
    <resultMap id="BaseResultbaoZhiQi" type="baoZhiQi">
        <result column="whs_encd" property="whs_encd"/>
        <result column="bat_num" property="bat_num"/>
        <result column="now_stok" property="now_stok"/>
        <result column="un_tax_uprc" property="un_tax_uprc"/>
        <result column="cntn_tax_uprc" property="cntn_tax_uprc"/>
        <result column="un_tax_amt" property="un_tax_amt"/>
        <result column="cntn_tax_amt" property="cntn_tax_amt"/>
        <result column="bao_zhi_qi" property="bao_zhi_qi"/>
        <result column="invty_encd" property="invty_encd"/>
        <result column="invty_nm" property="invty_nm"/>
        <result column="spc_model" property="spc_model"/>
        <result column="whs_nm" property="whs_nm"/>
        <result column="measr_corp_nm" property="measr_corp_nm"/>
        <result column="invldtndt" property="invldtndt"/>
        <result column="prdcdt" property="prdcdt"/>
        <result column="stat" property="stat"/>

    </resultMap>

    <select id="selectBaoZhiQiSUM" resultMap="BaseResultbaoZhiQi">
        select


        null whs_encd,
        null bat_num,
        SUM(cast(it.now_stok AS DECIMAL ( 18, 2 ) )) now_stok,
        null un_tax_uprc,
        null cntn_tax_uprc,
        SUM(cast(it.un_tax_amt AS DECIMAL ( 18, 2 ) )) un_tax_amt,
        SUM(cast(it.cntn_tax_amt AS DECIMAL ( 18, 2 ) )) cntn_tax_amt,
        null bao_zhi_qi,

        null invty_encd,
        null invty_nm,
        null spc_model
        <!-- it.*,id.* -->
        ,null whs_nm,null measr_corp_nm,
        null invldtndt
        ,
        null prdcdt
        ,

        null overdueDays,
        null stat<!--Stat 保质期预警天数的状态 select it.invldtn_dt
			,bao_zhi_qi_ear_warn, (case when invldtn_dt is null then "???" when date_sub(
			invldtn_dt, interval IFNULL(id.bao_zhi_qi_ear_warn,0) day ) > NOW() then
			'临近' else '过期' end )stat , invldtn_dt St ,it.*,id.*,wd.whs_nm,mDoc.measr_corp_nm
			from invty_tab as it, invty_doc as id, whs_doc as wd, measr_corp_doc as mDoc
			where it.invty_encd = id.invty_encd AND it.whs_encd=wd.whs_encd AND id.measr_corp_id=mDoc.measr_corp_id -->
        FROM
        invty_tab AS it
        LEFT JOIN invty_doc AS id ON it.invty_encd =
        id.invty_encd
        LEFT JOIN whs_doc AS wd ON it.whs_encd = wd.whs_encd
        LEFT
        JOIN measr_corp_doc AS mDoc ON id.measr_corp_id = mDoc.measr_corp_id
        <where>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND it.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND it.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND it.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invldtnDt != null and invldtnDt != ''">
                AND it.invldtn_dt = #{invldtnDt}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd.size() >0">
                AND id.invty_cls_encd in
                <foreach collection="invtyClsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>

            <!-- 保质期预警天数 -->
            <if test="baoZhiQiEarWarn != null and baoZhiQiEarWarn != ''">
                AND id.bao_zhi_qi_ear_warn = #{baoZhiQiEarWarn}
            </if>
        </where>
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
    </select>
    <select id="selectBaoZhiQiList" resultMap="BaseResultbaoZhiQi">
        select


        it.whs_encd whs_encd,
        it.bat_num bat_num,
        it.now_stok now_stok,
        it.un_tax_uprc un_tax_uprc,
        it.cntn_tax_uprc cntn_tax_uprc,
        it.un_tax_amt un_tax_amt,
        it.cntn_tax_amt cntn_tax_amt,
        it.bao_zhi_qi bao_zhi_qi,
        id.bx_rule bx_rule,
        it.invty_encd invty_encd,
        id.invty_nm invty_nm,
        id.spc_model spc_model,
        id.bx_rule bxRule,
        TRUNCATE ( now_stok / bx_rule, 1 ) bxQty
        <!-- it.*,id.* -->
        ,wd.whs_nm whs_nm,mDoc.measr_corp_nm measr_corp_nm,
        date_format(it.invldtn_dt,
        '%Y-%m-%d' )
        as invldtndt
        ,
        date_format(it.prdc_dt,
        '%Y-%m-%d' )
        as prdcdt
        ,

        DATEDIFF(invldtn_dt,CURDATE()) overdueDays,
        (
        CASE
        WHEN invldtn_dt IS
        NULL THEN
        "未设置"
        WHEN invldtn_dt &lt; NOW()
        THEN
        "商品过期"
        WHEN date_sub(
        invldtn_dt,
        INTERVAL
        IFNULL(id.bao_zhi_qi_ear_warn, 0) DAY
        ) &lt;= NOW()
        THEN
        '临近失效期'
        ELSE
        '保质期内'
        END
        ) stat<!--Stat 保质期预警天数的状态 select it.invldtn_dt
			,bao_zhi_qi_ear_warn, (case when invldtn_dt is null then "???" when date_sub(
			invldtn_dt, interval IFNULL(id.bao_zhi_qi_ear_warn,0) day ) > NOW() then
			'临近' else '过期' end )stat , invldtn_dt St ,it.*,id.*,wd.whs_nm,mDoc.measr_corp_nm
			from invty_tab as it, invty_doc as id, whs_doc as wd, measr_corp_doc as mDoc
			where it.invty_encd = id.invty_encd AND it.whs_encd=wd.whs_encd AND id.measr_corp_id=mDoc.measr_corp_id -->
        FROM
        invty_tab AS it
        LEFT JOIN invty_doc AS id ON it.invty_encd =
        id.invty_encd
        LEFT JOIN whs_doc AS wd ON it.whs_encd = wd.whs_encd
        LEFT
        JOIN measr_corp_doc AS mDoc ON id.measr_corp_id = mDoc.measr_corp_id
        <where>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND it.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND it.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND it.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND it.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invldtnDt != null and invldtnDt != ''">
                AND it.invldtn_dt = #{invldtnDt}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND id.invty_cls_encd like #{invtyClsEncd}
            </if>

            <!-- 保质期预警天数 -->
            <if test="baoZhiQiEarWarn != null and baoZhiQiEarWarn != ''">
                AND id.bao_zhi_qi_ear_warn = #{baoZhiQiEarWarn}
            </if>
        </where>
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
        <if test="index != null and num != null ">
            LIMIT #{index},#{num}
        </if>
    </select>
    <select id="selectBaoZhiQiCount" parameterType="Map"
            resultType="Integer">
        SELECT count(*)
        FROM
        invty_tab AS it
        LEFT JOIN invty_doc AS id ON
        it.invty_encd = id.invty_encd
        LEFT JOIN whs_doc AS wd ON it.whs_encd =
        wd.whs_encd
        LEFT JOIN measr_corp_doc AS mDoc ON id.measr_corp_id =
        mDoc.measr_corp_id
        <where>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND it.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND it.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND it.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND it.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invldtnDt != null and invldtnDt != ''">
                AND it.invldtn_dt = #{invldtnDt}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND id.invty_cls_encd like #{invtyClsEncd}
            </if>

            <!-- 保质期预警天数 -->
            <if test="baoZhiQiEarWarn != null and baoZhiQiEarWarn != ''">
                AND id.bao_zhi_qi_ear_warn = #{baoZhiQiEarWarn}
            </if>
        </where>
    </select>
    <!-- 收发存汇总 -->
    <!-- 仓库名称、存货编码、存货名称、规格型号、主计量单位、存货分类名称、 期初结存数量、期初结存金额、总计-入库数量、总计-入库金额、总计-出库数量、
		总计-出库金额、期末结存数量、期末结存金额 -->
    <select id="selectInvtyTermBgnTab"
            resultType="TransceiverSummaryReport">
        SELECT
        invty_term_bgn_tab.whs_encd whsEncd,
        invty_term_bgn_tab.invty_encd invtyEncd,
        SUM(invty_term_bgn_tab.qty)
        qiChuQty,
        invty_term_bgn_tab.bat_num batNum,
        SUM(invty_term_bgn_tab.amt) qiChuAmt,
        SUM(invty_term_bgn_tab.prc_tax_sum) qiChuSum
        FROM
        invty_term_bgn_tab
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>
            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>

            <if test="Dt1 != null and Dt1 != ''">
                AND invty_term_bgn_tab.chk_tm &gt;= #{Dt1}
            </if>
            <if test="Dt2 != null and Dt2 != ''">
                AND invty_term_bgn_tab.chk_tm &lt;= #{Dt2}
            </if>
        </where>

    </select>

    <select id="selectothOutIntoWhsInto" resultType="InvtyTab">
        SELECT * from(

        SELECT
        oth_out_into_whs.whs_encd whs_encd,
        oth_out_into_whs_sub_tab.invty_encd invty_encd,
        SUM(
        oth_out_into_whs_sub_tab.qty

        ) now_stok,
        SUM(
        oth_out_into_whs_sub_tab.un_tax_amt

        ) unTaxAmt,
        SUM(
        oth_out_into_whs_sub_tab.cntn_tax_amt

        ) cntnTaxAmt,

        oth_out_into_whs_sub_tab.bat_num bat_num
        FROM
        oth_out_into_whs
        JOIN
        oth_out_into_whs_sub_tab ON (

        oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num
        AND oth_out_into_whs.is_nt_chk = 1
        and oth_out_into_whs.out_into_whs_typ_id in ('3','5' )<!--入库 -->
        )
        GROUP BY
        whs_encd,
        invty_encd,
        bat_num

        ) a
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND oth_out_into_whs.setup_tm &lt;= #{formDt2}
            </if>
        </where>


    </select>

    <select id="selectothOutIntoWhsOut" resultType="InvtyTab">
        SELECT * from(

        SELECT
        oth_out_into_whs.whs_encd whs_encd,
        oth_out_into_whs_sub_tab.invty_encd invty_encd,
        SUM(
        oth_out_into_whs_sub_tab.qty

        ) now_stok,

        SUM(
        oth_out_into_whs_sub_tab.un_tax_amt

        ) unTaxAmt,
        SUM(
        oth_out_into_whs_sub_tab.cntn_tax_amt

        ) cntnTaxAmt,

        oth_out_into_whs_sub_tab.bat_num bat_num
        FROM
        oth_out_into_whs
        JOIN
        oth_out_into_whs_sub_tab ON (

        oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num
        AND oth_out_into_whs.is_nt_chk = 1
        and oth_out_into_whs.out_into_whs_typ_id in ('4','6' )<!-- 出库 -->
        )
        GROUP BY
        whs_encd,
        invty_encd,
        bat_num

        ) a
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND oth_out_into_whs.setup_tm &lt;= #{formDt2}
            </if>
        </where>


    </select>
    <select id="selectothIntoWhs" resultType="InvtyTab">
        SELECT * from(

        SELECT


        into_whs_sub.whs_encd whs_encd,
        into_whs_sub.invty_encd invty_encd,

        SUM(
        into_whs_sub.qty

        ) now_stok,

        SUM(
        into_whs_sub.no_tax_amt

        ) unTaxAmt,

        SUM(
        into_whs_sub.prc_tax_sum

        )
        cntnTaxAmt,
        into_whs_sub.bat_num bat_num

        FROM
        into_whs
        JOIN into_whs_sub
        ON (
        into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id
        AND
        into_whs.is_nt_chk = 1
        )

        GROUP BY
        whs_encd,
        invty_encd,
        bat_num) a
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND into_whs.setup_tm &lt;= #{formDt2}
            </if>
        </where>


    </select>


    <select id="selectothSellOutWhs" resultType="InvtyTab">
        SELECT * from(


        SELECT
        sell_out_whs_sub.whs_encd whs_encd,
        sell_out_whs_sub.invty_encd invty_encd,
        SUM(
        sell_out_whs_sub.qty

        )
        now_stok,
        SUM(
        sell_out_whs_sub.no_tax_amt

        )
        unTaxAmt,
        SUM(
        sell_out_whs_sub.prc_tax_sum

        )
        cntnTaxAmt,

        sell_out_whs_sub.bat_num
        bat_num


        FROM
        sell_out_whs
        JOIN
        sell_out_whs_sub ON (
        sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id
        AND
        sell_out_whs.is_nt_chk = 1
        )
        GROUP BY
        whs_encd,
        invty_encd,
        bat_num
        ) a
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND sell_out_whs.setup_tm &lt;= #{formDt2}
            </if>
        </where>


    </select>
    <select id="selectTSummary"
            resultType="TransceiverSummaryReport">
        SELECT
        IFNULL( SUM( cast( intoQty AS DECIMAL ( 18, 2 ) ) ), 0 ) intoQty,
        IFNULL( SUM( cast( outQty AS DECIMAL ( 18, 2 ) ) ), 0 ) outQty,
        IFNULL( SUM( cast( intoAmt AS DECIMAL ( 18, 2 ) ) ), 0 ) intoAmt,
        IFNULL( SUM( cast( intoSum AS DECIMAL ( 18, 2 ) ) ), 0 ) intoSum,
        IFNULL( SUM( cast( outAmt AS DECIMAL ( 18, 2 ) ) ), 0 ) outAmt,
        IFNULL( SUM( cast( outSum AS DECIMAL ( 18, 2 ) ) ), 0 ) outSum,
        IFNULL( SUM( cast( QCqty AS DECIMAL ( 18, 2 ) ) ), 0 ) qiChuQty,
        IFNULL( SUM( cast( QCtax_amt AS DECIMAL ( 18, 2 ) ) ), 0 ) qiChuAmt,
        IFNULL( SUM( cast( QCtax_sum AS DECIMAL ( 18, 2 ) ) ), 0 ) qiChuSum,
        IFNULL( SUM( cast( QCqty AS DECIMAL ( 18, 2 ) ) ), 0 ) + IFNULL( SUM( cast( intoQty AS DECIMAL ( 18, 2 ) ) ), 0
        ) - IFNULL( SUM( cast( outQty AS DECIMAL ( 18, 2 ) ) ), 0 ) jieCunQty,
        IFNULL( SUM( cast( QCtax_amt AS DECIMAL ( 18, 2 ) ) ), 0 ) + IFNULL( SUM( cast( intoAmt AS DECIMAL ( 18, 2 ) )
        ), 0 ) - IFNULL( SUM( cast( outAmt AS DECIMAL ( 18, 2 ) ) ), 0 ) jieChuAmt,
        IFNULL( SUM( cast( QCtax_sum AS DECIMAL ( 18, 2 ) ) ), 0 ) + IFNULL( SUM( cast( intoSum AS DECIMAL ( 18, 2 ) )
        ), 0 ) - IFNULL( SUM( cast( outSum AS DECIMAL ( 18, 2 ) ) ), 0 ) jieChuSum
        ,
        "合计" whsEncd,
        "" invtyEncd,
        "" batNum,
        "" invtyNm,
        "" whsNm,
        "" measrCorpNm,
        "" spcModel,
        "" invtyClsNm,
        "" prdcDt,
        "" invldtnDt,
        "" baoZhiQi,
        "" bxRule,
        "" invtyClsEncd
        FROM
        (
        SELECT
        SUM( intoQty ) intoQty,
        SUM( outQty ) outQty,
        SUM( intoAmt ) intoAmt,
        SUM( intoSum ) intoSum,
        SUM( outAmt ) outAmt,
        SUM( outSum ) outSum,
        SUM(
        QCqty ) QCqty,
        SUM( QCtax_amt ) QCtax_amt,
        SUM( QCtax_sum ) QCtax_sum,
        whsEncd,
        invtyEncd,
        batNum
        FROM
        (
        SELECT NULL
        intoQty,
        NULL outQty,
        NULL intoAmt,
        NULL intoSum,
        NULL outAmt,
        NULL outSum,
        IFNULL( SUM( a.QCqty ), 0 ) + IFNULL( SUM( a.intoQty ), 0 ) - IFNULL( SUM(
        a.outQty ), 0 ) QCqty,
        IFNULL( SUM( a.QCtax_amt ), 0 ) + IFNULL( SUM( a.intoAmt ), 0 ) - IFNULL(
        SUM( a.outAmt ), 0 ) QCtax_amt,
        IFNULL( SUM( a.QCtax_sum ), 0 ) + IFNULL( SUM( a.intoSum ), 0 ) - IFNULL(
        SUM( a.outSum ), 0 ) QCtax_sum,
        a.whsEncd,
        a.invtyEncd,
        a.batNum
        FROM
        (
        SELECT
        intoQty,
        outQty,
        intoAmt,
        intoSum,
        outAmt,
        outSum,
        QCqty,
        QCtax_amt,
        QCtax_sum,
        whsEncd,
        invtyEncd,
        batNum
        FROM
        (
        SELECT NULL
        intoQty,
        NULL outQty,
        NULL intoAmt,
        NULL intoSum,
        NULL outAmt,
        NULL outSum,
        IFNULL( qty, 0 ) QCqty,
        IFNULL( tax_amt, 0 ) QCtax_amt,
        IFNULL( tax_sum, 0 ) QCtax_sum,
        whs_encd whsEncd,
        invty_Encd invtyEncd,
        bat_Num batNum
        FROM
        invty_tab_term
        <where>
            invty_tab_term.is_early = 1
            <if test="formDt != null and formDt != ''">
                <!-- AND term_dt = DATE_SUB( #{formDt}, INTERVAL 1 MONTH ) -->
                AND DATE_FORMAT( invty_tab_term.term_dt, '%Y%m' ) = DATE_FORMAT(
                #{formDt}, '%Y%m' )

            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0 ">
                AND invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0 ">
                AND whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0 ">
                AND bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </where>


        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ORDER BY
        term_dt DESC
        ) qc

        UNION ALL
        SELECT NULL
        intoQty,
        SUM( sell_out_whs_sub.qty ) outQty,
        NULL intoAmt,
        NULL intoSum,
        SUM( no_tax_amt ) outAmt,
        SUM( prc_tax_sum ) outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd invtyEncd,
        sell_out_whs_sub.bat_Num batNum
        FROM
        sell_out_whs
        JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = 1 )
        <where>
            <if test="formDt != null and formDt != ''">
                AND sell_out_whs.out_whs_dt &gt; #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.out_whs_dt &lt; #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND sell_out_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND sell_out_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND sell_out_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sell_out_whs.chk_tm &gt; #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sell_out_whs.chk_tm &lt; #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( oth_out_into_whs_sub_tab.qty ) intoQty,
        NULL outQty,
        SUM( un_tax_amt ) intoAmt,
        SUM( cntn_tax_amt ) intoSum,
        NULL outAmt,
        NULL outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = 1
        AND oth_out_into_whs.form_typ_encd = "014" )
        <where>
            <if test="formDt != null and formDt != ''">
                AND oth_out_into_whs.form_dt &gt; #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt; #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt; #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt; #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT NULL
        intoQty,
        SUM( oth_out_into_whs_sub_tab.qty ) outQty,
        NULL intoAmt,
        NULL intoSum,
        SUM( un_tax_amt ) outAmt,
        SUM( cntn_tax_amt ) outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = 1
        AND oth_out_into_whs.form_typ_encd = "015" )
        <where>
            <if test="formDt != null and formDt != ''">
                AND oth_out_into_whs.form_dt &gt; #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt; #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt; #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt; #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( into_whs_sub.qty ) intoQty,
        NULL outQty,
        SUM( no_tax_amt ) intoAmt,
        SUM( prc_tax_sum ) intoSum,
        NULL outAmt,
        NULL outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        into_whs_sub.whs_encd whsEncd,
        into_whs_sub.invty_encd invtyEncd,
        into_whs_sub.bat_Num batNum
        FROM
        into_whs
        JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = 1 )

        <where>
            <if test="formDt != null and formDt != ''">
                AND into_whs.into_whs_dt &gt; #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.into_whs_dt &lt; #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND into_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND into_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND into_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND into_whs.chk_tm &gt; #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND into_whs.chk_tm &lt; #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ) a
        GROUP BY
        a.whsEncd,
        a.invtyEncd,
        a.batNum
        ) s
        GROUP BY
        s.whsEncd,
        s.invtyEncd,
        s.batNum
        UNION ALL
        SELECT NULL
        intoQty,
        SUM( sell_out_whs_sub.qty ) outQty,
        NULL intoAmt,
        NULL
        intoSum,
        SUM( no_tax_amt ) outAmt,
        SUM( prc_tax_sum ) outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd invtyEncd,
        sell_out_whs_sub.bat_Num batNum
        FROM
        sell_out_whs
        JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = 1 )

        <where>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.out_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND sell_out_whs.out_whs_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND sell_out_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND sell_out_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND sell_out_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sell_out_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sell_out_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( oth_out_into_whs_sub_tab.qty ) intoQty,
        NULL outQty,
        SUM(
        un_tax_amt ) intoAmt,
        SUM( cntn_tax_amt ) intoSum,
        NULL outAmt,
        NULL
        outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd
        invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND
        oth_out_into_whs.is_nt_chk = 1 AND oth_out_into_whs.form_typ_encd =
        "014" )

        <where>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT NULL
        intoQty,
        SUM( oth_out_into_whs_sub_tab.qty ) outQty,
        NULL intoAmt,
        NULL intoSum,
        SUM( un_tax_amt ) outAmt,
        SUM( cntn_tax_amt ) outSum,
        NULL
        QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND
        oth_out_into_whs.is_nt_chk = 1 AND oth_out_into_whs.form_typ_encd =
        "015" )

        <where>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0 ">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0 ">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0 ">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( into_whs_sub.qty ) intoQty,
        NULL outQty,
        SUM( no_tax_amt ) intoAmt,
        SUM( prc_tax_sum ) intoSum,
        NULL outAmt,
        NULL outSum,
        NULL QCqty,
        NULL
        QCtax_amt,
        NULL QCtax_sum,
        into_whs_sub.whs_encd whsEncd,
        into_whs_sub.invty_encd invtyEncd,
        into_whs_sub.bat_Num batNum
        FROM
        into_whs
        JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = 1 )
        <where>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.into_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND into_whs.into_whs_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0 ">
                AND into_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND into_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0 ">
                AND into_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ) d
        LEFT JOIN invty_tab ON ( invty_tab.invty_encd = d.invtyEncd AND
        invty_tab.bat_Num = d.batNum AND invty_tab.whs_encd = d.whsEncd )
        LEFT JOIN invty_doc ON ( invty_tab.invty_encd = invty_doc.invty_encd )
        LEFT JOIN measr_corp_doc ON ( invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id )
        LEFT JOIN whs_doc ON ( whs_doc.whs_encd = d.whsEncd )
        LEFT JOIN invty_cls ON ( invty_doc.invty_cls_encd =
        invty_cls.invty_cls_encd )
        <where>
            1=1
            and d.whsEncd is not null
            and d.invtyEncd is not null
            and d.batNum is not null
            <if test="invtyClsEncd != null and invtyClsEncd.size() >0">
                AND invty_doc.invty_cls_encd in
                <foreach collection="invtyClsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </where>
        <!-- HAVING LENGTH( d.batNum ) > 0 -->
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
    </select>

    <select id="selectTSummaryList"
            resultType="TransceiverSummaryReport">
        SELECT
        IFNULL( SUM( cast( intoQty AS DECIMAL ( 18, 2 ) ) ), 0 ) intoQty,
        IFNULL( SUM( cast( outQty AS DECIMAL ( 18, 2 ) ) ), 0 ) outQty,
        IFNULL( SUM( cast( intoAmt AS DECIMAL ( 18, 2 ) ) ), 0 ) intoAmt,
        IFNULL( SUM( cast( intoSum AS DECIMAL ( 18, 2 ) ) ), 0 ) intoSum,
        IFNULL( SUM( cast( outAmt AS DECIMAL ( 18, 2 ) ) ), 0 ) outAmt,
        IFNULL( SUM( cast( outSum AS DECIMAL ( 18, 2 ) ) ), 0 ) outSum,
        IFNULL( SUM( cast( QCqty AS DECIMAL ( 18, 2 ) ) ), 0 ) qiChuQty,
        IFNULL( SUM( cast( QCtax_amt AS DECIMAL ( 18, 2 ) ) ), 0 ) qiChuAmt,
        IFNULL( SUM( cast( QCtax_sum AS DECIMAL ( 18, 2 ) ) ), 0 ) qiChuSum,
        IFNULL( SUM( cast( QCqty AS DECIMAL ( 18, 2 ) ) ), 0 ) + IFNULL( SUM( cast( intoQty AS DECIMAL ( 18, 2 ) ) ), 0
        ) - IFNULL( SUM( cast( outQty AS DECIMAL ( 18, 2 ) ) ), 0 ) jieCunQty,
        IFNULL( SUM( cast( QCtax_amt AS DECIMAL ( 18, 2 ) ) ), 0 ) + IFNULL( SUM( cast( intoAmt AS DECIMAL ( 18, 2 ) )
        ), 0 ) - IFNULL( SUM( cast( outAmt AS DECIMAL ( 18, 2 ) ) ), 0 ) jieChuAmt,
        IFNULL( SUM( cast( QCtax_sum AS DECIMAL ( 18, 2 ) ) ), 0 ) + IFNULL( SUM( cast( intoSum AS DECIMAL ( 18, 2 ) )
        ), 0 ) - IFNULL( SUM( cast( outSum AS DECIMAL ( 18, 2 ) ) ), 0 ) jieChuSum,
        whsEncd,
        invtyEncd,
        batNum,
        invty_doc.invty_nm invtyNm,
        whs_doc.whs_nm whsNm,
        measr_corp_doc.measr_corp_nm measrCorpNm,
        invty_doc.spc_model spcModel,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_tab.prdc_dt prdcDt,
        invty_tab.invldtn_dt invldtnDt,
        invty_tab.bao_zhi_qi baoZhiQi,
        invty_doc.bx_rule bxRule,
        invty_doc.invty_cls_encd invtyClsEncd
        FROM
        (
        SELECT
        SUM( intoQty ) intoQty,
        SUM( outQty ) outQty,
        SUM( intoAmt ) intoAmt,
        SUM( intoSum ) intoSum,
        SUM( outAmt ) outAmt,
        SUM( outSum ) outSum,
        SUM(
        QCqty ) QCqty,
        SUM( QCtax_amt ) QCtax_amt,
        SUM( QCtax_sum ) QCtax_sum,
        whsEncd,
        invtyEncd,
        batNum
        FROM
        (
        SELECT NULL
        intoQty,
        NULL outQty,
        NULL intoAmt,
        NULL intoSum,
        NULL outAmt,
        NULL outSum,
        IFNULL( SUM( a.QCqty ), 0 ) + IFNULL( SUM( a.intoQty ), 0 ) - IFNULL( SUM(
        a.outQty ), 0 ) QCqty,
        IFNULL( SUM( a.QCtax_amt ), 0 ) + IFNULL( SUM( a.intoAmt ), 0 ) - IFNULL(
        SUM( a.outAmt ), 0 ) QCtax_amt,
        IFNULL( SUM( a.QCtax_sum ), 0 ) + IFNULL( SUM( a.intoSum ), 0 ) - IFNULL(
        SUM( a.outSum ), 0 ) QCtax_sum,
        a.whsEncd,
        a.invtyEncd,
        a.batNum
        FROM
        (
        SELECT
        intoQty,
        outQty,
        intoAmt,
        intoSum,
        outAmt,
        outSum,
        QCqty,
        QCtax_amt,
        QCtax_sum,
        whsEncd,
        invtyEncd,
        batNum
        FROM
        (
        SELECT NULL
        intoQty,
        NULL outQty,
        NULL intoAmt,
        NULL intoSum,
        NULL outAmt,
        NULL outSum,
        IFNULL( qty, 0 ) QCqty,
        IFNULL( tax_amt, 0 ) QCtax_amt,
        IFNULL( tax_sum, 0 ) QCtax_sum,
        whs_encd whsEncd,
        invty_Encd invtyEncd,
        bat_Num batNum
        FROM
        invty_tab_term
        <where>
            invty_tab_term.is_early = 1
            <if test="formDt != null and formDt != ''">
                <!-- AND term_dt = DATE_SUB( #{formDt}, INTERVAL 1 MONTH ) -->
                AND DATE_FORMAT( invty_tab_term.term_dt, '%Y%m' ) = DATE_FORMAT(
                #{formDt}, '%Y%m' )

            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0 ">
                AND invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0 ">
                AND whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0 ">
                AND whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0 ">
                AND bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </where>


        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ORDER BY
        term_dt DESC
        ) qc

        UNION ALL
        SELECT NULL
        intoQty,
        SUM( sell_out_whs_sub.qty ) outQty,
        NULL intoAmt,
        NULL intoSum,
        SUM( no_tax_amt ) outAmt,
        SUM( prc_tax_sum ) outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd invtyEncd,
        sell_out_whs_sub.bat_Num batNum
        FROM
        sell_out_whs
        JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = 1 )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND sell_out_whs.memo like #{memo}
            </if>
            <if test="formDt != null and formDt != ''">
                AND sell_out_whs.out_whs_dt &gt; #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.out_whs_dt &lt; #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND sell_out_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND sell_out_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND sell_out_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND sell_out_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sell_out_whs.chk_tm &gt; #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sell_out_whs.chk_tm &lt; #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( oth_out_into_whs_sub_tab.qty ) intoQty,
        NULL outQty,
        SUM( un_tax_amt ) intoAmt,
        SUM( cntn_tax_amt ) intoSum,
        NULL outAmt,
        NULL outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = 1
        AND oth_out_into_whs.form_typ_encd = "014" )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="formDt != null and formDt != ''">
                AND oth_out_into_whs.form_dt &gt; #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt; #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt; #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt; #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT NULL
        intoQty,
        SUM( oth_out_into_whs_sub_tab.qty ) outQty,
        NULL intoAmt,
        NULL intoSum,
        SUM( un_tax_amt ) outAmt,
        SUM( cntn_tax_amt ) outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = 1
        AND oth_out_into_whs.form_typ_encd = "015" )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="formDt != null and formDt != ''">
                AND oth_out_into_whs.form_dt &gt; #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt; #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt; #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt; #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( into_whs_sub.qty ) intoQty,
        NULL outQty,
        SUM( no_tax_amt ) intoAmt,
        SUM( prc_tax_sum ) intoSum,
        NULL outAmt,
        NULL outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        into_whs_sub.whs_encd whsEncd,
        into_whs_sub.invty_encd invtyEncd,
        into_whs_sub.bat_Num batNum
        FROM
        into_whs
        JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = 1 )

        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND into_whs.memo like #{memo}
            </if>
            <if test="formDt != null and formDt != ''">
                AND into_whs.into_whs_dt &gt; #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.into_whs_dt &lt; #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND into_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND into_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND into_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND into_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND into_whs.chk_tm &gt; #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND into_whs.chk_tm &lt; #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ) a
        GROUP BY
        a.whsEncd,
        a.invtyEncd,
        a.batNum
        ) s
        GROUP BY
        s.whsEncd,
        s.invtyEncd,
        s.batNum
        UNION ALL
        SELECT NULL
        intoQty,
        SUM( sell_out_whs_sub.qty ) outQty,
        NULL intoAmt,
        NULL
        intoSum,
        SUM( no_tax_amt ) outAmt,
        SUM( prc_tax_sum ) outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd invtyEncd,
        sell_out_whs_sub.bat_Num batNum
        FROM
        sell_out_whs
        JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = 1 )

        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND sell_out_whs.memo like #{memo}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.out_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND sell_out_whs.out_whs_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND sell_out_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND sell_out_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND sell_out_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND sell_out_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sell_out_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sell_out_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( oth_out_into_whs_sub_tab.qty ) intoQty,
        NULL outQty,
        SUM(
        un_tax_amt ) intoAmt,
        SUM( cntn_tax_amt ) intoSum,
        NULL outAmt,
        NULL
        outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd
        invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND
        oth_out_into_whs.is_nt_chk = 1 AND oth_out_into_whs.form_typ_encd =
        "014" )

        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT NULL
        intoQty,
        SUM( oth_out_into_whs_sub_tab.qty ) outQty,
        NULL intoAmt,
        NULL intoSum,
        SUM( un_tax_amt ) outAmt,
        SUM( cntn_tax_amt ) outSum,
        NULL
        QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND
        oth_out_into_whs.is_nt_chk = 1 AND oth_out_into_whs.form_typ_encd =
        "015" )

        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0 ">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0 ">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0 ">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0 ">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( into_whs_sub.qty ) intoQty,
        NULL outQty,
        SUM( no_tax_amt ) intoAmt,
        SUM( prc_tax_sum ) intoSum,
        NULL outAmt,
        NULL outSum,
        NULL QCqty,
        NULL
        QCtax_amt,
        NULL QCtax_sum,
        into_whs_sub.whs_encd whsEncd,
        into_whs_sub.invty_encd invtyEncd,
        into_whs_sub.bat_Num batNum
        FROM
        into_whs
        JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = 1 )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND into_whs.memo like #{memo}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.into_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND into_whs.into_whs_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0 ">
                AND into_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND into_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND into_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0 ">
                AND into_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ) d
        LEFT JOIN invty_tab ON ( invty_tab.invty_encd = d.invtyEncd AND
        invty_tab.bat_Num = d.batNum AND invty_tab.whs_encd = d.whsEncd )
        LEFT JOIN invty_doc ON ( invty_tab.invty_encd = invty_doc.invty_encd )
        LEFT JOIN measr_corp_doc ON ( invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id )
        LEFT JOIN whs_doc ON ( whs_doc.whs_encd = d.whsEncd )
        LEFT JOIN invty_cls ON ( invty_doc.invty_cls_encd =
        invty_cls.invty_cls_encd )
        <where>
            1=1
            and d.whsEncd is not null
            and d.invtyEncd is not null
            and d.batNum is not null
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND invty_doc.invty_cls_encd like #{invtyClsEncd}
            </if>
        </where>

        GROUP BY
        d.whsEncd,
        d.invtyEncd,
        d.batNum
        <!-- HAVING LENGTH( d.batNum ) > 0 -->
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
        <if test="ind != null and num != null ">
            LIMIT #{ind},#{num}
        </if>
    </select>

    <select id="selectTSummaryCount" resultType="Integer">
        SELECT
        count(*)
        FROM(
        SELECT
        count(*)

        FROM
        (
        SELECT
        SUM( intoQty ) intoQty,
        SUM( outQty ) outQty,
        SUM( intoAmt ) intoAmt,
        SUM( intoSum ) intoSum,
        SUM( outAmt ) outAmt,
        SUM( outSum ) outSum,
        SUM(
        QCqty ) QCqty,
        SUM( QCtax_amt ) QCtax_amt,
        SUM( QCtax_sum ) QCtax_sum,
        whsEncd,
        invtyEncd,
        batNum
        FROM
        (
        SELECT NULL
        intoQty,
        NULL outQty,
        NULL intoAmt,
        NULL intoSum,
        NULL outAmt,
        NULL outSum,
        IFNULL( SUM( a.QCqty ), 0 ) + IFNULL( SUM( a.intoQty ), 0 ) - IFNULL( SUM(
        a.outQty ), 0 ) QCqty,
        IFNULL( SUM( a.QCqty ), 0 ) + IFNULL( SUM( a.intoAmt ), 0 ) - IFNULL( SUM(
        a.outAmt ), 0 ) QCtax_amt,
        IFNULL( SUM( a.QCqty ), 0 ) + IFNULL( SUM( a.intoSum ), 0 ) - IFNULL( SUM(
        a.outSum ), 0 ) QCtax_sum,
        a.whsEncd,
        a.invtyEncd,
        a.batNum
        FROM
        (
        SELECT
        intoQty,
        outQty,
        intoAmt,
        intoSum,
        outAmt,
        outSum,
        QCqty,
        QCtax_amt,
        QCtax_sum,
        whsEncd,
        invtyEncd,
        batNum
        FROM
        (
        SELECT NULL
        intoQty,
        NULL outQty,
        NULL intoAmt,
        NULL intoSum,
        NULL outAmt,
        NULL outSum,
        IFNULL( qty, 0 ) QCqty,
        IFNULL( tax_amt, 0 ) QCtax_amt,
        IFNULL( tax_sum, 0 ) QCtax_sum,
        whs_encd whsEncd,
        invty_Encd invtyEncd,
        bat_Num batNum
        FROM
        invty_tab_term
        <where>
            invty_tab_term.is_early = 1
            <if test="formDt != null and formDt != ''">
                <!-- AND term_dt = DATE_SUB( #{formDt}, INTERVAL 1 MONTH ) -->
                AND DATE_FORMAT( invty_tab_term.term_dt, '%Y%m' ) = DATE_FORMAT(
                #{formDt}, '%Y%m' )

            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0 ">
                AND invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0 ">
                AND whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0 ">
                AND whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0 ">
                AND bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </where>


        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ORDER BY
        term_dt DESC
        ) qc

        UNION ALL
        SELECT NULL
        intoQty,
        SUM( sell_out_whs_sub.qty ) outQty,
        NULL intoAmt,
        NULL intoSum,
        SUM( no_tax_amt ) outAmt,
        SUM( prc_tax_sum ) outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd invtyEncd,
        sell_out_whs_sub.bat_Num batNum
        FROM
        sell_out_whs
        JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = 1 )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND sell_out_whs.memo like #{memo}
            </if>
            <if test="formDt != null and formDt != ''">
                AND sell_out_whs.out_whs_dt &gt;= #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.out_whs_dt &lt;= #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND sell_out_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND sell_out_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND sell_out_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND sell_out_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sell_out_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sell_out_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( oth_out_into_whs_sub_tab.qty ) intoQty,
        NULL outQty,
        SUM( un_tax_amt ) intoAmt,
        SUM( cntn_tax_amt ) intoSum,
        NULL outAmt,
        NULL outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = 1
        AND oth_out_into_whs.form_typ_encd = "014" )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="formDt != null and formDt != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
            AND oth_out_into_whs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
            <if test="batNum != null and batNum.size() >0">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT NULL
        intoQty,
        SUM( oth_out_into_whs_sub_tab.qty ) outQty,
        NULL intoAmt,
        NULL intoSum,
        SUM( un_tax_amt ) outAmt,
        SUM( cntn_tax_amt ) outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = 1
        AND oth_out_into_whs.form_typ_encd = "015" )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="formDt != null and formDt != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( into_whs_sub.qty ) intoQty,
        NULL outQty,
        SUM( no_tax_amt ) intoAmt,
        SUM( prc_tax_sum ) intoSum,
        NULL outAmt,
        NULL outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        into_whs_sub.whs_encd whsEncd,
        into_whs_sub.invty_encd invtyEncd,
        into_whs_sub.bat_Num batNum
        FROM
        into_whs
        JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = 1 )

        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND into_whs.memo like #{memo}
            </if>
            <if test="formDt != null and formDt != ''">
                AND into_whs.into_whs_dt &gt;= #{formDt}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.into_whs_dt &lt;= #{formDt1}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND into_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND into_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND into_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND into_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ) a
        GROUP BY
        a.whsEncd,
        a.invtyEncd,
        a.batNum
        ) s
        GROUP BY
        s.whsEncd,
        s.invtyEncd,
        s.batNum
        UNION ALL
        SELECT NULL
        intoQty,
        SUM( sell_out_whs_sub.qty ) outQty,
        NULL intoAmt,
        NULL
        intoSum,
        SUM( no_tax_amt ) outAmt,
        SUM( prc_tax_sum ) outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd invtyEncd,
        sell_out_whs_sub.bat_Num batNum
        FROM
        sell_out_whs
        JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = 1 )

        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND sell_out_whs.memo like #{memo}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.out_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND sell_out_whs.out_whs_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND sell_out_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND sell_out_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND sell_out_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND sell_out_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sell_out_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sell_out_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( oth_out_into_whs_sub_tab.qty ) intoQty,
        NULL outQty,
        SUM(
        un_tax_amt ) intoAmt,
        SUM( cntn_tax_amt ) intoSum,
        NULL outAmt,
        NULL
        outSum,
        NULL QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd
        invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND
        oth_out_into_whs.is_nt_chk = 1 AND oth_out_into_whs.form_typ_encd =
        "014" )

        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT NULL
        intoQty,
        SUM( oth_out_into_whs_sub_tab.qty ) outQty,
        NULL intoAmt,
        NULL intoSum,
        SUM( un_tax_amt ) outAmt,
        SUM( cntn_tax_amt ) outSum,
        NULL
        QCqty,
        NULL QCtax_amt,
        NULL QCtax_sum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        oth_out_into_whs_sub_tab.bat_Num batNum
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND
        oth_out_into_whs.is_nt_chk = 1 AND oth_out_into_whs.form_typ_encd =
        "015" )

        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0 ">
                AND oth_out_into_whs_sub_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0 ">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0 ">
                AND oth_out_into_whs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0 ">
                AND oth_out_into_whs_sub_tab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        whsEncd,
        invtyEncd,
        batNum UNION ALL
        SELECT
        SUM( into_whs_sub.qty ) intoQty,
        NULL outQty,
        SUM( no_tax_amt ) intoAmt,
        SUM( prc_tax_sum ) intoSum,
        NULL outAmt,
        NULL outSum,
        NULL QCqty,
        NULL
        QCtax_amt,
        NULL QCtax_sum,
        into_whs_sub.whs_encd whsEncd,
        into_whs_sub.invty_encd invtyEncd,
        into_whs_sub.bat_Num batNum
        FROM
        into_whs
        JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = 1 )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND into_whs.memo like #{memo}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.into_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND into_whs.into_whs_dt &lt;= #{formDt2}
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0 ">
                AND into_whs_sub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND into_whs_sub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND into_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0 ">
                AND into_whs_sub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ) d
        LEFT JOIN invty_tab ON ( invty_tab.invty_encd = d.invtyEncd AND
        invty_tab.bat_Num = d.batNum AND invty_tab.whs_encd = d.whsEncd )
        LEFT JOIN invty_doc ON ( invty_tab.invty_encd = invty_doc.invty_encd )
        LEFT JOIN measr_corp_doc ON ( invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id )
        LEFT JOIN whs_doc ON ( whs_doc.whs_encd = d.whsEncd )
        LEFT JOIN invty_cls ON ( invty_doc.invty_cls_encd =
        invty_cls.invty_cls_encd )
        <where>
            1=1
            and d.whsEncd is not null
            and d.invtyEncd is not null
            and d.batNum is not null
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND invty_doc.invty_cls_encd like #{invtyClsEncd}
            </if>
        </where>

        GROUP BY
        d.whsEncd,
        d.invtyEncd,
        d.batNum
        <!-- HAVING LENGTH( d.batNum ) > 0 -->

        ) zx

    </select>


    <!-- 现存量查询 -->
    <!-- 仓库编码、存货编码、现存数量、 其中冻结数量、到货/在检数量、 预计入库数量合计、待发货数量、 调拨待发数量、预计出库数量、不合格品数量、
		可用数量 -->

    <!-- 其他出 -->
    <select id="selectOutIntoWhsOut" resultType="InvtyTab">
        SELECT * from(
        SELECT
        oth_out_into_whs.whs_encd whs_encd,
        oth_out_into_whs_sub_tab.invty_encd invty_encd,
        oth_out_into_whs_sub_tab.bat_num bat_num,
        sum(oth_out_into_whs_sub_tab.qty) qty
        FROM
        oth_out_into_whs
        JOIN
        oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num
        AND oth_out_into_whs.is_nt_chk = 0
        and oth_out_into_whs.out_status IS NOT NULL
        )
        GROUP BY
        whs_encd,invty_encd,bat_num) a
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND to_gds_sngl.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND to_gds_sngl.setup_tm &lt;= #{formDt2}
            </if>
        </where>

    </select>

    <!-- 其他入 -->
    <select id="selectOutIntoWhsIn" resultType="InvtyTab">
        SELECT * from(
        SELECT
        oth_out_into_whs.whs_encd whs_encd,
        oth_out_into_whs_sub_tab.invty_encd invty_encd,
        oth_out_into_whs_sub_tab.bat_num bat_num,
        sum(oth_out_into_whs_sub_tab.qty) qty
        FROM
        oth_out_into_whs
        JOIN
        oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num
        AND oth_out_into_whs.is_nt_chk = 0
        and oth_out_into_whs.in_status IS NOT NULL
        )
        GROUP BY
        whs_encd,invty_encd,bat_num) a
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND to_gds_sngl.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND to_gds_sngl.setup_tm &lt;= #{formDt2}
            </if>
        </where>

    </select>

    <!-- 到货单 未审 -->
    <select id="selectToGdsSngl" resultType="InvtyTab">
        SELECT
        to_gds_sngl_sub.whs_encd whs_encd,
        to_gds_sngl_sub.invty_encd
        invty_encd,
        SUM(to_gds_sngl_sub.qty)
        aval_qty,
        to_gds_sngl_sub.bat_num
        bat_num
        FROM
        to_gds_sngl
        LEFT JOIN
        to_gds_sngl_sub ON (
        to_gds_sngl.to_gds_sngl_id =
        to_gds_sngl_sub.to_gds_sngl_id
        AND
        to_gds_sngl.is_nt_chk = 0
        ) LEFT JOIN invty_doc ON (
        to_gds_sngl_sub.invty_encd = invty_doc.invty_encd
        )
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and to_gds_sngl_sub.whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND to_gds_sngl_sub.invty_encd = #{invtyEncd}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND to_gds_sngl_sub.bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND to_gds_sngl.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND to_gds_sngl.setup_tm &lt;= #{formDt2}
            </if>
        </where>
        GROUP BY
        whs_encd,
        invty_encd,
        bat_num


    </select>
    <!-- 销售单 -->
    <select id="selectSellSngl" resultType="InvtyTab">
        SELECT * from(
        SELECT
        sell_sngl_sub.whs_encd whs_encd,
        sell_sngl_sub.invty_encd invty_encd,
        SUM(sell_sngl_sub.qty) aval_qty,
        sell_sngl_sub.bat_num bat_num
        FROM
        sell_sngl
        JOIN sell_sngl_sub ON (
        sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
        AND
        sell_sngl.is_nt_chk = 0
        ) GROUP BY
        whs_encd,
        invty_encd,
        bat_num
        ) a
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_sngl.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND sell_sngl.setup_tm &lt;= #{formDt2}
            </if>
        </where>


    </select>
    <!-- 销售出 未审 -->
    <select id="selectSellOutWhs" resultType="InvtyTab">
        SELECT
        sell_out_whs_sub.whs_encd whs_encd,
        sell_out_whs_sub.invty_encd
        invty_encd,
        SUM(sell_out_whs_sub.qty)
        aval_qty,
        sell_out_whs_sub.bat_num
        bat_num
        FROM
        sell_out_whs
        LEFT JOIN
        sell_out_whs_sub ON (
        sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id
        AND
        sell_out_whs.is_nt_chk = 0
        )LEFT JOIN invty_doc ON (
        sell_out_whs_sub.invty_encd = invty_doc.invty_encd
        )
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and sell_out_whs_sub.whs_encd = #{whsEncd}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND sell_out_whs_sub.invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND sell_out_whs_sub.bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND sell_out_whs.setup_tm &lt;= #{formDt2}
            </if>
        </where>


    </select>
    <!-- 调拨转出仓库 -->
    <select id="selectCannibSngl" resultType="InvtyTab">
        SELECT * from(
        SELECT
        cannib_sngl.tran_out_whs_encd whs_encd,
        cannib_sngl_sub_tab.invty_id invty_encd,
        SUM(cannib_sngl_sub_tab.cannib_qty) aval_qty,
        cannib_sngl_sub_tab.bat_num bat_num
        FROM
        cannib_sngl
        JOIN
        cannib_sngl_sub_tab ON (
        cannib_sngl.form_num =
        cannib_sngl_sub_tab.form_num
        AND cannib_sngl.is_nt_chk = 0
        )
        GROUP BY
        whs_encd,
        invty_encd,
        bat_num
        ) a
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND cannib_sngl.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND cannib_sngl.setup_tm &lt;= #{formDt2}
            </if>
        </where>


    </select>
    <!-- 采购入 -->
    <select id="selectIntoWhsSub" resultType="InvtyTab">
        SELECT * from(

        SELECT
        into_whs_sub.whs_encd whs_encd,
        into_whs_sub.invty_encd invty_encd,
        SUM(into_whs_sub.qty) aval_qty,
        into_whs_sub.bat_num bat_num
        FROM
        into_whs
        LEFT JOIN into_whs_sub ON (
        into_whs.into_whs_sngl_id = into_whs_sub.into_whs_sngl_id
        AND
        into_whs.is_nt_chk = 0
        AND into_whs_sub.is_nt_rtn_goods =1
        )
        GROUP BY
        whs_encd,
        invty_encd,
        bat_num) a
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND into_whs.setup_tm &lt;= #{formDt2}
            </if>
        </where>
    </select>
    <!-- 采购退 -->
    <select id="selectNoIntoWhsSub" resultType="InvtyTab">
        SELECT * from(

        SELECT
        into_whs_sub.whs_encd whs_encd,
        into_whs_sub.invty_encd invty_encd,
        SUM(into_whs_sub.qty) aval_qty,
        into_whs_sub.bat_num bat_num
        FROM
        into_whs
        LEFT JOIN into_whs_sub ON (
        into_whs.into_whs_sngl_id = into_whs_sub.into_whs_sngl_id
        AND
        into_whs.is_nt_chk = 0
        AND into_whs_sub.is_nt_rtn_goods =0
        )
        GROUP BY
        whs_encd,
        invty_encd,
        bat_num) a
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                and whs_encd = #{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd = #{invtyEncd}
            </if>

            <if test="batNum != null and batNum != ''">
                AND bat_num = #{batNum}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.setup_tm &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND into_whs.setup_tm &lt;= #{formDt2}
            </if>
        </where>


    </select>
    <!-- select * from invty_tab as it, invty_doc as id, whs_doc as wd, measr_corp_doc
		as mDoc -->
    <!-- 查询所有出入量 -->
    <select id="selectExtantQtyList" resultType="NowStokReport">
    SELECT
	SUM( a.sellWhsQty ) sellWhsQty,
	SUM( a.intoWhsQty ) intoWhsQty,
	SUM( a.othOutQty ) othOutQty,
	SUM( a.othIntoQty ) othIntoQty,
	SUM( a.cannibIntoQty ) cannibIntoQty,
	SUM( a.cannibOutQty ) cannibOutQty,
	SUM( a.inTransitQty ) inTransitQty,
	invty_tab.whs_Encd whsEncd,
	invty_tab.invty_Encd invtyEncd,
	invty_tab.bat_Num batNum,
	invty_tab.now_stok nowStok,
	invty_tab.aval_qty avalQty,
	invty_tab.prdc_dt prdcDt,
	invty_tab.invldtn_dt invldtnDt,
	invty_tab.bao_zhi_qi baoZhiQi,
	invty_tab.un_tax_uprc unTaxUprc,
	invty_tab.cntn_tax_uprc cntnTaxUprc,
	invty_tab.un_tax_amt unTaxAmt,
	invty_tab.cntn_tax_amt cntnTaxAmt,
	invty_doc.measr_corp_id measrCorpId,
	measr_corp_doc.measr_corp_nm measrCorpNm,
	invty_doc.lo_sell_prc loSellPrc,
	invty_doc.weight weight,
	invty_doc.bx_rule bxRule,
	invty_doc.vol vol,
	invty_doc.spc_model spcModel,
	invty_doc.ref_cost refCost,
	invty_doc.ref_sell_prc refSellPrc,
	invty_doc.invty_cd invtyCd,
	invty_doc.invty_nm invtyNm,
	whs_doc.whs_nm whsNm 
FROM
 (		
	SELECT NULL
		sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		NULL inTransitQty,
		invty_tab.whs_encd whsEncd,
		invty_tab.invty_encd invtyEncd,
		invty_tab.bat_Num batNum 
	FROM
		invty_tab
	        <where>
            <if test="whsEncd != null and whsEncd.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND invty_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>

            <if test="batNum != null and batNum.size() >0">
                AND invty_tab.bat_Num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </where>
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum 
		UNION ALL
	SELECT
		NULL sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		SUM( oth_out_into_whs_sub_tab.qty ) inTransitQty,
		intowhs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum 
	FROM
		oth_out_into_whs outwhs
		JOIN oth_out_into_whs intowhs ON (
			outwhs.src_form_num = intowhs.src_form_num 
			AND intowhs.out_into_whs_typ_id = '1'
			AND intowhs.is_nt_chk = '0' 
			AND outwhs.out_into_whs_typ_id = '2' 
			AND outwhs.is_nt_chk = '1' 
		)
		JOIN oth_out_into_whs_sub_tab ON ( intowhs.form_num = oth_out_into_whs_sub_tab.form_num
	        <if test="whsEncd != null and whsEncd.size() >0">
            and intowhs.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and intowhs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND oth_out_into_whs_sub_tab.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND oth_out_into_whs_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT
		NULL sellWhsQty,
		NULL intoWhsQty,
		SUM( oth_out_into_whs_sub_tab.qty ) othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		null inTransitQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum 
	FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = '0' AND form_typ_encd = '015' 
			        <if test="whsEncd != null and whsEncd.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND oth_out_into_whs_sub_tab.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND oth_out_into_whs_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT  
		NULL sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		SUM( oth_out_into_whs_sub_tab.qty ) cannibOutQty,
		NULL cannibIntoQty,
		null inTransitQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum 
	FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = '0' AND out_into_whs_typ_id = '2' 
		<if test="whsEncd != null and whsEncd.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND oth_out_into_whs_sub_tab.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND oth_out_into_whs_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
		) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT  
		NULL sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		SUM( oth_out_into_whs_sub_tab.qty ) cannibIntoQty,
		null inTransitQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum 
	FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = '0' AND out_into_whs_typ_id = '1'
	
        <if test="whsEncd != null and whsEncd.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND oth_out_into_whs_sub_tab.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND oth_out_into_whs_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>	) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT  
		NULL sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		SUM( oth_out_into_whs_sub_tab.qty ) othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		null inTransitQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum 
	FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = '0' AND form_typ_encd = '014' 
		
		
					        <if test="whsEncd != null and whsEncd.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND oth_out_into_whs_sub_tab.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND oth_out_into_whs_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT  
		SUM( sell_out_whs_sub.qty ) sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		null inTransitQty,
		sell_out_whs_sub.whs_encd whsEncd,
		sell_out_whs_sub.invty_encd invtyEncd,
		sell_out_whs_sub.bat_Num batNum 
	FROM
		sell_out_whs
		JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = '0' 
		
		<if test="whsEncd != null and whsEncd.size() >0">
            and sell_out_whs_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and sell_out_whs_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND sell_out_whs_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND sell_out_whs_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
		) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT
		NULL sellWhsQty,
		SUM( into_whs_sub.qty ) intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		null inTransitQty,
		into_whs_sub.whs_encd whsEncd,
		into_whs_sub.invty_encd invtyEncd,
		into_whs_sub.bat_Num batNum 
	FROM
		into_whs
		JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id = into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = '0' 
		<if test="whsEncd != null and whsEncd.size() >0">
            and into_whs_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and into_whs_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND into_whs_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND into_whs_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
		
		) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum 
	) a 
	LEFT JOIN 
	invty_tab
	ON ( invty_tab.invty_encd = a.invtyEncd AND invty_tab.bat_Num = a.batNum AND invty_tab.whs_encd = a.whsEncd )
	LEFT JOIN invty_doc ON ( invty_doc.invty_encd = invty_tab.invty_Encd )
	LEFT JOIN measr_corp_doc ON ( invty_doc.measr_corp_id = measr_corp_doc.measr_corp_id )
	LEFT JOIN whs_doc ON ( whs_doc.whs_encd = invty_tab.whs_Encd ) 
	        <where>
            <if test="whsEncd != null and whsEncd.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND invty_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>

            <if test="batNum != null and batNum.size() >0">
                AND invty_tab.bat_Num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND invty_doc.invty_cls_encd like #{invtyClsEncd}
            </if>
            <if test="qty != null and qty != '' and  qty != 0 ">
                AND invty_tab.aval_qty != 0
            </if>
        </where>
		GROUP BY
			invty_tab.whs_Encd,
			invty_tab.invty_Encd,
			invty_tab.bat_Num
	
	    <if test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
        <if test="index != null and num != null ">
            LIMIT #{index},#{num}
        </if>
    <!-- 
        SELECT
        SUM(a.toSdsSnglQty) toSdsSnglQty,
        SUM(a.sellSnglQty) sellSnglQty,
        SUM(a.sellOutWhsQty) sellOutWhsQty,
        SUM(a.cannibSnglQty) cannibSnglQty,
        SUM(a.intoWhsQty) intoWhsQty,
        invty_tab.whs_Encd whsEncd,
        invty_tab.invty_Encd invtyEncd,
        invty_tab.bat_Num batNum,
        invty_tab.now_stok nowStok,
        invty_tab.aval_qty avalQty,
        invty_doc.invty_nm invtyNm,
        whs_doc.whs_nm whsNm
        FROM
        invty_tab

        LEFT JOIN (
        SELECT
        SUM(to_gds_sngl_sub.qty) toSdsSnglQty,
        NULL sellSnglQty,
        NULL
        sellOutWhsQty,
        NULL cannibSnglQty,
        NULL intoWhsQty,
        to_gds_sngl_sub.whs_encd whsEncd,
        to_gds_sngl_sub.invty_encd invtyEncd,
        to_gds_sngl_sub.bat_Num batNum
        FROM
        to_gds_sngl
        JOIN to_gds_sngl_sub ON (
        to_gds_sngl.to_gds_sngl_id = to_gds_sngl_sub.to_gds_sngl_id
        AND
        to_gds_sngl.is_nt_chk = 0
        <if test="whsEncd != null and whsEncd.size() >0">
            and to_gds_sngl_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and to_gds_sngl_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND to_gds_sngl_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND to_gds_sngl_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        )
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        UNION ALL
        SELECT
        NULL toSdsSnglQty,
        SUM(sell_sngl_sub.qty) sellSnglQty,
        NULL
        sellOutWhsQty,
        NULL cannibSnglQty,
        NULL intoWhsQty,
        sell_sngl_sub.whs_encd whsEncd,
        sell_sngl_sub.invty_Encd invtyEncd,
        sell_sngl_sub.bat_Num batNum
        FROM
        sell_sngl
        JOIN sell_sngl_sub ON (
        sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
        AND
        sell_sngl.is_nt_chk = 0
        <if test="whsEncd != null and whsEncd.size() >0">
            and sell_sngl_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and sell_sngl_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND sell_sngl_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND sell_sngl_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        )
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        UNION ALL
        SELECT
        NULL toSdsSnglQty,
        NULL sellSnglQty,
        SUM(sell_out_whs_sub.qty)
        sellOutWhsQty,
        NULL cannibSnglQty,
        NULL intoWhsQty,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd
        invtyEncd,
        sell_out_whs_sub.bat_Num batNum
        FROM
        sell_out_whs
        JOIN
        sell_out_whs_sub ON (
        sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id
        AND sell_out_whs.is_nt_chk = 0
        <if test="whsEncd != null and whsEncd.size() >0">
            and sell_out_whs_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and sell_out_whs_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND sell_out_whs_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND sell_out_whs_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        )
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        UNION ALL
        SELECT
        NULL toSdsSnglQty,
        NULL sellSnglQty,
        NULL sellOutWhsQty,
        SUM(
        cannib_sngl_sub_tab.cannib_qty
        ) cannibSnglQty,
        NULL intoWhsQty,
        cannib_sngl.tran_out_whs_encd whsEncd,
        cannib_sngl_sub_tab.invty_id invtyEncd,
        cannib_sngl_sub_tab.bat_Num
        batNum
        FROM
        cannib_sngl
        JOIN cannib_sngl_sub_tab ON (
        cannib_sngl.form_num =
        cannib_sngl_sub_tab.form_num
        AND
        cannib_sngl.is_nt_chk = 0
        <if test="whsEncd != null and whsEncd.size() >0">
            and cannib_sngl.tran_out_whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and cannib_sngl.tran_out_whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND cannib_sngl_sub_tab.invty_id in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND cannib_sngl_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        )
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        UNION ALL
        SELECT
        NULL toSdsSnglQty,
        NULL sellSnglQty,
        NULL sellOutWhsQty,
        NULL
        cannibSnglQty,
        SUM(into_whs_sub.qty)
        intoWhsQty,
        into_whs_sub.whs_encd
        whsEncd,
        into_whs_sub.invty_encd
        invtyEncd,
        into_whs_sub.bat_Num batNum
        FROM
        into_whs
        JOIN into_whs_sub ON (
        into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id
        AND into_whs.is_nt_chk = 0
        <if test="whsEncd != null and whsEncd.size() >0">
            and into_whs_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and into_whs_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND into_whs_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND into_whs_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        )
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ) a ON (
        invty_tab.invty_encd = a.invtyEncd
        AND
        invty_tab.bat_Num = a.batNum
        AND
        invty_tab.whs_encd = a.whsEncd
        )
        LEFT
        JOIN invty_doc ON (
        invty_doc.invty_encd = invty_tab.invty_Encd
        )
        LEFT JOIN whs_doc ON
        ( whs_doc.whs_encd =
        invty_tab.whs_Encd )
        <where>
            <if test="whsEncd != null and whsEncd.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND invty_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>

            <if test="batNum != null and batNum.size() >0">
                AND invty_tab.bat_Num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND invty_doc.invty_cls_encd like #{invtyClsEncd}
            </if>
            不等于0 非零
            <if test="qty != null and qty != '' and  qty != 0 ">
                AND invty_tab.aval_qty != 0
            </if>
        </where>

        GROUP BY
        invty_tab.whs_Encd,
        invty_tab.invty_Encd,
        invty_tab.bat_Num -->
    </select>
    <select id="selectExtantQtyCount" resultType="int">

        SELECT
        count(*)
        FROM
        (
    SELECT
	SUM( a.sellWhsQty ) sellWhsQty,
	SUM( a.intoWhsQty ) intoWhsQty,
	SUM( a.othOutQty ) othOutQty,
	SUM( a.othIntoQty ) othIntoQty,
	SUM( a.cannibIntoQty ) cannibIntoQty,
	SUM( a.cannibOutQty ) cannibOutQty,
	SUM( a.inTransitQty ) inTransitQty,
	invty_tab.whs_Encd whsEncd,
	invty_tab.invty_Encd invtyEncd,
	invty_tab.bat_Num batNum,
	invty_tab.now_stok nowStok,
	invty_tab.aval_qty avalQty,
	invty_tab.prdc_dt prdcDt,
	invty_tab.invldtn_dt invldtnDt,
	invty_tab.bao_zhi_qi baoZhiQi,
	invty_tab.un_tax_uprc unTaxUprc,
	invty_tab.cntn_tax_uprc cntnTaxUprc,
	invty_tab.un_tax_amt unTaxAmt,
	invty_tab.cntn_tax_amt cntnTaxAmt,
	invty_doc.measr_corp_id measrCorpId,
	measr_corp_doc.measr_corp_nm measrCorpNm,
	invty_doc.lo_sell_prc loSellPrc,
	invty_doc.weight weight,
	invty_doc.bx_rule bxRule,
	invty_doc.vol vol,
	invty_doc.spc_model spcModel,
	invty_doc.ref_cost refCost,
	invty_doc.ref_sell_prc refSellPrc,
	invty_doc.invty_cd invtyCd,
	invty_doc.invty_nm invtyNm,
	whs_doc.whs_nm whsNm 
FROM
 (		
	SELECT NULL
		sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		NULL inTransitQty,
		invty_tab.whs_encd whsEncd,
		invty_tab.invty_encd invtyEncd,
		invty_tab.bat_Num batNum 
	FROM
		invty_tab
	        <where>
            <if test="whsEncd != null and whsEncd.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND invty_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>

            <if test="batNum != null and batNum.size() >0">
                AND invty_tab.bat_Num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </where>
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum 
		UNION ALL
	SELECT
		NULL sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		SUM( oth_out_into_whs_sub_tab.qty ) inTransitQty,
		intowhs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum 
	FROM
		oth_out_into_whs outwhs
		JOIN oth_out_into_whs intowhs ON (
			outwhs.src_form_num = intowhs.src_form_num 
			AND intowhs.out_into_whs_typ_id = '1'
			AND intowhs.is_nt_chk = '0' 
			AND outwhs.out_into_whs_typ_id = '2' 
			AND outwhs.is_nt_chk = '1' 
		)
		JOIN oth_out_into_whs_sub_tab ON ( intowhs.form_num = oth_out_into_whs_sub_tab.form_num
	        <if test="whsEncd != null and whsEncd.size() >0">
            and intowhs.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and intowhs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND oth_out_into_whs_sub_tab.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND oth_out_into_whs_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT
		NULL sellWhsQty,
		NULL intoWhsQty,
		SUM( oth_out_into_whs_sub_tab.qty ) othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		null inTransitQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum 
	FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = '0' AND form_typ_encd = '015' 
			        <if test="whsEncd != null and whsEncd.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND oth_out_into_whs_sub_tab.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND oth_out_into_whs_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT  
		NULL sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		SUM( oth_out_into_whs_sub_tab.qty ) cannibOutQty,
		NULL cannibIntoQty,
		null inTransitQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum 
	FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = '0' AND out_into_whs_typ_id = '2' 
		<if test="whsEncd != null and whsEncd.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND oth_out_into_whs_sub_tab.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND oth_out_into_whs_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
		) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT  
		NULL sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		SUM( oth_out_into_whs_sub_tab.qty ) cannibIntoQty,
		null inTransitQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum 
	FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = '0' AND out_into_whs_typ_id = '1'
	
        <if test="whsEncd != null and whsEncd.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND oth_out_into_whs_sub_tab.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND oth_out_into_whs_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>	) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT  
		NULL sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		SUM( oth_out_into_whs_sub_tab.qty ) othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		null inTransitQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum 
	FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = '0' AND form_typ_encd = '014' 
		
		
					        <if test="whsEncd != null and whsEncd.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and oth_out_into_whs.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND oth_out_into_whs_sub_tab.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND oth_out_into_whs_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT  
		SUM( sell_out_whs_sub.qty ) sellWhsQty,
		NULL intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		null inTransitQty,
		sell_out_whs_sub.whs_encd whsEncd,
		sell_out_whs_sub.invty_encd invtyEncd,
		sell_out_whs_sub.bat_Num batNum 
	FROM
		sell_out_whs
		JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = '0' 
		
		<if test="whsEncd != null and whsEncd.size() >0">
            and sell_out_whs_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and sell_out_whs_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND sell_out_whs_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND sell_out_whs_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
		) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
	SELECT
		NULL sellWhsQty,
		SUM( into_whs_sub.qty ) intoWhsQty,
		NULL othOutQty,
		NULL othIntoQty,
		NULL cannibOutQty,
		NULL cannibIntoQty,
		null inTransitQty,
		into_whs_sub.whs_encd whsEncd,
		into_whs_sub.invty_encd invtyEncd,
		into_whs_sub.bat_Num batNum 
	FROM
		into_whs
		JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id = into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = '0' 
		<if test="whsEncd != null and whsEncd.size() >0">
            and into_whs_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and into_whs_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND into_whs_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND into_whs_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
		
		) 
	GROUP BY
		whsEncd,
		invtyEncd,
		batNum 
	) a 
	LEFT JOIN 
	invty_tab
	ON ( invty_tab.invty_encd = a.invtyEncd AND invty_tab.bat_Num = a.batNum AND invty_tab.whs_encd = a.whsEncd )
	LEFT JOIN invty_doc ON ( invty_doc.invty_encd = invty_tab.invty_Encd )
	LEFT JOIN measr_corp_doc ON ( invty_doc.measr_corp_id = measr_corp_doc.measr_corp_id )
	LEFT JOIN whs_doc ON ( whs_doc.whs_encd = invty_tab.whs_Encd ) 
	        <where>
            <if test="whsEncd != null and whsEncd.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND invty_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>

            <if test="batNum != null and batNum.size() >0">
                AND invty_tab.bat_Num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND invty_doc.invty_cls_encd like #{invtyClsEncd}
            </if>
            <if test="qty != null and qty != '' and  qty != 0 ">
                AND invty_tab.aval_qty != 0
            </if>
        </where>
		GROUP BY
			invty_tab.whs_Encd,
			invty_tab.invty_Encd,
			invty_tab.bat_Num
	



        ) g
    </select>
    <select id="selectWhsSub" parameterType="NowStokReport"
            resultType="NowStokReport">


        SELECT whs_nm,
               invty_nm
        FROM whs_doc
                 JOIN invty_doc ON (
                whs_doc.whs_encd = #{whsEncd}
                AND invty_doc.invty_encd = #{invtyEncd})

    </select>

    <select id="selectTSummaryWhs"
            parameterType="TransceiverSummaryReport"
            resultType="TransceiverSummaryReport">


        SELECT whs_nm,
               invty_nm
        FROM whs_doc
                 JOIN invty_doc ON (
                whs_doc.whs_encd = #{whsEncd}
                AND invty_doc.invty_encd = #{invtyEncd})

    </select>


    <select id="selectExtantQtySUM" parameterType="Map"
            resultType="NowStokReport">
        SELECT
        SUM(toSdsSnglQty) toSdsSnglQty,
        SUM(sellSnglQty) sellSnglQty,
        SUM(sellOutWhsQty) sellOutWhsQty,
        SUM(cannibSnglQty) cannibSnglQty,
        SUM(intoWhsQty) intoWhsQty,
        null whsEncd,
        null invtyEncd,
        null batNum,
        COUNT(*) nowStok,
        null avalQty,
        null invtyNm,
        null whsNm
        FROM(
        SELECT

        SUM(a.toSdsSnglQty) toSdsSnglQty,
        SUM(a.sellSnglQty) sellSnglQty,
        SUM(a.sellOutWhsQty) sellOutWhsQty,
        SUM(a.cannibSnglQty) cannibSnglQty,
        SUM(a.intoWhsQty) intoWhsQty,
        invty_tab.whs_Encd whsEncd,
        invty_tab.invty_Encd invtyEncd,
        invty_tab.bat_Num batNum
        FROM
        invty_tab
        LEFT JOIN (
        SELECT
        SUM(to_gds_sngl_sub.qty) toSdsSnglQty,
        NULL sellSnglQty,
        NULL
        sellOutWhsQty,
        NULL cannibSnglQty,
        NULL intoWhsQty,
        to_gds_sngl_sub.whs_encd whsEncd,
        to_gds_sngl_sub.invty_encd invtyEncd,
        to_gds_sngl_sub.bat_Num batNum
        FROM
        to_gds_sngl
        JOIN to_gds_sngl_sub ON (
        to_gds_sngl.to_gds_sngl_id = to_gds_sngl_sub.to_gds_sngl_id
        AND
        to_gds_sngl.is_nt_chk = 0
        <if test="whsEncd != null and whsEncd.size() >0">
            and to_gds_sngl_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and to_gds_sngl_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND to_gds_sngl_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND to_gds_sngl_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        )
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        UNION ALL
        SELECT
        NULL toSdsSnglQty,
        SUM(sell_sngl_sub.qty) sellSnglQty,
        NULL
        sellOutWhsQty,
        NULL cannibSnglQty,
        NULL intoWhsQty,
        sell_sngl_sub.whs_encd whsEncd,
        sell_sngl_sub.invty_Encd invtyEncd,
        sell_sngl_sub.bat_Num batNum
        FROM
        sell_sngl
        JOIN sell_sngl_sub ON (
        sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
        AND
        sell_sngl.is_nt_chk = 0
        <if test="whsEncd != null and whsEncd.size() >0">
            and sell_sngl_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and sell_sngl_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND sell_sngl_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND sell_sngl_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        )
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        UNION ALL
        SELECT
        NULL toSdsSnglQty,
        NULL sellSnglQty,
        SUM(sell_out_whs_sub.qty)
        sellOutWhsQty,
        NULL cannibSnglQty,
        NULL intoWhsQty,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd
        invtyEncd,
        sell_out_whs_sub.bat_Num batNum
        FROM
        sell_out_whs
        JOIN
        sell_out_whs_sub ON (
        sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id
        AND sell_out_whs.is_nt_chk = 0
        <if test="whsEncd != null and whsEncd.size() >0">
            and sell_out_whs_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and sell_out_whs_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND sell_out_whs_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND sell_out_whs_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        )
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        UNION ALL
        SELECT
        NULL toSdsSnglQty,
        NULL sellSnglQty,
        NULL sellOutWhsQty,
        SUM(
        cannib_sngl_sub_tab.cannib_qty
        ) cannibSnglQty,
        NULL intoWhsQty,
        cannib_sngl.tran_out_whs_encd whsEncd,
        cannib_sngl_sub_tab.invty_id invtyEncd,
        cannib_sngl_sub_tab.bat_Num
        batNum
        FROM
        cannib_sngl
        JOIN cannib_sngl_sub_tab ON (
        cannib_sngl.form_num =
        cannib_sngl_sub_tab.form_num
        AND
        cannib_sngl.is_nt_chk = 0
        <if test="whsEncd != null and whsEncd.size() >0">
            and cannib_sngl.tran_out_whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and cannib_sngl.tran_out_whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND cannib_sngl_sub_tab.invty_id in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND cannib_sngl_sub_tab.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        )
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        UNION ALL
        SELECT
        NULL toSdsSnglQty,
        NULL sellSnglQty,
        NULL sellOutWhsQty,
        NULL
        cannibSnglQty,
        SUM(into_whs_sub.qty)
        intoWhsQty,
        into_whs_sub.whs_encd
        whsEncd,
        into_whs_sub.invty_encd
        invtyEncd,
        into_whs_sub.bat_Num batNum
        FROM
        into_whs
        JOIN into_whs_sub ON (
        into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id
        AND into_whs.is_nt_chk = 0
        <if test="whsEncd != null and whsEncd.size() >0">
            and into_whs_sub.whs_encd in
            <foreach collection="whsEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="whsId != null and whsId.size() >0">
            and into_whs_sub.whs_encd in
            <foreach collection="whsId" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="invtyEncd != null and invtyEncd.size() >0">
            AND into_whs_sub.invty_encd in
            <foreach collection="invtyEncd" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="batNum != null and batNum.size() >0">
            AND into_whs_sub.bat_Num in
            <foreach collection="batNum" item="item"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        )
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum
        ) a ON (
        invty_tab.invty_encd = a.invtyEncd
        AND
        invty_tab.bat_Num = a.batNum
        AND
        invty_tab.whs_encd = a.whsEncd
        )
        LEFT
        JOIN invty_doc ON (
        invty_doc.invty_encd = invty_tab.invty_Encd
        )
        <where>
            <if test="whsEncd != null and whsEncd.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                and invty_tab.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND invty_tab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>

            <if test="batNum != null and batNum.size() >0">
                AND invty_tab.bat_Num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd.size() >0">
                AND invty_doc.invty_cls_encd in
                <foreach collection="invtyClsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <!-- 不等于0 非零 -->
            <if test="qty != null and qty != '' and  qty != 0 ">
                AND invty_tab.aval_qty != 0
            </if>
        </where>

        GROUP BY
        invty_tab.whs_Encd,
        invty_tab.invty_Encd,
        invty_tab.bat_Num
        )s

    </select>


    <!-- 出入库流水 -->
    <!-- 日期、单据号、单据类型（销售出库）、仓库、收发类别（线上销售）、 客户（JD/美素佳儿旗舰店）、备注、制单人、审核人、审核日期、存货编码、存货名称、
		规格型号、批号、客户订单号（无）、供应商订单号（无）、主计量单位、入库数量（无）、 出库数量 （无）、出库单价 入库单价 -->
    <sql id="in_Column_List"><!-- 采购入 19 -->

        iWhs.into_whs_sngl_id formNum,

        iWhs.into_whs_dt formDt,

        iWhs.memo memo,

        iWhs.setup_pers setupPers,

        iWhs.chkr chkr,

        iWhs.chk_tm chkTm,

        iWhsSub.bat_num batNum,

        iWhsSub.qty qty,

        iWhsSub.no_tax_uprc noTaxUprc,

        outInType.out_into_whs_typ_nm outIntoWhsTypNm,

        wDoc.whs_nm whsNm,

        rCate.recv_send_cate_nm recvSendCateNm,

        pDoc.provr_nm custNm,

        iDoc.invty_encd invtyEncd,

        iDoc.invty_nm invtyNm,

        iDoc.spc_model
        spcModel,

        mDoc.measr_corp_nm measrCorpNm

        <!-- iWhs.into_whs_sngl_id,iWhs.into_whs_dt,iWhs.memo,iWhs.setup_pers,
			iWhs.chkr,iWhs.chk_tm, iWhsSub.bat_num,iWhsSub.qty,iWhsSub.no_tax_uprc 无税单价
			, outInType.out_into_whs_typ_nm, wDoc.whs_nm, rCate.recv_send_cate_nm, pDoc.provr_nm,
			供应商 iDoc.invty_encd,iDoc.invty_nm,iDoc.spc_model, 供应商订单号 mDoc.measr_corp_nm -->
    </sql>
    <sql id="out_Column_List"><!-- 销售出 19 -->
        sWhs.out_whs_id formNum,
        sWhs.out_whs_dt formDt,
        sWhs.memo memo,
        sWhs.setup_pers setupPers,
        sWhs.chkr chkr,
        sWhs.chk_tm chkTm,
        sWhsSub.bat_num batNum,
        sWhsSub.qty qty,
        sWhsSub.no_tax_uprc noTaxUprc,
        outInType.out_into_whs_typ_nm outIntoWhsTypNm,
        wDoc.whs_nm whsNm,
        rCate.recv_send_cate_nm recvSendCateNm,
        cDoc.cust_nm custNm,
        iDoc.invty_encd invtyEncd,
        iDoc.invty_nm invtyNm,
        iDoc.spc_model
        spcModel,
        mDoc.measr_corp_nm measrCorpNm
        <!-- sWhs.out_whs_id,sWhs.out_whs_dt,sWhs.memo,sWhs.setup_pers, sWhs.chkr,sWhs.chk_tm,
			sWhsSub.bat_num,sWhsSub.qty,sWhsSub.no_tax_uprc 无税单价 , outInType.out_into_whs_typ_nm,
			wDoc.whs_nm, rCate.recv_send_cate_nm, cDoc.cust_nm, 客户名称 iDoc.invty_encd,iDoc.invty_nm,iDoc.spc_model,
			客户订单号 mDoc.measr_corp_nm -->
    </sql>
    <sql id="in_out_Column_List"><!-- 其他出入库 19 -->
        outInWhs.form_num formNum,
        outInWhs.form_dt formDt,
        outInWhs.memo memo,
        outInWhs.setup_pers setupPers,
        outInWhs.chkr chkr,
        outInWhs.chk_tm
        chkTm,
        outInWhsTab.bat_num batNum,
        outInWhsTab.qty qty,
        outInWhsTab.un_tax_uprc noTaxUprc,
        outInType.out_into_whs_typ_nm
        outIntoWhsTypNm,
        wDoc.whs_nm whsNm,
        wDoc.whs_encd recvSendCateNm,
        wDoc.tel custNm,
        iDoc.invty_encd invtyEncd,
        iDoc.invty_nm invtyNm,
        iDoc.spc_model spcModel,
        mDoc.measr_corp_nm measrCorpNm
        <!-- outInWhs.form_num,outInWhs.form_dt,outInWhs.memo,outInWhs.setup_pers,
			outInWhs.chkr,outInWhs.chk_tm, outInWhsTab.bat_num,outInWhsTab.qty,outInWhsTab.un_tax_uprc
			未税单价 , outInType.out_into_whs_typ_nm, wDoc.whs_nm, wDoc.whs_encd, 当做收发类别
			wDoc.tel, 当做客户 iDoc.invty_encd,iDoc.invty_nm,iDoc.spc_model, 客户订单号,供应商订单号,
			mDoc.measr_corp_nm -->
    </sql>
    <select id="selectOutIngWaterSUM"
            resultType="OutIngWaterReport">
        SELECT

        null formNum,
        null formDt,
        null memo,
        null setupPers,
        null chkr,
        null chkTm,
        null batNum,
        null qty,
        null noTaxUprc,
        null outIntoWhsTypNm,
        null whsNm,
        null recvSendCateNm,
        null custNm,
        null invtyEncd,
        null invtyNm,
        null spcModel,
        null measrCorpNm,
        null formTypName,
        null formTypEncd ,
        null outIntoWhsTypEncd,
        sum(outQty) outQty,
        sum(intoQty) intoQty,
        null outNoTaxUprc,
        null intoNoTaxUprc

        FROM(
        (
        SELECT
        iWhs.into_whs_sngl_id formNum,
        iWhs.into_whs_dt formDt,
        iWhs.memo memo,
        iWhs.setup_pers setupPers,
        iWhs.chkr chkr,
        iWhs.chk_tm chkTm,
        iWhsSub.bat_num batNum,
        iWhsSub.qty qty,
        iWhsSub.no_tax_uprc noTaxUprc,
        outInType.out_into_whs_typ_nm outIntoWhsTypNm,
        wDoc.whs_nm whsNm,
        rCate.recv_send_cate_nm recvSendCateNm,
        pDoc.provr_nm custNm,
        iDoc.invty_encd invtyEncd,
        iDoc.invty_nm invtyNm,
        iDoc.spc_model spcModel,
        mDoc.measr_corp_nm measrCorpNm,
        fTyp.form_typ_name formTypName,
        iWhs.form_typ_encd formTypEncd ,
        iWhs.out_into_whs_typ_id outIntoWhsTypEncd,
        null outQty,
        iWhsSub.qty intoQty,
        null outNoTaxUprc,
        iWhsSub.no_tax_uprc intoNoTaxUprc

        FROM
        into_whs AS iWhs
        JOIN into_whs_sub AS iWhsSub ON iWhs.into_whs_sngl_id =
        iWhsSub.into_whs_sngl_id
        LEFT JOIN out_into_whs_typ AS outInType ON iWhs.out_into_whs_typ_id =
        outInType.out_into_whs_typ_id
        LEFT JOIN recv_send_cate AS rCate ON iWhs.recv_send_cate_id =
        rCate.recv_send_cate_id
        LEFT JOIN whs_doc AS wDoc ON iWhsSub.whs_encd = wDoc.whs_encd
        LEFT JOIN invty_doc AS iDoc ON iDoc.invty_encd = iWhsSub.invty_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN provr_doc AS pDoc ON iWhs.provr_id = pDoc.provr_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd = iWhs.form_typ_encd
        <where>
            <if test="formDt1 != null and formDt1 != ''">
                AND iWhs.into_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND iWhs.into_whs_dt &lt;= #{formDt2}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND iWhs.into_whs_sngl_id in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND iWhsSub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND iWhsSub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND iWhsSub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd.size() >0">
                AND iDoc.invty_cls_encd in
                <foreach collection="invtyClsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND iWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND iWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND iWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND iWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND iWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND iWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )
        UNION ALL
        (
        SELECT
        sWhs.out_whs_id formNum,
        sWhs.out_whs_dt formDt,
        sWhs.memo memo,
        sWhs.setup_pers setupPers,
        sWhs.chkr chkr,
        sWhs.chk_tm chkTm,
        sWhsSub.bat_num batNum,
        sWhsSub.qty qty,
        sWhsSub.no_tax_uprc noTaxUprc,
        outInType.out_into_whs_typ_nm outIntoWhsTypNm,
        wDoc.whs_nm whsNm,
        rCate.recv_send_cate_nm recvSendCateNm,
        cDoc.cust_nm custNm,
        iDoc.invty_encd invtyEncd,
        iDoc.invty_nm invtyNm,
        iDoc.spc_model spcModel,
        mDoc.measr_corp_nm measrCorpNm,
        fTyp.form_typ_name formTypName,
        sWhs.form_typ_encd formTypEncd ,
        sWhs.out_into_whs_typ_id outIntoWhsTypEncd
        ,
        sWhsSub.qty outQty,
        null intoQty,
        sWhsSub.no_tax_uprc outNoTaxUprc,
        null intoNoTaxUprc
        FROM
        sell_out_whs AS sWhs
        JOIN sell_out_whs_sub AS sWhsSub ON sWhs.out_whs_id = sWhsSub.out_whs_id
        LEFT JOIN out_into_whs_typ AS outInType ON sWhs.out_into_whs_typ_id =
        outInType.out_into_whs_typ_id
        LEFT JOIN recv_send_cate AS rCate ON sWhs.recv_send_cate_id =
        rCate.recv_send_cate_id
        LEFT JOIN whs_doc AS wDoc ON sWhsSub.whs_encd = wDoc.whs_encd
        LEFT JOIN invty_doc AS iDoc ON sWhsSub.invty_encd = iDoc.invty_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN cust_doc AS cDoc ON sWhs.cust_id = cDoc.cust_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd = sWhs.form_typ_encd
        <where>

            <if test="formDt1 != null and formDt1 != ''">
                AND sWhs.out_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND sWhs.out_whs_dt &lt;= #{formDt2}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND sWhs.out_whs_id in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND sWhsSub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND sWhsSub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND sWhsSub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd.size() >0">
                AND iDoc.invty_cls_encd in
                <foreach collection="invtyClsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND sWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND sWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND sWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND sWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )
        UNION ALL
        (
        SELECT
        outInWhs.form_num formNum,
        outInWhs.form_dt formDt,
        outInWhs.memo memo,
        outInWhs.setup_pers setupPers,
        outInWhs.chkr chkr,
        outInWhs.chk_tm chkTm,
        outInWhsTab.bat_num batNum,
        outInWhsTab.qty qty,
        outInWhsTab.un_tax_uprc noTaxUprc,
        outInType.out_into_whs_typ_nm outIntoWhsTypNm,
        wDoc.whs_nm whsNm,
        "" recvSendCateNm,
        "" custNm,
        iDoc.invty_encd invtyEncd,
        iDoc.invty_nm invtyNm,
        iDoc.spc_model spcModel,
        mDoc.measr_corp_nm measrCorpNm,
        fTyp.form_typ_name formTypName,
        outInWhs.form_typ_encd formTypEncd ,
        outInWhs.out_into_whs_typ_id outIntoWhsTypEncd
        ,
        outInWhsTab.qty outQty,
        null intoQty,
        outInWhsTab.un_tax_uprc outNoTaxUprc,
        null intoNoTaxUprc
        FROM
        oth_out_into_whs AS outInWhs
        JOIN oth_out_into_whs_sub_tab AS outInWhsTab ON outInWhs.form_num =
        outInWhsTab.form_num
        AND outInWhs.form_typ_encd = "015"
        LEFT JOIN invty_doc AS iDoc ON outInWhsTab.invty_encd = iDoc.invty_encd
        LEFT JOIN out_into_whs_typ AS outInType ON
        outInWhs.out_into_whs_typ_id = outInType.out_into_whs_typ_id
        LEFT JOIN whs_doc AS wDoc ON outInWhs.whs_encd = wDoc.whs_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd =
        outInWhs.form_typ_encd
        <where>

            <if test="formDt1 != null and formDt1 != ''">
                AND outInWhs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND outInWhs.form_dt &lt;= #{formDt2}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND outInWhs.form_num in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND outInWhsTab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND outInWhs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND outInWhsTab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd.size() >0">
                AND iDoc.invty_cls_encd in
                <foreach collection="invtyClsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND outInWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND outInWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND outInWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND outInWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND outInWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND outInWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )


        UNION ALL
        (
        SELECT
        outInWhs.form_num formNum,
        outInWhs.form_dt formDt,
        outInWhs.memo memo,
        outInWhs.setup_pers setupPers,
        outInWhs.chkr chkr,
        outInWhs.chk_tm chkTm,
        outInWhsTab.bat_num batNum,
        outInWhsTab.qty qty,
        outInWhsTab.un_tax_uprc noTaxUprc,
        outInType.out_into_whs_typ_nm outIntoWhsTypNm,
        wDoc.whs_nm whsNm,
        "" recvSendCateNm,
        "" custNm,
        iDoc.invty_encd invtyEncd,
        iDoc.invty_nm invtyNm,
        iDoc.spc_model spcModel,
        mDoc.measr_corp_nm measrCorpNm,
        fTyp.form_typ_name formTypName,
        outInWhs.form_typ_encd formTypEncd ,
        outInWhs.out_into_whs_typ_id outIntoWhsTypEncd
        ,
        null outQty,
        outInWhsTab.qty intoQty,
        null outNoTaxUprc,
        outInWhsTab.un_tax_uprc intoNoTaxUprc
        FROM
        oth_out_into_whs AS outInWhs
        JOIN oth_out_into_whs_sub_tab AS outInWhsTab ON outInWhs.form_num =
        outInWhsTab.form_num
        AND outInWhs.form_typ_encd = "014"
        LEFT JOIN invty_doc AS iDoc ON outInWhsTab.invty_encd = iDoc.invty_encd
        LEFT JOIN out_into_whs_typ AS outInType ON
        outInWhs.out_into_whs_typ_id = outInType.out_into_whs_typ_id
        LEFT JOIN whs_doc AS wDoc ON outInWhs.whs_encd = wDoc.whs_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd =
        outInWhs.form_typ_encd
        <where>

            <if test="formDt1 != null and formDt1 != ''">
                AND outInWhs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND outInWhs.form_dt &lt;= #{formDt2}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND outInWhs.form_num in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND outInWhsTab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND outInWhs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND outInWhsTab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd.size() >0">
                AND iDoc.invty_cls_encd in
                <foreach collection="invtyClsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND outInWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND outInWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND outInWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND outInWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND outInWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND outInWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )

        ) as a
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>

    </select>
    <select id="selectOutIngWaterList"
            resultType="OutIngWaterReport">
        SELECT * FROM(
        (
        SELECT
        iWhs.into_whs_sngl_id formNum,
        iWhs.into_whs_dt formDt,
        iWhs.memo memo,
        iWhs.setup_pers setupPers,
        iWhs.chkr chkr,
        iWhs.chk_tm chkTm,
        iWhsSub.bat_num batNum,
        iWhsSub.qty qty,
        iWhsSub.no_tax_uprc noTaxUprc,
        outInType.out_into_whs_typ_nm outIntoWhsTypNm,
        wDoc.whs_nm whsNm,
        rCate.recv_send_cate_nm recvSendCateNm,
        pDoc.provr_nm custNm,
        iDoc.invty_encd invtyEncd,
        iDoc.invty_nm invtyNm,
        iDoc.spc_model spcModel,
        mDoc.measr_corp_nm measrCorpNm,
        fTyp.form_typ_name formTypName,
        iWhs.form_typ_encd formTypEncd ,
        iWhs.out_into_whs_typ_id outIntoWhsTypEncd,
        null outQty,
        iWhsSub.qty intoQty,
        null outNoTaxUprc,
        iWhsSub.no_tax_uprc intoNoTaxUprc

        FROM
        into_whs AS iWhs
        JOIN into_whs_sub AS iWhsSub ON iWhs.into_whs_sngl_id =
        iWhsSub.into_whs_sngl_id
        LEFT JOIN out_into_whs_typ AS outInType ON iWhs.out_into_whs_typ_id =
        outInType.out_into_whs_typ_id
        LEFT JOIN recv_send_cate AS rCate ON iWhs.recv_send_cate_id =
        rCate.recv_send_cate_id
        LEFT JOIN whs_doc AS wDoc ON iWhsSub.whs_encd = wDoc.whs_encd
        LEFT JOIN invty_doc AS iDoc ON iDoc.invty_encd = iWhsSub.invty_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN provr_doc AS pDoc ON iWhs.provr_id = pDoc.provr_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd = iWhs.form_typ_encd
        <where>
            and is_nt_chk = 1
            <if test="formDt1 != null and formDt1 != ''">
                AND iWhs.into_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND iWhs.into_whs_dt &lt;= #{formDt2}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND iWhs.into_whs_sngl_id in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND iWhsSub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND iWhsSub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND iWhsSub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND iWhsSub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND iDoc.invty_cls_encd like #{invtyClsEncd}
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND iWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND iWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND iWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND iWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND iWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND iWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )
        UNION ALL
        (
        SELECT
        sWhs.out_whs_id formNum,
        sWhs.out_whs_dt formDt,
        sWhs.memo memo,
        sWhs.setup_pers setupPers,
        sWhs.chkr chkr,
        sWhs.chk_tm chkTm,
        sWhsSub.bat_num batNum,
        sWhsSub.qty qty,
        sWhsSub.no_tax_uprc noTaxUprc,
        outInType.out_into_whs_typ_nm outIntoWhsTypNm,
        wDoc.whs_nm whsNm,
        rCate.recv_send_cate_nm recvSendCateNm,
        cDoc.cust_nm custNm,
        iDoc.invty_encd invtyEncd,
        iDoc.invty_nm invtyNm,
        iDoc.spc_model spcModel,
        mDoc.measr_corp_nm measrCorpNm,
        fTyp.form_typ_name formTypName,
        sWhs.form_typ_encd formTypEncd ,
        sWhs.out_into_whs_typ_id outIntoWhsTypEncd
        ,
        sWhsSub.qty outQty,
        null intoQty,
        sWhsSub.no_tax_uprc outNoTaxUprc,
        null intoNoTaxUprc
        FROM
        sell_out_whs AS sWhs
        JOIN sell_out_whs_sub AS sWhsSub ON sWhs.out_whs_id = sWhsSub.out_whs_id
        LEFT JOIN out_into_whs_typ AS outInType ON sWhs.out_into_whs_typ_id =
        outInType.out_into_whs_typ_id
        LEFT JOIN recv_send_cate AS rCate ON sWhs.recv_send_cate_id =
        rCate.recv_send_cate_id
        LEFT JOIN whs_doc AS wDoc ON sWhsSub.whs_encd = wDoc.whs_encd
        LEFT JOIN invty_doc AS iDoc ON sWhsSub.invty_encd = iDoc.invty_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN cust_doc AS cDoc ON sWhs.cust_id = cDoc.cust_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd = sWhs.form_typ_encd
        <where>
            and is_nt_chk = 1
            <if test="formDt1 != null and formDt1 != ''">
                AND sWhs.out_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND sWhs.out_whs_dt &lt;= #{formDt2}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND sWhs.out_whs_id in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND sWhsSub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND sWhsSub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND sWhsSub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND sWhsSub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND iDoc.invty_cls_encd like #{invtyClsEncd}
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND sWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND sWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND sWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND sWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )
        UNION ALL
        (
        SELECT
        outInWhs.form_num formNum,
        outInWhs.form_dt formDt,
        outInWhs.memo memo,
        outInWhs.setup_pers setupPers,
        outInWhs.chkr chkr,
        outInWhs.chk_tm chkTm,
        outInWhsTab.bat_num batNum,
        outInWhsTab.qty qty,
        outInWhsTab.un_tax_uprc noTaxUprc,
        outInType.out_into_whs_typ_nm outIntoWhsTypNm,
        wDoc.whs_nm whsNm,
        "" recvSendCateNm,
        "" custNm,
        iDoc.invty_encd invtyEncd,
        iDoc.invty_nm invtyNm,
        iDoc.spc_model spcModel,
        mDoc.measr_corp_nm measrCorpNm,
        fTyp.form_typ_name formTypName,
        outInWhs.form_typ_encd formTypEncd ,
        outInWhs.out_into_whs_typ_id outIntoWhsTypEncd
        ,
        outInWhsTab.qty outQty,
        null intoQty,
        outInWhsTab.un_tax_uprc outNoTaxUprc,
        null intoNoTaxUprc
        FROM
        oth_out_into_whs AS outInWhs
        JOIN oth_out_into_whs_sub_tab AS outInWhsTab ON outInWhs.form_num =
        outInWhsTab.form_num
        AND outInWhs.form_typ_encd = "015"
        LEFT JOIN invty_doc AS iDoc ON outInWhsTab.invty_encd = iDoc.invty_encd
        LEFT JOIN out_into_whs_typ AS outInType ON
        outInWhs.out_into_whs_typ_id = outInType.out_into_whs_typ_id
        LEFT JOIN whs_doc AS wDoc ON outInWhs.whs_encd = wDoc.whs_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd =
        outInWhs.form_typ_encd
        <where>
            and is_nt_chk = 1
            <if test="formDt1 != null and formDt1 != ''">
                AND outInWhs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND outInWhs.form_dt &lt;= #{formDt2}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND outInWhs.form_num in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND outInWhsTab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND outInWhs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND outInWhs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND outInWhsTab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND iDoc.invty_cls_encd like #{invtyClsEncd}
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND outInWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND outInWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND outInWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND outInWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND outInWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND outInWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )


        UNION ALL
        (
        SELECT
        outInWhs.form_num formNum,
        outInWhs.form_dt formDt,
        outInWhs.memo memo,
        outInWhs.setup_pers setupPers,
        outInWhs.chkr chkr,
        outInWhs.chk_tm chkTm,
        outInWhsTab.bat_num batNum,
        outInWhsTab.qty qty,
        outInWhsTab.un_tax_uprc noTaxUprc,
        outInType.out_into_whs_typ_nm outIntoWhsTypNm,
        wDoc.whs_nm whsNm,
        "" recvSendCateNm,
        "" custNm,
        iDoc.invty_encd invtyEncd,
        iDoc.invty_nm invtyNm,
        iDoc.spc_model spcModel,
        mDoc.measr_corp_nm measrCorpNm,
        fTyp.form_typ_name formTypName,
        outInWhs.form_typ_encd formTypEncd ,
        outInWhs.out_into_whs_typ_id outIntoWhsTypEncd
        ,
        null outQty,
        outInWhsTab.qty intoQty,
        null outNoTaxUprc,
        outInWhsTab.un_tax_uprc intoNoTaxUprc
        FROM
        oth_out_into_whs AS outInWhs
        JOIN oth_out_into_whs_sub_tab AS outInWhsTab ON outInWhs.form_num =
        outInWhsTab.form_num
        AND outInWhs.form_typ_encd = "014"
        LEFT JOIN invty_doc AS iDoc ON outInWhsTab.invty_encd = iDoc.invty_encd
        LEFT JOIN out_into_whs_typ AS outInType ON
        outInWhs.out_into_whs_typ_id = outInType.out_into_whs_typ_id
        LEFT JOIN whs_doc AS wDoc ON outInWhs.whs_encd = wDoc.whs_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd =
        outInWhs.form_typ_encd
        <where>
            and is_nt_chk = 1
            <if test="formDt1 != null and formDt1 != ''">
                AND outInWhs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND outInWhs.form_dt &lt;= #{formDt2}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND outInWhs.form_num in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND outInWhsTab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND outInWhs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND outInWhs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND outInWhsTab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND iDoc.invty_cls_encd like #{invtyClsEncd}
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND outInWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND outInWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND outInWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND outInWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND outInWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND outInWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )

        ) as a
        <where>
        <if test="memo != null and memo != ''">
            <bind name="memo" value="'%'+ memo +'%'"/>
            AND a.memo like #{memo}
        </if>
        </where>
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
        <if test="index != null and num != null ">
            LIMIT #{index},#{num}
        </if>
    </select>
    <select id="selectOutIngWater" resultType="InvtyStandReport">

        SELECT
        into_whs.into_whs_dt formDt,
        into_whs.chk_tm chkTm,
        into_whs.into_whs_sngl_id formNum,
        into_whs_sub.whs_encd whsEncd,
        into_whs_sub.invty_encd invtyEncd,
        SUM(into_whs_sub.qty) qty,
        SUM(into_whs_sub.qty) intoQty,
        null outQty,
        into_whs_sub.bat_num batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        into_whs
        JOIN into_whs_sub ON (
        into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id
        AND into_whs.is_nt_chk = 1
        )
        LEFT JOIN
        invty_doc ON (
        invty_doc.invty_encd = into_whs_sub.invty_encd
        )
        LEFT JOIN
        whs_doc ON (
        whs_doc.whs_encd = into_whs_sub.whs_encd
        )
        LEFT JOIN
        out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        into_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_cls ON (
        invty_doc.invty_cls_encd = invty_cls.invty_cls_encd
        )
        LEFT JOIN
        measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND into_whs.memo like #{memo}
            </if>
             <if test="Dt1 != null and Dt1 != ''">
                AND into_whs.into_whs_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.into_whs_dt &lt; #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND into_whs.into_whs_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND into_whs.into_whs_dt &lt;= #{formDt22}
            </if>
            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND into_whs_sub.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND into_whs_sub.whs_encd in (#{whsEncd})
            </if>
            <if test="whsId != null and whsId.size() >0">
                and into_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum != ''">
                AND into_whs_sub.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum,
        formNum


        UNION ALL
        SELECT
        oth_out_into_whs.form_dt formDt,
        oth_out_into_whs.chk_tm chkTm,
        oth_out_into_whs.form_num formNum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        sum(
        oth_out_into_whs_sub_tab.qty
        ) qty,
        sum(
        oth_out_into_whs_sub_tab.qty
        ) intoQty,
        null outQty,
        oth_out_into_whs_sub_tab.bat_num
        batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm
        formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num
        AND
        oth_out_into_whs.is_nt_chk = 1
        AND oth_out_into_whs.form_typ_encd = "014"
        )
        LEFT JOIN whs_doc ON (
        whs_doc.whs_encd
        = oth_out_into_whs.whs_encd
        )
        LEFT JOIN out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        oth_out_into_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_doc ON (
        oth_out_into_whs_sub_tab.invty_encd =
        invty_doc.invty_encd
        )
        LEFT JOIN
        invty_cls ON (
        invty_doc.invty_cls_encd =
        invty_cls.invty_cls_encd
        )
        LEFT
        JOIN measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="Dt1 != null and Dt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt; #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt22}
            </if>


            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND oth_out_into_whs_sub_tab.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND oth_out_into_whs.whs_encd in (#{whsEncd})
            </if>
            <if test="whsId != null and whsId.size() >0">
                and oth_out_into_whs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum != ''">
                AND oth_out_into_whs_sub_tab.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        formNum,
        whsEncd,
        invtyEncd,
        batNum
        UNION ALL
        SELECT
        oth_out_into_whs.form_dt formDt,
        oth_out_into_whs.chk_tm chkTm,
        oth_out_into_whs.form_num formNum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        sum(
        oth_out_into_whs_sub_tab.qty
        ) qty,
        null intoQty,
        SUM(oth_out_into_whs_sub_tab.qty) outQty,
        oth_out_into_whs_sub_tab.bat_num
        batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm
        formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num
        AND
        oth_out_into_whs.is_nt_chk = 1
        AND oth_out_into_whs.form_typ_encd = "015"
        )
        LEFT JOIN whs_doc ON (
        whs_doc.whs_encd
        = oth_out_into_whs.whs_encd
        )
        LEFT JOIN out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        oth_out_into_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_doc ON (
        oth_out_into_whs_sub_tab.invty_encd =
        invty_doc.invty_encd
        )
        LEFT JOIN
        invty_cls ON (
        invty_doc.invty_cls_encd =
        invty_cls.invty_cls_encd
        )
        LEFT
        JOIN measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="Dt1 != null and Dt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt; #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt22}
            </if>


            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND oth_out_into_whs_sub_tab.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND oth_out_into_whs.whs_encd in (#{whsEncd})
            </if>
            <if test="whsId != null and whsId.size() >0">
                and oth_out_into_whs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum != ''">
                AND oth_out_into_whs_sub_tab.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        formNum,
        whsEncd,
        invtyEncd,
        batNum

        UNION ALL

        SELECT
        sell_out_whs.out_whs_dt formDt,
        sell_out_whs.chk_tm chkTm,
        sell_out_whs.out_whs_id formNum,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd invtyEncd,
        SUM(sell_out_whs_sub.qty) qty,
        null intoQty,
        SUM(sell_out_whs_sub.qty) outQty,
        sell_out_whs_sub.bat_num batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        sell_out_whs
        JOIN sell_out_whs_sub ON (
        sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id
        AND sell_out_whs.is_nt_chk = 1
        )
        LEFT JOIN
        whs_doc ON (
        whs_doc.whs_encd = sell_out_whs_sub.whs_encd
        )
        LEFT JOIN
        out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        sell_out_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_doc ON (
        sell_out_whs_sub.invty_encd = invty_doc.invty_encd
        )
        LEFT JOIN invty_cls
        ON (
        invty_doc.invty_cls_encd = invty_cls.invty_cls_encd
        )
        LEFT JOIN
        measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )

        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND sell_out_whs.memo like #{memo}
            </if>
            <if test="Dt1 != null and Dt1 != ''">
                AND sell_out_whs.out_whs_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.out_whs_dt &lt; #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND sell_out_whs.out_whs_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND sell_out_whs.out_whs_dt &lt;= #{formDt22}
            </if>

            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND sell_out_whs_sub.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND sell_out_whs_sub.whs_encd in (#{whsEncd})
            </if>
            <if test="whsId != null and whsId.size() >0">
                and sell_out_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum != ''">
                AND sell_out_whs_sub.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sell_out_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sell_out_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum,
        formNum
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
        <if
                test="sort == null or sort == '' or sortOrder ==null or sortOrder == '' ">
            ORDER BY formDt
        </if>
        <if test="index != null and num != null ">
            LIMIT #{index},#{num}
        </if>
    </select>
    <select id="selectOutIngSUM" resultType="InvtyStandReport">
        SELECT
        sum(a.intoQty) intoQty,
        sum(a.outQty) outQty
        FROM
        (
        SELECT
        into_whs.into_whs_dt formDt,
        into_whs.chk_tm chkTm,
        into_whs.into_whs_sngl_id formNum,
        into_whs_sub.whs_encd whsEncd,
        into_whs_sub.invty_encd invtyEncd,
        SUM(into_whs_sub.qty) qty,
        SUM(into_whs_sub.qty) intoQty,
        null outQty,
        into_whs_sub.bat_num batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        into_whs
        JOIN into_whs_sub ON (
        into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id
        AND into_whs.is_nt_chk = 1
        )
        LEFT JOIN
        invty_doc ON (
        invty_doc.invty_encd = into_whs_sub.invty_encd
        )
        LEFT JOIN
        whs_doc ON (
        whs_doc.whs_encd = into_whs_sub.whs_encd
        )
        LEFT JOIN
        out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        into_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_cls ON (
        invty_doc.invty_cls_encd = invty_cls.invty_cls_encd
        )
        LEFT JOIN
        measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )
        <where>
            <if test="Dt1 != null and Dt1 != ''">
                AND into_whs.into_whs_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.into_whs_dt &lt; #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND into_whs.into_whs_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND into_whs.into_whs_dt &lt;= #{formDt22}
            </if>
            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND into_whs_sub.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND into_whs_sub.whs_encd in (#{whsEncd})
            </if>
            <if test="batNum != null and batNum != ''">
                AND into_whs_sub.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum,
        formNum


        UNION ALL
        SELECT
        oth_out_into_whs.form_dt formDt,
        oth_out_into_whs.chk_tm chkTm,
        oth_out_into_whs.form_num formNum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        sum(
        oth_out_into_whs_sub_tab.qty
        ) qty,
        sum(
        oth_out_into_whs_sub_tab.qty
        ) intoQty,
        null outQty,
        oth_out_into_whs_sub_tab.bat_num
        batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm
        formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num
        AND
        oth_out_into_whs.is_nt_chk = 1
        AND oth_out_into_whs.form_typ_encd = "014"
        )
        LEFT JOIN whs_doc ON (
        whs_doc.whs_encd
        = oth_out_into_whs.whs_encd
        )
        LEFT JOIN out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        oth_out_into_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_doc ON (
        oth_out_into_whs_sub_tab.invty_encd =
        invty_doc.invty_encd
        )
        LEFT JOIN
        invty_cls ON (
        invty_doc.invty_cls_encd =
        invty_cls.invty_cls_encd
        )
        LEFT
        JOIN measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )
        <where>

            <if test="Dt1 != null and Dt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt; #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt22}
            </if>


            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND oth_out_into_whs_sub_tab.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND oth_out_into_whs.whs_encd in (#{whsEncd})
            </if>
            <if test="batNum != null and batNum != ''">
                AND oth_out_into_whs_sub_tab.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        formNum,
        whsEncd,
        invtyEncd,
        batNum
        UNION ALL
        SELECT
        oth_out_into_whs.form_dt formDt,
        oth_out_into_whs.chk_tm chkTm,
        oth_out_into_whs.form_num formNum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        sum(
        oth_out_into_whs_sub_tab.qty
        ) qty,
        null intoQty,
        SUM(oth_out_into_whs_sub_tab.qty) outQty,
        oth_out_into_whs_sub_tab.bat_num
        batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm
        formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num
        AND
        oth_out_into_whs.is_nt_chk = 1
        AND oth_out_into_whs.form_typ_encd = "015"
        )
        LEFT JOIN whs_doc ON (
        whs_doc.whs_encd
        = oth_out_into_whs.whs_encd
        )
        LEFT JOIN out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        oth_out_into_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_doc ON (
        oth_out_into_whs_sub_tab.invty_encd =
        invty_doc.invty_encd
        )
        LEFT JOIN
        invty_cls ON (
        invty_doc.invty_cls_encd =
        invty_cls.invty_cls_encd
        )
        LEFT
        JOIN measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )
        <where>

            <if test="Dt1 != null and Dt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt; #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt22}
            </if>


            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND oth_out_into_whs_sub_tab.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND oth_out_into_whs.whs_encd in (#{whsEncd})
            </if>
            <if test="batNum != null and batNum != ''">
                AND oth_out_into_whs_sub_tab.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        formNum,
        whsEncd,
        invtyEncd,
        batNum

        UNION ALL

        SELECT
        sell_out_whs.out_whs_dt formDt,
        sell_out_whs.chk_tm chkTm,
        sell_out_whs.out_whs_id formNum,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd invtyEncd,
        SUM(sell_out_whs_sub.qty) qty,
        null intoQty,
        SUM(sell_out_whs_sub.qty) outQty,
        sell_out_whs_sub.bat_num batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        sell_out_whs
        JOIN sell_out_whs_sub ON (
        sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id
        AND sell_out_whs.is_nt_chk = 1
        )
        LEFT JOIN
        whs_doc ON (
        whs_doc.whs_encd = sell_out_whs_sub.whs_encd
        )
        LEFT JOIN
        out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        sell_out_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_doc ON (
        sell_out_whs_sub.invty_encd = invty_doc.invty_encd
        )
        LEFT JOIN invty_cls
        ON (
        invty_doc.invty_cls_encd = invty_cls.invty_cls_encd
        )
        LEFT JOIN
        measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )

        <where>
            <if test="Dt1 != null and Dt1 != ''">
                AND sell_out_whs.out_whs_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.out_whs_dt &lt; #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND sell_out_whs.out_whs_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND sell_out_whs.out_whs_dt &lt;= #{formDt22}
            </if>

            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND sell_out_whs_sub.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND sell_out_whs_sub.whs_encd in (#{whsEncd})
            </if>
            <if test="batNum != null and batNum != ''">
                AND sell_out_whs_sub.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sell_out_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sell_out_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum,
        formNum
        ) a
    </select>
    <select id="selectOutIngWaterCount" parameterType="Map"
            resultType="Integer">

        SELECT count(*) FROM(
        (
        SELECT
        iWhs.into_whs_sngl_id formNum
        FROM
        into_whs AS iWhs
        JOIN into_whs_sub AS iWhsSub ON iWhs.into_whs_sngl_id =
        iWhsSub.into_whs_sngl_id
        LEFT JOIN out_into_whs_typ AS outInType ON iWhs.out_into_whs_typ_id =
        outInType.out_into_whs_typ_id
        LEFT JOIN recv_send_cate AS rCate ON iWhs.recv_send_cate_id =
        rCate.recv_send_cate_id
        LEFT JOIN whs_doc AS wDoc ON iWhsSub.whs_encd = wDoc.whs_encd
        LEFT JOIN invty_doc AS iDoc ON iDoc.invty_encd = iWhsSub.invty_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN provr_doc AS pDoc ON iWhs.provr_id = pDoc.provr_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd = iWhs.form_typ_encd
        <where>
            and is_nt_chk = 1
            <if test="formDt1 != null and formDt1 != ''">
                AND iWhs.into_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND iWhs.into_whs_dt &lt;= #{formDt2}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND iWhs.into_whs_sngl_id in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND iWhsSub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND iWhsSub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND iWhsSub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND iWhsSub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND iDoc.invty_cls_encd like #{invtyClsEncd}
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND iWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND iWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND iWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND iWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND iWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND iWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )
        UNION ALL
        (
        SELECT
        sWhs.out_whs_id formNum
        FROM
        sell_out_whs AS sWhs
        JOIN sell_out_whs_sub AS sWhsSub ON sWhs.out_whs_id = sWhsSub.out_whs_id
        LEFT JOIN out_into_whs_typ AS outInType ON sWhs.out_into_whs_typ_id =
        outInType.out_into_whs_typ_id
        LEFT JOIN recv_send_cate AS rCate ON sWhs.recv_send_cate_id =
        rCate.recv_send_cate_id
        LEFT JOIN whs_doc AS wDoc ON sWhsSub.whs_encd = wDoc.whs_encd
        LEFT JOIN invty_doc AS iDoc ON sWhsSub.invty_encd = iDoc.invty_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN cust_doc AS cDoc ON sWhs.cust_id = cDoc.cust_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd = sWhs.form_typ_encd
        <where>
            and is_nt_chk = 1
            <if test="formDt1 != null and formDt1 != ''">
                AND sWhs.out_whs_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND sWhs.out_whs_dt &lt;= #{formDt2}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND iDoc.invty_cls_encd like #{invtyClsEncd}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND sWhs.out_whs_id in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND sWhsSub.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND sWhsSub.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND sWhsSub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND sWhsSub.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND sWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND sWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND sWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND sWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )
        UNION ALL
        (
        SELECT
        outInWhs.form_num formNum
        FROM
        oth_out_into_whs AS outInWhs
        JOIN oth_out_into_whs_sub_tab AS outInWhsTab ON outInWhs.form_num =
        outInWhsTab.form_num
        LEFT JOIN invty_doc AS iDoc ON outInWhsTab.invty_encd = iDoc.invty_encd
        LEFT JOIN out_into_whs_typ AS outInType ON
        outInWhs.out_into_whs_typ_id = outInType.out_into_whs_typ_id
        LEFT JOIN whs_doc AS wDoc ON outInWhs.whs_encd = wDoc.whs_encd
        LEFT JOIN measr_corp_doc AS mDoc ON iDoc.measr_corp_id =
        mDoc.measr_corp_id
        LEFT JOIN form_typ_tabs AS fTyp ON fTyp.form_typ_encd =
        outInWhs.form_typ_encd
        <where>
            and is_nt_chk = 1
            <if test="formDt1 != null and formDt1 != ''">
                AND outInWhs.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND outInWhs.form_dt &lt;= #{formDt2}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != '' ">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                  AND iDoc.invty_cls_encd like #{invtyClsEncd}
            </if>
            <if test="formNum != null and formNum.size() >0">
                AND outInWhs.form_num in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd.size() >0">
                AND outInWhsTab.invty_encd in
                <foreach collection="invtyEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd.size() >0">
                AND outInWhs.whs_encd in
                <foreach collection="whsEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsId != null and whsId.size() >0">
                AND outInWhs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum.size() >0">
                AND outInWhsTab.bat_num in
                <foreach collection="batNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''">
                AND outInWhs.out_into_whs_typ_id in (${outIntoWhsTypId})
            </if>
            <if test="formTypEncd != null and formTypEncd != ''">
                AND outInWhs.form_typ_encd in (${formTypEncd})
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND outInWhs.setup_pers = #{setupPers}
            </if>
            <if test="chkr != null and chkr != ''">
                AND outInWhs.chkr = #{chkr}
            </if>
            <if test="chkTm1 != null and chkTm1 != ''">
                AND outInWhs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND outInWhs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        )

        ) as a
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND a.memo like #{memo}
            </if>
        </where>
    </select>
    <!-- 库存台账 -->
    <!-- 单据日期、审核日期、单据号、仓库、出入库类型、收入数量、发出数量、结存数量 -->
    <select id="selectInvtyStandList" resultMap="InvtyStand">
        SELECT
        *
        FROM
        (
        (
        SELECT
        othOIWhs.form_num,
        othOIWhs.form_dt,
        othOIWhs.chk_tm,
        wDoc.whs_nm,
        OIType.out_into_whs_typ_nm,
        sum(OISubTab.qty),
        OISubTab.invty_encd,
        iDoc.invty_nm,
        iDoc.spc_model,
        mDoc.measr_corp_nm,
        iCls.invty_cls_nm
        FROM
        oth_out_into_whs AS othOIWhs,
        oth_out_into_whs_sub_tab AS OISubTab,
        out_into_whs_typ AS OIType,
        whs_doc AS wDoc,
        invty_tab AS iTab,
        invty_doc as iDoc,
        invty_cls as iCls,
        measr_corp_doc as mDoc
        WHERE
        othOIWhs.form_num = OISubTab.form_num
        AND
        othOIWhs.out_into_whs_typ_id = OIType.out_into_whs_typ_id
        AND
        othOIWhs.whs_encd = wDoc.whs_encd
        AND OISubTab.invty_encd =
        iTab.invty_encd
        AND iDoc.invty_encd = OISubTab.invty_encd
        AND
        iDoc.invty_cls_encd = iCls.invty_cls_encd
        AND iDoc.measr_corp_id =
        mDoc.measr_corp_id
        Group By OISubTab.invty_encd
        <if test="formDt1 != null and formDt1 != ''">
            AND othOIWhs.form_dt &gt;= #{formDt1}
        </if>
        <if test="formDt2 != null and formDt2 != ''">
            AND othOIWhs.form_dt &lt;= #{formDt2}
        </if>
        <if test="formNum != null and formNum != ''">
            AND othOIWhs.form_num = #{formNum}
        </if>
        <if test="chkTm1 != null and chkTm1 != ''">
            AND othOIWhs.chk_tm &gt;= #{chkTm1}
        </if>
        <if test="chkTm2 != null and chkTm2 != ''">
            AND othOIWhs.chk_tm &gt;= #{chkTm2}
        </if>
        <if test="whsEncd != null and whsEncd != ''">
            AND othOIWhs.whs_encd = #{whsEncd}
        </if>
        )
        UNION ALL
        (
        SELECT
        iWhs.into_whs_sngl_id,
        iWhs.into_whs_dt,
        iWhs.chk_tm,
        wDoc.whs_encd,
        OIType.out_into_whs_typ_nm,
        sum(iwhsSub.qty),
        iwhsSub.invty_encd,
        iDoc.invty_nm,
        iDoc.spc_model,
        mDoc.measr_corp_nm,
        iCls.invty_cls_nm
        FROM
        into_whs AS iWhs,
        into_whs_sub AS iwhsSub,
        out_into_whs_typ AS OIType,
        whs_doc AS wDoc,
        invty_tab AS iTab,
        invty_doc as iDoc,
        invty_cls as iCls,
        measr_corp_doc as mDoc
        WHERE
        iWhs.into_whs_sngl_id = iwhsSub.into_whs_sngl_id
        AND
        iWhs.out_into_whs_typ_id = OIType.out_into_whs_typ_id
        AND
        iwhsSub.whs_encd = wDoc.whs_encd
        AND iwhsSub.invty_encd =
        iTab.invty_encd
        AND iDoc.invty_encd = iwhsSub.invty_encd
        AND
        iDoc.invty_cls_encd = iCls.invty_cls_encd
        AND iDoc.measr_corp_id =
        mDoc.measr_corp_id
        Group By iwhsSub.invty_encd
        <if test="intoWhsDt1 != null and intoWhsDt1 != ''">
            AND iWhs.into_whs_dt &gt;= #{intoWhsDt1}
        </if>
        <if test="intoWhsDt2 != null and intoWhsDt2 != ''">
            AND iWhs.into_whs_dt &lt;= #{intoWhsDt2}
        </if>
        <if test="intoWhsSnglId != null and intoWhsSnglId != ''">
            AND iWhs.into_whs_sngl_id = #{intoWhsSnglId}
        </if>
        <if test="chkTm1 != null and chkTm1 != ''">
            AND iWhs.chk_tm &gt;= #{chkTm1}
        </if>
        <if test="chkTm2 != null and chkTm2 != ''">
            AND iWhs.chk_tm &gt;= #{chkTm2}
        </if>
        <if test="whsEncd != null and whsEncd != ''">
            AND iwhsSub.whs_encd = #{whsEncd}
        </if>
        )
        UNION ALL
        (
        SELECT
        sellWhs.out_whs_id,
        sellWhs.out_whs_dt,
        sellWhs.chk_tm,
        wDoc.whs_encd,
        OIType.out_into_whs_typ_nm,
        sum(sellWhsSub.qty),
        sellWhsSub.invty_encd,
        iDoc.invty_nm,
        iDoc.spc_model,
        mDoc.measr_corp_nm,
        iCls.invty_cls_nm
        FROM
        sell_out_whs AS
        sellWhs,
        sell_out_whs_sub AS sellWhsSub,
        out_into_whs_typ AS OIType,
        whs_doc AS wDoc,
        invty_tab AS iTab,
        invty_doc as iDoc,
        invty_cls as iCls,
        measr_corp_doc as mDoc
        WHERE
        sellWhs.out_whs_id = sellWhsSub.out_whs_id
        AND sellWhs.out_into_whs_typ_id = OIType.out_into_whs_typ_id
        AND
        sellWhsSub.whs_encd = wDoc.whs_encd
        AND sellWhsSub.invty_encd =
        iTab.invty_encd
        AND iDoc.invty_encd = sellWhsSub.invty_encd
        AND
        iDoc.invty_cls_encd = iCls.invty_cls_encd
        AND iDoc.measr_corp_id =
        mDoc.measr_corp_id
        Group By sellWhsSub.invty_encd
        <if test="outWhsDt1 != null and outWhsDt1 != ''">
            AND sellWhs.out_whs_dt &gt;= #{outWhsDt1}
        </if>
        <if test="outWhsDt2 != null and outWhsDt2 != ''">
            AND sellWhs.out_whs_dt &lt;= #{outWhsDt2}
        </if>
        <if test="outWhsId != null and outWhsId != ''">
            AND sellWhs.out_whs_id = #{outWhsId}
        </if>
        <if test="chkTm1 != null and chkTm1 != ''">
            AND sellWhs.chk_tm &gt;= #{chkTm1}
        </if>
        <if test="chkTm2 != null and chkTm2 != ''">
            AND sellWhs.chk_tm &gt;= #{chkTm2}
        </if>
        <if test="whsEncd != null and whsEncd != ''">
            AND sellWhsSub.whs_encd = #{whsEncd}
        </if>
        )
        ) AS a
        LIMIT #{index},#{num}
    </select>
    <select id="selectInvtyStandCount" parameterType="Map"
            resultType="Integer">
        SELECT
        count(*)
        FROM
        (
        SELECT
        into_whs.into_whs_dt formDt,
        into_whs.chk_tm
        chkTm,
        into_whs.into_whs_sngl_id formNum,
        into_whs_sub.whs_encd whsEncd,
        into_whs_sub.invty_encd invtyEncd,
        SUM(into_whs_sub.qty) qty,
        into_whs_sub.bat_num batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        into_whs
        JOIN into_whs_sub ON (
        into_whs.into_whs_sngl_id =
        into_whs_sub.into_whs_sngl_id
        AND into_whs.is_nt_chk = 1
        )
        LEFT JOIN
        invty_doc ON (
        invty_doc.invty_encd = into_whs_sub.invty_encd
        )
        LEFT JOIN
        whs_doc ON (
        whs_doc.whs_encd = into_whs_sub.whs_encd
        )
        LEFT JOIN
        out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        into_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_cls ON (
        invty_doc.invty_cls_encd = invty_cls.invty_cls_encd
        )
        LEFT JOIN
        measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND into_whs.memo like #{memo}
            </if>
            <if test="Dt1 != null and Dt1 != ''">
                AND into_whs.into_whs_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND into_whs.into_whs_dt &lt;= #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND into_whs.into_whs_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND into_whs.into_whs_dt &lt;= #{formDt22}
            </if>
            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND into_whs_sub.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND into_whs_sub.whs_encd in (#{whsEncd})
            </if>
            <if test="whsId != null and whsId.size() >0">
                and into_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum != ''">
                AND into_whs_sub.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum,
        formNum


        UNION ALL
        SELECT
        oth_out_into_whs.form_dt formDt,
        oth_out_into_whs.chk_tm chkTm,
        oth_out_into_whs.form_num formNum,
        oth_out_into_whs.whs_encd whsEncd,
        oth_out_into_whs_sub_tab.invty_encd invtyEncd,
        sum(
        oth_out_into_whs_sub_tab.qty
        ) qty,
        oth_out_into_whs_sub_tab.bat_num
        batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm
        formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        oth_out_into_whs
        JOIN oth_out_into_whs_sub_tab ON (
        oth_out_into_whs.form_num =
        oth_out_into_whs_sub_tab.form_num
        AND
        oth_out_into_whs.is_nt_chk = 1
        )
        LEFT JOIN whs_doc ON (
        whs_doc.whs_encd
        = oth_out_into_whs.whs_encd
        )
        LEFT JOIN out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        oth_out_into_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_doc ON (
        oth_out_into_whs_sub_tab.invty_encd =
        invty_doc.invty_encd
        )
        LEFT JOIN
        invty_cls ON (
        invty_doc.invty_cls_encd =
        invty_cls.invty_cls_encd
        )
        LEFT
        JOIN measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND oth_out_into_whs.memo like #{memo}
            </if>
            <if test="Dt1 != null and Dt1 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND oth_out_into_whs.form_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND oth_out_into_whs.form_dt &lt;= #{formDt22}
            </if>


            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND oth_out_into_whs_sub_tab.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND oth_out_into_whs.whs_encd in (#{whsEncd})
            </if>
            <if test="whsId != null and whsId.size() >0">
                and oth_out_into_whs.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum != ''">
                AND oth_out_into_whs_sub_tab.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND oth_out_into_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND oth_out_into_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>

        GROUP BY
        formNum,
        whsEncd,
        invtyEncd,
        batNum

        UNION ALL

        SELECT
        sell_out_whs.out_whs_dt formDt,
        sell_out_whs.chk_tm chkTm,
        sell_out_whs.out_whs_id formNum,
        sell_out_whs_sub.whs_encd whsEncd,
        sell_out_whs_sub.invty_encd invtyEncd,
        SUM(sell_out_whs_sub.qty) qty,
        sell_out_whs_sub.bat_num batNum,
        whs_doc.whs_nm whsNm,
        out_into_whs_typ.out_into_whs_typ_nm formType,
        out_into_whs_typ.out_into_whs_typ_id outIntoWhsTypId,
        invty_doc.invty_nm invtyNm,
        invty_cls.invty_cls_nm invtyClsNm,
        invty_doc.spc_model spcModel,
        measr_corp_doc.measr_corp_nm measrCorpNm
        FROM
        sell_out_whs
        JOIN sell_out_whs_sub ON (
        sell_out_whs.out_whs_id =
        sell_out_whs_sub.out_whs_id
        AND sell_out_whs.is_nt_chk = 1
        )
        LEFT JOIN
        whs_doc ON (
        whs_doc.whs_encd = sell_out_whs_sub.whs_encd
        )
        LEFT JOIN
        out_into_whs_typ ON (
        out_into_whs_typ.out_into_whs_typ_id =
        sell_out_whs.out_into_whs_typ_id
        )
        LEFT JOIN invty_doc ON (
        sell_out_whs_sub.invty_encd = invty_doc.invty_encd
        )
        LEFT JOIN invty_cls
        ON (
        invty_doc.invty_cls_encd = invty_cls.invty_cls_encd
        )
        LEFT JOIN
        measr_corp_doc ON (
        invty_doc.measr_corp_id =
        measr_corp_doc.measr_corp_id
        )

        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND sell_out_whs.memo like #{memo}
            </if>
            <if test="Dt1 != null and Dt1 != ''">
                AND sell_out_whs.out_whs_dt &gt;= #{Dt1}
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND sell_out_whs.out_whs_dt &lt;= #{formDt1}
            </if>
            <if test="formDt12 != null and formDt12 != ''">
                AND sell_out_whs.out_whs_dt &gt;= #{formDt12}
            </if>
            <if test="formDt22 != null and formDt22 != ''">
                AND sell_out_whs.out_whs_dt &lt;= #{formDt22}
            </if>

            <!-- <if test="formNum != null and formNum != ''"> AND iWhs.into_whs_sngl_id
				= #{formNum} </if> -->
            <if test="invtyEncd != null and invtyEncd != ''">
                AND sell_out_whs_sub.invty_encd = #{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND sell_out_whs_sub.whs_encd in (#{whsEncd})
            </if>
            <if test="whsId != null and whsId.size() >0">
                and sell_out_whs_sub.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum != ''">
                AND sell_out_whs_sub.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd = #{invtyClsEncd}
            </if>
            <!-- <if test="outIntoWhsTypId != null and outIntoWhsTypId != ''"> AND
				iWhs.out_into_whs_typ_id in (${outIntoWhsTypId}) </if> <if test="setupPers
				!= null and setupPers != ''"> AND iWhs.setup_pers = #{setupPers} </if> <if
				test="chkr != null and chkr != ''"> AND iWhs.chkr = #{chkr} </if> -->
            <if test="chkTm1 != null and chkTm1 != ''">
                AND sell_out_whs.chk_tm &gt;= #{chkTm1}
            </if>
            <if test="chkTm2 != null and chkTm2 != ''">
                AND sell_out_whs.chk_tm &lt;= #{chkTm2}
            </if>
        </where>
        GROUP BY
        whsEncd,
        invtyEncd,
        batNum,
        formNum
        ) AS a

    </select>
    <!-- 查询所有存货信息 分组返回前端 -->
    <select id="selectInvty" resultMap="InvtyStand">
        SELECT
        DISTINCT invty_encd
        FROM
        (
        (
        SELECT
        othOIWhs.form_num,
        othOIWhs.form_dt,
        othOIWhs.chk_tm,
        wDoc.whs_nm,
        OIType.out_into_whs_typ_nm,
        sum(OISubTab.qty),
        OISubTab.invty_encd,
        iDoc.invty_nm,
        iDoc.spc_model,
        mDoc.measr_corp_nm,
        iCls.invty_cls_nm
        FROM
        oth_out_into_whs AS othOIWhs,
        oth_out_into_whs_sub_tab AS OISubTab,
        out_into_whs_typ AS OIType,
        whs_doc AS wDoc,
        invty_tab AS iTab,
        invty_doc as iDoc,
        invty_cls as iCls,
        measr_corp_doc as mDoc
        WHERE
        othOIWhs.form_num = OISubTab.form_num
        AND othOIWhs.out_into_whs_typ_id
        = OIType.out_into_whs_typ_id
        AND othOIWhs.whs_encd = wDoc.whs_encd
        AND
        OISubTab.invty_encd = iTab.invty_encd
        AND iDoc.invty_encd =
        OISubTab.invty_encd
        AND iDoc.invty_cls_encd = iCls.invty_cls_encd
        AND
        iDoc.measr_corp_id = mDoc.measr_corp_id
        <if test="formDt1 != null and formDt1 != ''">
            AND othOIWhs.form_dt &gt;= #{formDt1}
        </if>
        <if test="formDt2 != null and formDt2 != ''">
            AND othOIWhs.form_dt &lt;= #{formDt2}
        </if>
        <if test="formNum != null and formNum != ''">
            AND outInWhs.form_num = #{formNum}
        </if>
        <if test="chkTm1 != null and chkTm1 != ''">
            AND outInWhs.chk_tm &gt;= #{chkTm1}
        </if>
        <if test="chkTm2 != null and chkTm2 != ''">
            AND outInWhs.chk_tm &gt;= #{chkTm2}
        </if>
        <if test="whsEncd != null and whsEncd != ''">
            AND outInWhs.whs_encd = #{whsEncd}
        </if>
        Group By OISubTab.invty_encd
        )
        UNION ALL
        (
        SELECT
        iWhs.into_whs_sngl_id,
        iWhs.into_whs_dt,
        iWhs.chk_tm,
        wDoc.whs_encd,
        OIType.out_into_whs_typ_nm,
        sum(iwhsSub.qty),
        iwhsSub.invty_encd,
        iDoc.invty_nm,
        iDoc.spc_model,
        mDoc.measr_corp_nm,
        iCls.invty_cls_nm
        FROM
        into_whs AS iWhs,
        into_whs_sub AS iwhsSub,
        out_into_whs_typ AS OIType,
        whs_doc AS wDoc,
        invty_tab AS iTab,
        invty_doc as iDoc,
        invty_cls as iCls,
        measr_corp_doc as mDoc
        WHERE
        iWhs.into_whs_sngl_id =
        iwhsSub.into_whs_sngl_id
        AND
        iWhs.out_into_whs_typ_id =
        OIType.out_into_whs_typ_id
        AND
        iwhsSub.whs_encd = wDoc.whs_encd
        AND
        iwhsSub.invty_encd =
        iTab.invty_encd
        AND iDoc.invty_encd =
        iwhsSub.invty_encd
        AND
        iDoc.invty_cls_encd = iCls.invty_cls_encd
        AND
        iDoc.measr_corp_id =
        mDoc.measr_corp_id
        <if test="intoWhsDt1 != null and intoWhsDt1 != ''">
            AND iWhs.into_whs_dt &gt;= #{intoWhsDt1}
        </if>
        <if test="intoWhsDt2 != null and intoWhsDt2 != ''">
            AND iWhs.into_whs_dt &lt;= #{intoWhsDt2}
        </if>
        <if test="intoWhsSnglId != null and intoWhsSnglId != ''">
            AND iWhs.into_whs_sngl_id = #{intoWhsSnglId}
        </if>
        <if test="chkTm1 != null and chkTm1 != ''">
            AND iWhs.chk_tm &gt;= #{chkTm1}
        </if>
        <if test="chkTm2 != null and chkTm2 != ''">
            AND iWhs.chk_tm &gt;= #{chkTm2}
        </if>
        <if test="whsEncd != null and whsEncd != ''">
            AND iwhsSub.whs_encd = #{whsEncd}
        </if>
        Group By iwhsSub.invty_encd
        )
        UNION ALL
        (
        SELECT
        sellWhs.out_whs_id,
        sellWhs.out_whs_dt,
        sellWhs.chk_tm,
        wDoc.whs_encd,
        OIType.out_into_whs_typ_nm,
        sum(sellWhsSub.qty),
        sellWhsSub.invty_encd,
        iDoc.invty_nm,
        iDoc.spc_model,
        mDoc.measr_corp_nm,
        iCls.invty_cls_nm
        FROM
        sell_out_whs AS
        sellWhs,
        sell_out_whs_sub AS sellWhsSub,
        out_into_whs_typ AS OIType,
        whs_doc AS wDoc,
        invty_tab AS iTab,
        invty_doc as iDoc,
        invty_cls as iCls,
        measr_corp_doc as mDoc
        WHERE
        sellWhs.out_whs_id = sellWhsSub.out_whs_id
        AND
        sellWhs.out_into_whs_typ_id = OIType.out_into_whs_typ_id
        AND
        sellWhsSub.whs_encd = wDoc.whs_encd
        AND sellWhsSub.invty_encd =
        iTab.invty_encd
        AND iDoc.invty_encd = sellWhsSub.invty_encd
        AND
        iDoc.invty_cls_encd = iCls.invty_cls_encd
        AND iDoc.measr_corp_id =
        mDoc.measr_corp_id
        <if test="outWhsDt1 != null and outWhsDt1 != ''">
            AND sellWhs.out_whs_dt &gt;= #{outWhsDt1}
        </if>
        <if test="outWhsDt2 != null and outWhsDt2 != ''">
            AND sellWhs.out_whs_dt &lt;= #{outWhsDt2}
        </if>
        <if test="outWhsId != null and outWhsId != ''">
            AND sellWhs.out_whs_id = #{outWhsId}
        </if>
        <if test="chkTm1 != null and chkTm1 != ''">
            AND sellWhs.chk_tm &gt;= #{chkTm1}
        </if>
        <if test="chkTm2 != null and chkTm2 != ''">
            AND sellWhs.chk_tm &gt;= #{chkTm2}
        </if>
        <if test="whsEncd != null and whsEncd != ''">
            AND sellWhsSub.whs_encd = #{whsEncd}
        </if>
        Group By sellWhsSub.invty_encd
        )
        ) AS a
    </select>

    <!-- zds 修改库存,逆向操作时添加 -->
    <select id="selectByReverse"
            parameterType="com.px.mis.whs.entity.InvtyTab"
            resultType="com.px.mis.whs.entity.InvtyTab">
        select ordr_num,whs_encd,invty_encd,bat_num,now_stok,aval_qty,
        prdc_dt,bao_zhi_qi,invldtn_dt,cntn_tax_uprc,un_tax_uprc,
        book_entry_uprc,tax_rate,cntn_tax_amt,un_tax_amt,regn_encd,
        gds_bit_encd
        from invty_tab
        <where>
            <if test="whsEncd != null and whsEncd != ''">
                AND whs_encd=#{whsEncd}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND invty_encd=#{invtyEncd}
            </if>
            <if test="batNum != null and batNum != ''">
                AND bat_num=#{batNum}
            </if>
        </where>
    </select>
    <!-- zds 修改库存,逆向操作时添加 -->
    <update id="updateByReverse"
            parameterType="com.px.mis.whs.entity.InvtyTab">
        UPDATE invty_tab
        <set>
            aval_qty = aval_qty+#{avalQty,jdbcType=DECIMAL}
        </set>
        where ordr_num = #{ordrNum,jdbcType=BIGINT}
    </update>
    <!-- hj 库存表查询 -->
    <!-- 分页查询库存表中的数据 -->
    <select id="selectInvtyTabList" parameterType="Map"
            resultType="InvtyTab">
        select inta.*,wd.whs_nm,ind.invty_nm
        from invty_tab inta left JOIN
        whs_doc wd on inta.whs_encd=wd.whs_encd
        left JOIN invty_doc ind on
        inta.invty_encd=ind.invty_encd
        <where>
            and ( inta.now_stok != 0 OR inta.aval_qty != 0 )
            <if test="invtyEncd != null and invtyEncd != ''">
                AND inta.invty_Encd=#{invtyEncd}
            </if>
            <if test="whsId != null and whsId.size() >0">
                and inta.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND inta.whs_encd=#{whsEncd}
            </if>
            <if test="batNum != null and batNum != ''">
                <bind name="batNum" value="'%'+  batNum +'%'"/>
                AND inta.bat_num like #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                AND ind.invty_cls_encd  like #{invtyClsEncd}
            </if>
        </where>
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
        <if test="index != null and num != null ">
            LIMIT #{index},#{num}
        </if>
    </select>
    <select id="selectInvtyTabCount" parameterType="Map"
            resultType="Integer">
        SELECT count(*)
        from invty_tab inta left JOIN whs_doc wd on
        inta.whs_encd=wd.whs_encd
        left JOIN invty_doc ind on
        inta.invty_encd=ind.invty_encd
        <where>
            and ( inta.now_stok != 0 OR inta.aval_qty != 0 )
            <if test="invtyEncd != null and invtyEncd != ''">
                AND inta.invty_Encd=#{invtyEncd}
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND inta.whs_encd=#{whsEncd}
            </if>
            <if test="whsId != null and whsId.size() >0">
                and inta.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum != ''">
                <bind name="batNum" value="'%'+  batNum +'%'"/>
                AND inta.bat_num like #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                <bind name="invtyClsEncd" value=" invtyClsEncd +'%'"/>
                AND ind.invty_cls_encd like #{invtyClsEncd}
            </if>
        </where>
    </select>
    <!-- 出入库类型 -->
    <select id="outIntoWhsTyp" resultType="Map">
        SELECT out_into_whs_typ_id
                            id,
               form_num     fn,
               out_into_whs_typ_nm
                            nm,
               src_form_num sfn
        from out_into_whs_typ
        <where>
            <if test="outIntoWhsTypId != null and outIntoWhsTypId.size() >0">
                and out_into_whs_typ_id in
                <foreach collection="outIntoWhsTypId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>

    <!-- selectInvtyTabSun -->
    <select id="selectInvtyTabSum" resultType="InvtyTab">
        SELECT
        invty_tab_term.whs_encd,
        invty_tab_term.invty_encd,
        invty_tab_term.bat_num,
        SUM( qty ) NowStok
        FROM
        invty_tab_term
        LEFT JOIN invty_doc ON ( invty_tab_term.invty_encd = invty_doc.invty_encd
        )
        <where>
            and is_early = 1
            <if test="whsEncd != null and whsEncd !=''">
                and invty_tab_term.whs_encd in (#{whsEncd})
            </if>
            <if test="whsId != null and whsId.size() >0">
                and invty_tab_term.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="invtyEncd != null and invtyEncd !=''">
                and invty_tab_term.invty_encd = #{invtyEncd}
            </if>
            <if test="batNum != null and batNum !=''">
                and invty_tab_term.bat_num = #{batNum}
            </if>
            <if test="invtyClsEncd != null and invtyClsEncd != ''">
                AND invty_doc.invty_cls_encd =
                #{invtyClsEncd}
            </if>
            <if test="Dt1 != null and Dt1 != ''">
                AND DATE_FORMAT( invty_tab_term.term_dt, '%Y%m' ) =
                DATE_FORMAT( #{Dt1} , '%Y%m' )
            </if>
        </where>


    </select>

    <select id="selectInvldtnDtList"
            resultType="com.px.mis.whs.entity.InvldtnDt">
        SELECT
        it.whs_encd whsEncd,
        wd.whs_nm whsNm,
        it.bat_num batNum,
        it.invty_encd invtyEncd,
        id.invty_nm invtyNm,
        it.prdc_dt prdcDt,
        it.bao_zhi_qi baoZhiQi,
        it.invldtn_dt invldtnDt,
        id.invty_cd invtyCd,
        id.spc_model spcModel,
        id.measr_corp_id measrCorpId,
        mDoc.measr_corp_nm measrCorpNm,
        it.aval_qty avalQty,
        it.now_stok nowStok
        FROM
        invty_tab AS it
        LEFT JOIN invty_doc AS id ON it.invty_encd = id.invty_encd
        LEFT JOIN whs_doc AS wd ON it.whs_encd = wd.whs_encd
        LEFT JOIN measr_corp_doc AS mDoc ON id.measr_corp_id = mDoc.measr_corp_id
        <where>
            <if
                    test="isBalance != null and isBalance != '' and isBalance == 0 ">
                AND it.now_stok > 0
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND it.whs_encd = #{whsEncd}
            </if>
            <if test="whsId != null and whsId.size() >0">
                and it.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum != ''">
                AND it.bat_num = #{batNum}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND it.invty_encd = #{invtyEncd}
            </if>
            <if test="invldtnDt != null and invldtnDt != ''">
                AND date_format( it.invldtn_dt, '%Y%m%d') = date_format( #{invldtnDt} , '%Y%m%d')
            </if>
            <if
                    test="(invldtn != null and invldtn != '' ) and ( prdc != null and prdc != '') ">
                AND ( (it.invldtn_dt <![CDATA[>=]]>
                date_add(NOW(), INTERVAL #{invldtn} DAY ))or (it.invldtn_dt <![CDATA[<=]]>
                date_sub(NOW(), INTERVAL #{prdc} DAY )))
            </if>
            <if
                    test="(invldtn != null and invldtn != '') and ( prdc == unll or prdc == '') ">
                AND it.invldtn_dt <![CDATA[>=]]>
                date_add(NOW(), INTERVAL #{invldtn} DAY )
            </if>
            <if
                    test="(invldtn == null or invldtn == '') and   ( prdc != null and prdc != '')   ">
                AND it.invldtn_dt <![CDATA[<=]]>
                date_sub(NOW(), INTERVAL #{prdc} DAY )
            </if>
        </where>
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
        <if test="index != null and num != null ">
            LIMIT #{index},#{num}
        </if>
    </select>
    <select id="selectInvldtnDtSUM"
            resultType="com.px.mis.whs.entity.InvldtnDt">
        SELECT
        null whsEncd,
        null whsNm,
        null batNum,
        null invtyEncd,
        null invtyNm,
        null prdcDt,
        null baoZhiQi,
        null invldtnDt,
        null invtyCd,
        null spcModel,
        null measrCorpId,
        null measrCorpNm,
        SUM(it.aval_qty) avalQty,
        SUM(it.now_stok) nowStok
        FROM
        invty_tab AS it
        LEFT JOIN invty_doc AS id ON it.invty_encd = id.invty_encd
        LEFT JOIN whs_doc AS wd ON it.whs_encd = wd.whs_encd
        LEFT JOIN measr_corp_doc AS mDoc ON id.measr_corp_id = mDoc.measr_corp_id
        <where>
            <if
                    test="isBalance != null and isBalance != '' and isBalance == 0 ">
                AND it.now_stok > 0
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND it.whs_encd = #{whsEncd}
            </if>
            <if test="batNum != null and batNum != ''">
                AND it.bat_num = #{batNum}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND it.invty_encd = #{invtyEncd}
            </if>
            <if test="invldtnDt != null and invldtnDt != ''">
                AND date_format( it.invldtn_dt, '%Y%m%d') = date_format( #{invldtnDt} , '%Y%m%d')
            </if>
            <if
                    test="(invldtn != null and invldtn != '' ) and ( prdc != null and prdc != '') ">
                AND ( (it.invldtn_dt <![CDATA[>=]]>
                date_add(NOW(), INTERVAL #{invldtn} DAY ))or (it.invldtn_dt <![CDATA[<=]]>
                date_sub(NOW(), INTERVAL #{prdc} DAY )))
            </if>
            <if
                    test="(invldtn != null and invldtn != '') and ( prdc == unll or prdc == '') ">
                AND it.invldtn_dt <![CDATA[>=]]>
                date_add(NOW(), INTERVAL #{invldtn} DAY )
            </if>
            <if
                    test="(invldtn == null or invldtn == '') and   ( prdc != null and prdc != '')   ">
                AND it.invldtn_dt <![CDATA[<=]]>
                date_sub(NOW(), INTERVAL #{prdc} DAY )
            </if>
        </where>
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
    </select>

    <select id="selectInvldtnDtCount" resultType="Integer">
        SELECT
        count(it.ordr_num)
        FROM
        invty_tab AS it
        LEFT JOIN invty_doc AS id ON it.invty_encd = id.invty_encd
        LEFT JOIN whs_doc AS wd ON it.whs_encd = wd.whs_encd
        LEFT JOIN measr_corp_doc AS mDoc ON id.measr_corp_id = mDoc.measr_corp_id
        <where>
            <if
                    test="isBalance != null and isBalance != '' and isBalance == 0 ">
                AND it.now_stok > 0
            </if>
            <if test="whsEncd != null and whsEncd != ''">
                AND it.whs_encd = #{whsEncd}
            </if>
            <if test="whsId != null and whsId.size() >0">
                and it.whs_encd in
                <foreach collection="whsId" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="batNum != null and batNum != ''">
                AND it.bat_num = #{batNum}
            </if>
            <if test="invtyEncd != null and invtyEncd != ''">
                AND it.invty_encd = #{invtyEncd}
            </if>
            <if test="invldtnDt != null and invldtnDt != ''">
                AND date_format( it.invldtn_dt, '%Y%m%d') = date_format( #{invldtnDt} , '%Y%m%d')
            </if>
            <if
                    test="(invldtn != null and invldtn != '' ) and ( prdc != null and prdc != '') ">
                AND ( (it.invldtn_dt <![CDATA[>=]]>
                date_add(NOW(), INTERVAL #{invldtn} DAY ))or (it.invldtn_dt <![CDATA[<=]]>
                date_sub(NOW(), INTERVAL #{prdc} DAY )))
            </if>
            <if
                    test="(invldtn != null and invldtn != '') and ( prdc == unll or prdc == '') ">
                AND it.invldtn_dt <![CDATA[>=]]>
                date_add(NOW(), INTERVAL #{invldtn} DAY )
            </if>
            <if
                    test="(invldtn == null or invldtn == '') and   ( prdc != null and prdc != '')   ">
                AND it.invldtn_dt <![CDATA[<=]]>
                date_sub(NOW(), INTERVAL #{prdc} DAY )
            </if>
        </where>
    </select>

    <select id="selectNtChkNoList" resultType="NtChkNo">
        SELECT
        a.form_num formNum,
        a.form_typ_encd formTypEncd,
        DATE_FORMAT( a.form_dt, '%Y-%m-%d %T' ) formDt,
        a.setup_pers setupPers,
        DATE_FORMAT( a.setup_tm, '%Y-%m-%d %T' ) setupTm,
        form_typ_tabs.form_typ_name formTypName,
        a.memo
        FROM
        (
        SELECT
        form_num AS form_num,
        form_typ_encd,
        form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        amb_disamb_sngl
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        form_num AS form_num,
        form_typ_encd,
        form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        cannib_sngl
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        check_form_num AS form_num,
        form_typ_encd,
        check_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        check_sngl
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        check_form_num AS form_num,
        form_typ_encd,
        check_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        check_prft_loss
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        form_num AS form_num,
        form_typ_encd,
        form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        oth_out_into_whs
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        purs_ordr_id AS form_num,
        form_typ_encd,
        purs_ordr_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        purs_ordr
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        to_gds_sngl_id AS form_num,
        form_typ_encd,
        to_gds_sngl_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        to_gds_sngl
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        into_whs_sngl_id AS form_num,
        form_typ_encd,
        into_whs_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        into_whs
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        sell_sngl_id AS form_num,
        form_typ_encd,
        sell_sngl_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        sell_sngl
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        rtn_goods_id AS form_num,
        form_typ_encd,
        rtn_goods_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        rtn_goods
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        out_whs_id AS form_num,
        form_typ_encd,
        out_whs_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        sell_out_whs
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        delv_sngl_id AS form_num,
        form_typ_encd,
        delv_sngl_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        entrs_agn_delv
        WHERE
        is_nt_chk = "0"
        UNION ALL
        SELECT
        purs_inv_num AS form_num,
        form_typ_encd,
        bllg_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        purs_comn_inv
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        sell_inv_num AS form_num,
        form_typ_encd,
        bllg_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        sell_comn_inv
        WHERE
        is_nt_chk = "0"
        ) a
        LEFT JOIN form_typ_tabs ON a.form_typ_encd = form_typ_tabs.form_typ_encd
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND a.memo like #{memo}
            </if>
            <if test="formTypEncd !=null and  formTypEncd.size() >0 ">
                and a.form_typ_encd in
                <foreach collection="formTypEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="formNum !=null and  formNum.size() >0 ">
                and a.form_num in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND a.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND a.form_dt &lt;= #{formDt2}
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND a.setup_pers = #{setupPers}
            </if>
            <if test="setupTm1 != null and setupTm1 != ''">
                AND a.setup_tm &gt;= #{setupTm1}
            </if>
            <if test="setupTm2 != null and setupTm2 != ''">
                AND a.setup_tm &gt;= #{setupTm2}
            </if>
        </where>
        <if
                test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
            ORDER BY ${sort} ${sortOrder}
        </if>
        <if test="index != null and num != null ">
            LIMIT #{index},#{num}
        </if>
    </select>
    <select id="selectNtChkNoCount" resultType="Integer">
        SELECT
        count(a.form_num)
        FROM
        (
        SELECT
        form_num AS form_num,
        form_typ_encd,
        form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        amb_disamb_sngl
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        form_num AS form_num,
        form_typ_encd,
        form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        cannib_sngl
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        check_form_num AS form_num,
        form_typ_encd,
        check_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        check_sngl
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        check_form_num AS form_num,
        form_typ_encd,
        check_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        check_prft_loss
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        form_num AS form_num,
        form_typ_encd,
        form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        oth_out_into_whs
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        purs_ordr_id AS form_num,
        form_typ_encd,
        purs_ordr_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        purs_ordr
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        to_gds_sngl_id AS form_num,
        form_typ_encd,
        to_gds_sngl_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        to_gds_sngl
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        into_whs_sngl_id AS form_num,
        form_typ_encd,
        into_whs_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        into_whs
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        sell_sngl_id AS form_num,
        form_typ_encd,
        sell_sngl_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        sell_sngl
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        rtn_goods_id AS form_num,
        form_typ_encd,
        rtn_goods_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        rtn_goods
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        out_whs_id AS form_num,
        form_typ_encd,
        out_whs_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        sell_out_whs
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        delv_sngl_id AS form_num,
        form_typ_encd,
        delv_sngl_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        entrs_agn_delv
        WHERE
        is_nt_chk = "0"  UNION ALL
        SELECT
        purs_inv_num AS form_num,
        form_typ_encd,
        bllg_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        purs_comn_inv
        WHERE
        is_nt_chk = "0" UNION ALL
        SELECT
        sell_inv_num AS form_num,
        form_typ_encd,
        bllg_dt form_dt,
        setup_pers,
        setup_tm,
        memo
        FROM
        sell_comn_inv
        WHERE
        is_nt_chk = "0"
        ) a
        LEFT JOIN form_typ_tabs ON a.form_typ_encd = form_typ_tabs.form_typ_encd
        <where>
            <if test="memo != null and memo != ''">
                <bind name="memo" value="'%'+ memo +'%'"/>
                AND a.memo like #{memo}
            </if>
            <if test="formTypEncd !=null and  formTypEncd.size() >0 ">
                and a.form_typ_encd in
                <foreach collection="formTypEncd" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="formNum !=null and  formNum.size() >0 ">
                and a.form_num in
                <foreach collection="formNum" item="item"
                         separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="formDt1 != null and formDt1 != ''">
                AND a.form_dt &gt;= #{formDt1}
            </if>
            <if test="formDt2 != null and formDt2 != ''">
                AND a.form_dt &lt;= #{formDt2}
            </if>
            <if test="setupPers != null and setupPers != ''">
                AND a.setup_pers = #{setupPers}
            </if>
            <if test="setupTm1 != null and setupTm1 != ''">
                AND a.setup_tm &gt;= #{setupTm1}
            </if>
            <if test="setupTm2 != null and setupTm2 != ''">
                AND a.setup_tm &gt;= #{setupTm2}
            </if>
        </where>

    </select>


    <!-- 在库存表中批量新增数据 -->
    <insert id="exInvtyTab" parameterType="java.util.List">
        insert into invty_tab (whs_encd, invty_encd,aval_qty,now_stok,
        bat_num,
        prdc_dt, bao_zhi_qi, invldtn_dt,
        un_tax_uprc,
        un_tax_amt
        )
        values
        <foreach collection="list" item="item"
                 separator=",">
            ( #{item.whsEncd},
            #{item.invtyEncd},#{item.avalQty},#{item.nowStok},
            #{item.batNum},
            <if test="item.prdcDt =='' ">null</if>
            <if test="item.prdcDt !='' ">#{item.prdcDt}</if>
            ,
            #{item.baoZhiQi},
            <if test="item.invldtnDt =='' ">null</if>
            <if test="item.invldtnDt !='' ">#{item.invldtnDt}</if>
            , #{item.unTaxUprc},
            #{item.unTaxAmt}
            )
        </foreach>
    </insert>

</mapper>