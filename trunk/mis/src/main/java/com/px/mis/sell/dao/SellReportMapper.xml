<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.px.mis.sell.dao.SellReportMapper">

	<select id="BselectSellNowStokReportList"
		resultType="com.px.mis.sell.entity.SellNowStokReport">
		SELECT
		sell_out_whs_sub.whs_encd whsEncd,
		sell_out_whs_sub.invty_encd
		invtyEncd,
		sell_out_whs_sub.bat_num batNum,
		SUM(sell_out_whs_sub.qty)
		qty,
		sell_out_whs_sub.prdc_dt prdcDt,
		sell_out_whs_sub.bao_zhi_qi
		baoZhiQi,
		sell_out_whs_sub.invldtn_dt invldtnDt,
		sell_out_whs_sub.cntn_tax_uprc cntnTaxUprc,
		SUM(
		sell_out_whs_sub.prc_tax_sum
		) prcTaxSum,
		sell_out_whs_sub.no_tax_uprc
		noTaxUprc,
		SUM(
		sell_out_whs_sub.no_tax_amt
		) noTaxAmt,
		SUM(sell_out_whs_sub.tax_amt) taxAmt,
		invty_doc.invty_nm invtyNm,
		invty_doc.spc_model spcModel,
		measr_corp_doc.measr_corp_nm measrCorpNm,
		invty_doc.bx_rule bxRule,
		invty_doc.ref_sell_prc refSellPrc,
		invty_doc.lo_sell_prc loSellPrc,
		invty_doc.vol vol,
		invty_doc.weight
		weight,
		invty_tab.aval_qty avalQty,
		invty_tab.now_Stok nowStok,
		whs_doc.whs_nm
		FROM
		sell_out_whs
		LEFT JOIN sell_out_whs_sub ON (
		sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id
		)
		LEFT JOIN
		invty_doc ON (
		invty_doc.invty_encd = sell_out_whs_sub.invty_encd
		)
		LEFT
		JOIN measr_corp_doc ON (
		measr_corp_doc.measr_corp_id =
		invty_doc.measr_corp_id
		)
		LEFT JOIN whs_doc ON (
		whs_doc.whs_encd =
		sell_out_whs_sub.whs_encd
		)
		LEFT JOIN invty_tab ON (
		invty_tab.whs_encd =
		sell_out_whs_sub.whs_encd
		AND invty_tab.invty_encd =
		sell_out_whs_sub.invty_encd
		AND invty_tab.bat_num =
		sell_out_whs_sub.bat_num
		)
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_out_whs_sub.whs_encd  in 
				<foreach collection="whsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND sell_out_whs_sub.invty_encd  in 
				<foreach collection="invtyEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd  in 
				<foreach collection="invtyClsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>

			<if test="batNum != null and batNum.size() >0">
				AND sell_out_whs_sub.bat_num  in 
				<foreach collection="batNum" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			
		</where>


		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
	<if test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
			ORDER BY ${sort} ${sortOrder}
	</if>
	<if test="index != null  and  num != null ">
		LIMIT #{index},#{num}
	</if>
	</select>
	<select id="selectSellNowStokReportList" resultType="com.px.mis.sell.entity.SellNowStokReport">
		SELECT
		sum( a.intoWhsQty ) intoWhsQty,
		sum( a.sellWhsQty ) sellWhsQty,
		sum( a.outIntoQty ) outIntoQty,
		sum( a.outWhsQty ) outWhsQty,
		invty_tab.whs_Encd whsEncd,
		invty_tab.invty_Encd invtyEncd,
		invty_tab.bat_Num batNum,
		invty_tab.now_stok nowStok,
		invty_tab.aval_qty avalQty,
		invty_doc.invty_nm invtyNm,
		invty_doc.invty_cd invtyCd,
		invty_doc.spc_model spcModel,
		invty_tab.un_tax_uprc noTaxUprc,
		invty_tab.un_tax_amt noTaxAmt,
		measr_corp_doc.measr_corp_nm measrCorpNm,
		invty_doc.bx_rule bxRule,
		invty_tab.prdc_dt prdcDt,
		invty_tab.bao_zhi_qi baoZhiQi,
		invty_tab.invldtn_dt invldtnDt,
		invty_doc.ref_sell_prc refSellPrc,
		invty_doc.lo_sell_prc loSellPrc,
		invty_doc.vol vol,
		invty_doc.weight weight,
		whs_doc.whs_nm whsNm,
		DATEDIFF( invty_tab.invldtn_dt, CURDATE()) overdueDays
		FROM
		invty_tab
		LEFT JOIN (
		SELECT NULL
		intoWhsQty,
		SUM( sell_out_whs_sub.qty ) sellWhsQty,
		NULL outIntoQty,
		NULL outWhsQty,
		sell_out_whs_sub.whs_encd whsEncd,
		sell_out_whs_sub.invty_encd invtyEncd,
		sell_out_whs_sub.bat_Num batNum
		FROM
		sell_out_whs
		JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and sell_out_whs_sub.whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and sell_out_whs_sub.whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND sell_out_whs_sub.invty_encd in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND sell_out_whs_sub.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		    )
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT
		SUM( into_whs_sub.qty ) intoWhsQty,
		NULL sellWhsQty,
		NULL outIntoQty,
		NULL outWhsQty,
		into_whs_sub.whs_encd whsEncd,
		into_whs_sub.invty_encd invtyEncd,
		into_whs_sub.bat_Num batNum
		FROM
		into_whs
		JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id = into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and into_whs_sub.whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and into_whs_sub.whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND into_whs_sub.invty_encd in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND into_whs_sub.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT
		SUM( oth_out_into_whs_sub_tab.qty ) intoWhsQty,
		NULL sellWhsQty,
		NULL outIntoQty,
		NULL outWhsQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum
		FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = 0 AND oth_out_into_whs.form_typ_encd = "014"
		<if test="whsEncd != null and whsEncd.size() >0">
			and oth_out_into_whs.whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and oth_out_into_whs.whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND oth_out_into_whs_sub_tab.invty_encd in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND oth_out_into_whs_sub_tab.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT NULL
		intoWhsQty,
		NULL sellWhsQty,
		NULL outIntoQty,
		SUM( cannib_sngl_sub_tab.cannib_qty ) outWhsQty,
		cannib_sngl.tran_out_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id invtyEncd,
		cannib_sngl_sub_tab.bat_Num batNum
		FROM
		cannib_sngl
		JOIN cannib_sngl_sub_tab ON ( cannib_sngl.form_num = cannib_sngl_sub_tab.form_num AND cannib_sngl.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and cannib_sngl.tran_out_whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and cannib_sngl.tran_out_whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND cannib_sngl_sub_tab.invty_id in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND cannib_sngl_sub_tab.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT NULL
		intoWhsQty,
		NULL sellWhsQty,
		SUM( cannib_sngl_sub_tab.cannib_qty ) outIntoQty,
		NULL outWhsQty,
		cannib_sngl.tran_in_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id invtyEncd,
		cannib_sngl_sub_tab.bat_Num batNum
		FROM
		cannib_sngl
		JOIN cannib_sngl_sub_tab ON ( cannib_sngl.form_num = cannib_sngl_sub_tab.form_num AND cannib_sngl.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and cannib_sngl.tran_in_whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and cannib_sngl.tran_in_whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND cannib_sngl_sub_tab.invty_id in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND cannib_sngl_sub_tab.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		) a ON ( invty_tab.invty_encd = a.invtyEncd AND invty_tab.bat_Num = a.batNum AND invty_tab.whs_encd = a.whsEncd )
		LEFT JOIN invty_doc ON ( invty_doc.invty_encd = invty_tab.invty_Encd )
		LEFT JOIN measr_corp_doc ON ( measr_corp_doc.measr_corp_id = invty_doc.measr_corp_id )
		LEFT JOIN whs_doc ON ( whs_doc.whs_encd = invty_tab.whs_Encd )
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and invty_tab.whs_encd in
				<foreach collection="whsEncd" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="whsId != null and whsId.size() >0">
				and invty_tab.whs_encd in
				<foreach collection="whsId" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND invty_tab.invty_encd in
				<foreach collection="invtyEncd" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="batNum != null and batNum.size() >0">
				AND invty_tab.bat_Num in
				<foreach collection="batNum" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd in
				<foreach collection="invtyClsEncd" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<!-- 不等于0 非零 -->
			<if test="qty != null and qty != '' and  qty != 0 ">
				AND invty_tab.aval_qty != 0
			</if>
		</where>
		GROUP BY
		invty_tab.whs_Encd,
		invty_tab.invty_Encd,
		invty_tab.bat_Num
		<if test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
			ORDER BY ${sort} ${sortOrder}
		</if>
		<if test="index != null and num != null ">
			LIMIT #{index},#{num}
		</if>
	</select>
	 <!--销售现存量总计  -->
	<!-- <select id="selectSellNowStokReportListSums"
		resultType="map">
		SELECT
		SUM(sell_out_whs_sub.qty)
		qty,
		SUM(
		sell_out_whs_sub.prc_tax_sum
		) prcTaxSum,
		SUM(
		sell_out_whs_sub.no_tax_amt
		) noTaxAmt,
		SUM(sell_out_whs_sub.tax_amt) taxAmt
		FROM
		sell_out_whs
		LEFT JOIN sell_out_whs_sub ON (
		sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id
		)
		LEFT JOIN
		invty_doc ON (
		invty_doc.invty_encd = sell_out_whs_sub.invty_encd
		)
		LEFT
		JOIN measr_corp_doc ON (
		measr_corp_doc.measr_corp_id =
		invty_doc.measr_corp_id
		)
		LEFT JOIN whs_doc ON (
		whs_doc.whs_encd =
		sell_out_whs_sub.whs_encd
		)
		LEFT JOIN invty_tab ON (
		invty_tab.whs_encd =
		sell_out_whs_sub.whs_encd
		AND invty_tab.invty_encd =
		sell_out_whs_sub.invty_encd
		AND invty_tab.bat_num =
		sell_out_whs_sub.bat_num
		)
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_out_whs_sub.whs_encd  in 
				<foreach collection="whsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND sell_out_whs_sub.invty_encd  in 
				<foreach collection="invtyEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd  in 
				<foreach collection="invtyClsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>

			<if test="batNum != null and batNum.size() >0">
				AND sell_out_whs_sub.bat_num  in 
				<foreach collection="batNum" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			
		</where>
	</select> 原版总计 -->
	
	
<!-- 销售现存量总计 -->
<select id="selectSellNowStokReportListSums" resultType="Map">
		SELECT
		sum( a.intoWhsQty ) intoWhsQty,
		sum( a.sellWhsQty ) sellWhsQty,
		sum( a.outIntoQty ) outIntoQty,
		sum( a.outWhsQty ) outWhsQty,
		Sum(invty_tab.now_stok) nowStok,
		Sum(invty_tab.aval_qty) avalQty,
		Sum(invty_tab.un_tax_uprc) noTaxUprc,
		Sum(invty_tab.un_tax_amt) noTaxAmt,
		count(*) as count
		FROM
		invty_tab
		LEFT JOIN (
		SELECT NULL
		intoWhsQty,
		SUM( sell_out_whs_sub.qty ) sellWhsQty,
		NULL outIntoQty,
		NULL outWhsQty,
		sell_out_whs_sub.whs_encd whsEncd,
		sell_out_whs_sub.invty_encd invtyEncd,
		sell_out_whs_sub.bat_Num batNum
		FROM
		sell_out_whs
		JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and sell_out_whs_sub.whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and sell_out_whs_sub.whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND sell_out_whs_sub.invty_encd in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND sell_out_whs_sub.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		    )
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT
		SUM( into_whs_sub.qty ) intoWhsQty,
		NULL sellWhsQty,
		NULL outIntoQty,
		NULL outWhsQty,
		into_whs_sub.whs_encd whsEncd,
		into_whs_sub.invty_encd invtyEncd,
		into_whs_sub.bat_Num batNum
		FROM
		into_whs
		JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id = into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and into_whs_sub.whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and into_whs_sub.whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND into_whs_sub.invty_encd in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND into_whs_sub.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT
		SUM( oth_out_into_whs_sub_tab.qty ) intoWhsQty,
		NULL sellWhsQty,
		NULL outIntoQty,
		NULL outWhsQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum
		FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = 0 AND oth_out_into_whs.form_typ_encd = "014"
		<if test="whsEncd != null and whsEncd.size() >0">
			and oth_out_into_whs.whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and oth_out_into_whs.whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND oth_out_into_whs_sub_tab.invty_encd in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND oth_out_into_whs_sub_tab.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT NULL
		intoWhsQty,
		NULL sellWhsQty,
		NULL outIntoQty,
		SUM( cannib_sngl_sub_tab.cannib_qty ) outWhsQty,
		cannib_sngl.tran_out_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id invtyEncd,
		cannib_sngl_sub_tab.bat_Num batNum
		FROM
		cannib_sngl
		JOIN cannib_sngl_sub_tab ON ( cannib_sngl.form_num = cannib_sngl_sub_tab.form_num AND cannib_sngl.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and cannib_sngl.tran_out_whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and cannib_sngl.tran_out_whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND cannib_sngl_sub_tab.invty_id in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND cannib_sngl_sub_tab.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT NULL
		intoWhsQty,
		NULL sellWhsQty,
		SUM( cannib_sngl_sub_tab.cannib_qty ) outIntoQty,
		NULL outWhsQty,
		cannib_sngl.tran_in_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id invtyEncd,
		cannib_sngl_sub_tab.bat_Num batNum
		FROM
		cannib_sngl
		JOIN cannib_sngl_sub_tab ON ( cannib_sngl.form_num = cannib_sngl_sub_tab.form_num AND cannib_sngl.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and cannib_sngl.tran_in_whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and cannib_sngl.tran_in_whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND cannib_sngl_sub_tab.invty_id in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND cannib_sngl_sub_tab.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		) a ON ( invty_tab.invty_encd = a.invtyEncd AND invty_tab.bat_Num = a.batNum AND invty_tab.whs_encd = a.whsEncd )
		LEFT JOIN invty_doc ON ( invty_doc.invty_encd = invty_tab.invty_Encd )
		LEFT JOIN measr_corp_doc ON ( measr_corp_doc.measr_corp_id = invty_doc.measr_corp_id )
		LEFT JOIN whs_doc ON ( whs_doc.whs_encd = invty_tab.whs_Encd )
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and invty_tab.whs_encd in
				<foreach collection="whsEncd" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="whsId != null and whsId.size() >0">
				and invty_tab.whs_encd in
				<foreach collection="whsId" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND invty_tab.invty_encd in
				<foreach collection="invtyEncd" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="batNum != null and batNum.size() >0">
				AND invty_tab.bat_Num in
				<foreach collection="batNum" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd in
				<foreach collection="invtyClsEncd" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<!-- 不等于0 非零 -->
			<if test="qty != null and qty != '' and  qty != 0 ">
				AND invty_tab.aval_qty != 0
			</if>
		</where>
	</select>

	<select id="selectSellNowStokReportCount" resultType="Integer">
		SELECT
		count(*)
		FROM (

		SELECT
		sum( a.intoWhsQty ) intoWhsQty,
		sum( a.sellWhsQty ) sellWhsQty,
		sum( a.outIntoQty ) outIntoQty,
		sum( a.outWhsQty ) outWhsQty,
		invty_tab.whs_Encd whsEncd,
		invty_tab.invty_Encd invtyEncd,
		invty_tab.bat_Num batNum,
		invty_tab.now_stok nowStok,
		invty_tab.aval_qty avalQty,
		invty_doc.invty_nm invtyNm,
		invty_doc.invty_cd invtyCd,
		invty_doc.spc_model spcModel,
		invty_tab.un_tax_uprc noTaxUprc,
		invty_tab.un_tax_amt noTaxAmt,
		measr_corp_doc.measr_corp_nm measrCorpNm,
		invty_doc.bx_rule bxRule,
		invty_tab.prdc_dt prdcDt,
		invty_tab.bao_zhi_qi baoZhiQi,
		invty_tab.invldtn_dt invldtnDt,
		invty_doc.ref_sell_prc refSellPrc,
		invty_doc.lo_sell_prc loSellPrc,
		invty_doc.vol vol,
		invty_doc.weight weight,
		whs_doc.whs_nm whsNm,
		DATEDIFF( invty_tab.invldtn_dt, CURDATE()) overdueDays
		FROM
		invty_tab
		LEFT JOIN (
		SELECT NULL
		intoWhsQty,
		SUM( sell_out_whs_sub.qty ) sellWhsQty,
		NULL outIntoQty,
		NULL outWhsQty,
		sell_out_whs_sub.whs_encd whsEncd,
		sell_out_whs_sub.invty_encd invtyEncd,
		sell_out_whs_sub.bat_Num batNum
		FROM
		sell_out_whs
		JOIN sell_out_whs_sub ON ( sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id AND sell_out_whs.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and sell_out_whs_sub.whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and sell_out_whs_sub.whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND sell_out_whs_sub.invty_encd in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND sell_out_whs_sub.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT
		SUM( into_whs_sub.qty ) intoWhsQty,
		NULL sellWhsQty,
		NULL outIntoQty,
		NULL outWhsQty,
		into_whs_sub.whs_encd whsEncd,
		into_whs_sub.invty_encd invtyEncd,
		into_whs_sub.bat_Num batNum
		FROM
		into_whs
		JOIN into_whs_sub ON ( into_whs.into_whs_sngl_id = into_whs_sub.into_whs_sngl_id AND into_whs.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and into_whs_sub.whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and into_whs_sub.whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND into_whs_sub.invty_encd in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND into_whs_sub.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT
		SUM( oth_out_into_whs_sub_tab.qty ) intoWhsQty,
		NULL sellWhsQty,
		NULL outIntoQty,
		NULL outWhsQty,
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd invtyEncd,
		oth_out_into_whs_sub_tab.bat_Num batNum
		FROM
		oth_out_into_whs
		JOIN oth_out_into_whs_sub_tab ON ( oth_out_into_whs.form_num = oth_out_into_whs_sub_tab.form_num AND oth_out_into_whs.is_nt_chk = 0 AND oth_out_into_whs.form_typ_encd = "014"
		<if test="whsEncd != null and whsEncd.size() >0">
			and oth_out_into_whs.whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and oth_out_into_whs.whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND oth_out_into_whs_sub_tab.invty_encd in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND oth_out_into_whs_sub_tab.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT NULL
		intoWhsQty,
		NULL sellWhsQty,
		NULL outIntoQty,
		SUM( cannib_sngl_sub_tab.cannib_qty ) outWhsQty,
		cannib_sngl.tran_out_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id invtyEncd,
		cannib_sngl_sub_tab.bat_Num batNum
		FROM
		cannib_sngl
		JOIN cannib_sngl_sub_tab ON ( cannib_sngl.form_num = cannib_sngl_sub_tab.form_num AND cannib_sngl.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and cannib_sngl.tran_out_whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and cannib_sngl.tran_out_whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND cannib_sngl_sub_tab.invty_id in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND cannib_sngl_sub_tab.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum UNION ALL
		SELECT NULL
		intoWhsQty,
		NULL sellWhsQty,
		SUM( cannib_sngl_sub_tab.cannib_qty ) outIntoQty,
		NULL outWhsQty,
		cannib_sngl.tran_in_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id invtyEncd,
		cannib_sngl_sub_tab.bat_Num batNum
		FROM
		cannib_sngl
		JOIN cannib_sngl_sub_tab ON ( cannib_sngl.form_num = cannib_sngl_sub_tab.form_num AND cannib_sngl.is_nt_chk = 0
		<if test="whsEncd != null and whsEncd.size() >0">
			and cannib_sngl.tran_in_whs_encd in
			<foreach collection="whsEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="whsId != null and whsId.size() >0">
			and cannib_sngl.tran_in_whs_encd in
			<foreach collection="whsId" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND cannib_sngl_sub_tab.invty_id in
			<foreach collection="invtyEncd" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			AND cannib_sngl_sub_tab.bat_Num in
			<foreach collection="batNum" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>)
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		) a ON ( invty_tab.invty_encd = a.invtyEncd AND invty_tab.bat_Num = a.batNum AND invty_tab.whs_encd = a.whsEncd )
		LEFT JOIN invty_doc ON ( invty_doc.invty_encd = invty_tab.invty_Encd )
		LEFT JOIN measr_corp_doc ON ( measr_corp_doc.measr_corp_id = invty_doc.measr_corp_id )
		LEFT JOIN whs_doc ON ( whs_doc.whs_encd = invty_tab.whs_Encd )
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and invty_tab.whs_encd in
				<foreach collection="whsEncd" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="whsId != null and whsId.size() >0">
				and invty_tab.whs_encd in
				<foreach collection="whsId" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND invty_tab.invty_encd in
				<foreach collection="invtyEncd" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="batNum != null and batNum.size() >0">
				AND invty_tab.bat_num in
				<foreach collection="batNum" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd in
				<foreach collection="invtyClsEncd" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<!-- 不等于0 非零 -->
			<if test="qty != null and qty != '' and  qty != 0 ">
				AND invty_tab.aval_qty != 0
			</if>
		</where>
		GROUP BY
		invty_tab.whs_Encd,
		invty_tab.invty_Encd,
		invty_tab.bat_Num
		) asdf
	</select>
	<select id="BselectSellNowStokReportCount" resultType="Integer">
		SELECT
		count(*)
		FROM
		(SELECT
		sell_out_whs_sub.whs_encd whsEncd,
		sell_out_whs_sub.invty_encd
		invtyEncd,
		sell_out_whs_sub.bat_num batNum,
		SUM(sell_out_whs_sub.qty)
		qty,
		sell_out_whs_sub.prdc_dt prdcDt,
		sell_out_whs_sub.bao_zhi_qi
		baoZhiQi,
		sell_out_whs_sub.invldtn_dt
		invldtnDt,
		sell_out_whs_sub.cntn_tax_uprc cntnTaxUprc,
		SUM(
		sell_out_whs_sub.prc_tax_sum
		) prcTaxSum,
		sell_out_whs_sub.no_tax_uprc
		noTaxUprc,
		SUM(
		sell_out_whs_sub.no_tax_amt
		) noTaxAmt,
		SUM(sell_out_whs_sub.tax_amt) taxAmt,
		invty_doc.invty_nm invtyNm,
		invty_doc.spc_model spcModel,
		measr_corp_doc.measr_corp_nm measrCorpNm,
		invty_doc.bx_rule bxRule,
		invty_doc.ref_sell_prc refSellPrc,
		invty_doc.lo_sell_prc loSellPrc,
		invty_doc.vol vol,
		invty_doc.weight
		weight,
		invty_tab.aval_qty avalQty,
		invty_tab.now_Stok nowStok,
		whs_doc.whs_nm
		FROM
		sell_out_whs
		LEFT JOIN sell_out_whs_sub ON (
		sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id
		)
		LEFT JOIN
		invty_doc ON (
		invty_doc.invty_encd = sell_out_whs_sub.invty_encd
		)
		LEFT
		JOIN measr_corp_doc ON (
		measr_corp_doc.measr_corp_id =
		invty_doc.measr_corp_id
		)
		LEFT JOIN whs_doc ON (
		whs_doc.whs_encd =
		sell_out_whs_sub.whs_encd
		)
		LEFT JOIN invty_tab ON (
		invty_tab.whs_encd =
		sell_out_whs_sub.whs_encd
		AND invty_tab.invty_encd =
		sell_out_whs_sub.invty_encd
		AND invty_tab.bat_num =
		sell_out_whs_sub.bat_num
		)
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_out_whs_sub.whs_encd  in
				<foreach collection="whsEncd" index="index" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND sell_out_whs_sub.invty_encd  in
				<foreach collection="invtyEncd" index="index" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd  in
				<foreach collection="invtyClsEncd" index="index" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>

			<if test="batNum != null and batNum.size() >0">
				AND sell_out_whs_sub.bat_num  in
				<foreach collection="batNum" index="index" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>

		</where>


		GROUP BY
		whsEncd,
		invtyEncd,
		batNum

		) a
	</select>
	<select id="selectSellOutList"
		resultType="com.px.mis.sell.entity.SellNowStokReport">
		SELECT
		sell_out_whs_sub.whs_encd whsEncd,
		sell_out_whs_sub.invty_encd
		invtyEncd,
		sell_out_whs_sub.bat_num batNum,
		SUM(sell_out_whs_sub.qty)
		intoWhsQty
		FROM
		sell_out_whs
		LEFT JOIN sell_out_whs_sub ON (
		sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id AND
		sell_out_whs.is_nt_chk=0
		)
		LEFT JOIN
		invty_doc ON (
		invty_doc.invty_encd =
		sell_out_whs_sub.invty_encd
		)
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_out_whs_sub.whs_encd  in 
				<foreach collection="whsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND sell_out_whs_sub.invty_encd  in 
				<foreach collection="invtyEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd  in 
				<foreach collection="invtyClsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>

			<if test="batNum != null and batNum.size() >0">
				AND sell_out_whs_sub.bat_num  in 
				<foreach collection="batNum" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<!-- <if test="formDt1 != null and formDt1 != ''">
				AND sell_out_whs.setup_tm &gt;= #{formDt1}
			</if>
			<if test="formDt2 != null and formDt2 != ''">
				AND sell_out_whs.setup_tm &lt;= #{formDt2}
			</if> -->



		</where>

		GROUP BY
		whsEncd,
		invtyEncd,
		batNum

	</select>
	<select id="selectCannibSnglOut"
		resultType="com.px.mis.sell.entity.SellNowStokReport">
		SELECT
		cannib_sngl.tran_out_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id invtyEncd,
		SUM(cannib_sngl_sub_tab.cannib_qty) qty,
		cannib_sngl_sub_tab.bat_num
		batNum
		FROM
		cannib_sngl
		JOIN
		cannib_sngl_sub_tab ON (
		cannib_sngl.form_num
		=
		cannib_sngl_sub_tab.form_num
		AND
		cannib_sngl.is_nt_chk = 0
		)
		LEFT JOIN
		invty_doc ON (
		invty_doc.invty_encd
		=
		cannib_sngl_sub_tab.invty_id
		)
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and cannib_sngl.tran_out_whs_encd  in 
				<foreach collection="whsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND cannib_sngl_sub_tab.invty_id  in 
				<foreach collection="invtyEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>

			<if test="batNum != null and batNum.size() >0">
				AND cannib_sngl_sub_tab.bat_num  in 
				<foreach collection="batNum" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd in 
				<foreach collection="invtyClsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<!-- <if test="formDt1 != null and formDt1 != ''">
				AND cannib_sngl.setup_tm &gt;= #{formDt1}
			</if>
			<if test="formDt2 != null and formDt2 != ''">
				AND cannib_sngl.setup_tm &lt;= #{formDt2}
			</if> -->
		</where>

		GROUP BY
		whsEncd,
		invtyEncd,
		batNum

	</select>

	<select id="selectCannibSnglInto"
		resultType="com.px.mis.sell.entity.SellNowStokReport">
		SELECT
		cannib_sngl.tran_in_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id invtyEncd,
		SUM(cannib_sngl_sub_tab.cannib_qty) qty,
		cannib_sngl_sub_tab.bat_num
		batNum
		FROM
		cannib_sngl
		JOIN
		cannib_sngl_sub_tab ON (
		cannib_sngl.form_num
		=
		cannib_sngl_sub_tab.form_num
		AND
		cannib_sngl.is_nt_chk = 0
		)
		LEFT JOIN
		invty_doc ON (
		invty_doc.invty_encd
		=
		cannib_sngl_sub_tab.invty_id
		)
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and cannib_sngl.tran_in_whs_encd in 
				<foreach collection="whsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND cannib_sngl_sub_tab.invty_id in 
				<foreach collection="invtyEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>

			<if test="batNum != null and batNum.size() >0">
				AND cannib_sngl_sub_tab.bat_num in 
				<foreach collection="batNum" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd in 
				<foreach collection="invtyClsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<!-- <if test="formDt1 != null and formDt1 != ''">
				AND cannib_sngl.setup_tm &gt;= #{formDt1}
			</if>
			<if test="formDt2 != null and formDt2 != ''">
				AND cannib_sngl.setup_tm &lt;= #{formDt2}
			</if> -->
		</where>

		GROUP BY
		whsEncd,
		invtyEncd,
		batNum

	</select>


	<select id="selectIntoWhsQty"
		resultType="com.px.mis.sell.entity.SellNowStokReport">
		SELECT

		whsEncd,
		invtyEncd,
		batNum,
		SUM(qty) qty
		FROM
		(
		SELECT
		into_whs_sub.whs_encd whsEncd,
		into_whs_sub.invty_encd invtyEncd,
		SUM(into_whs_sub.qty) qty,
		into_whs_sub.bat_num batNum
		FROM
		into_whs
		JOIN
		into_whs_sub ON (
		into_whs.into_whs_sngl_id =
		into_whs_sub.into_whs_sngl_id
		AND
		into_whs.is_nt_chk = 0
		AND
		into_whs_sub.is_nt_rtn_goods = 1
		)LEFT JOIN
		invty_doc ON (
		invty_doc.invty_encd = into_whs_sub.invty_encd
		)
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and into_whs_sub.whs_encd  in 
				<foreach collection="whsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND into_whs_sub.invty_encd  in 
				<foreach collection="invtyEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>

			<if test="batNum != null and batNum.size() >0">
				AND into_whs_sub.bat_num  in 
				<foreach collection="batNum" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd  in 
				<foreach collection="invtyClsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<!-- <if test="formDt1 != null and formDt1 != ''">
				AND into_whs.setup_tm &gt;= #{formDt1}
			</if>
			<if test="formDt2 != null and formDt2 != ''">
				AND into_whs.setup_tm &lt;= #{formDt2}
			</if> -->
		</where>
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		UNION ALL
		SELECT
		rtn_goods_sub.whs_encd
		whsEncd,
		rtn_goods_sub.invty_encd invtyEncd,
		SUM(rtn_goods_sub.qty) qty,
		rtn_goods_sub.bat_num batNum
		FROM
		rtn_goods
		JOIN rtn_goods_sub ON (
		rtn_goods.rtn_goods_id = rtn_goods_sub.rtn_goods_id
		AND
		rtn_goods.is_nt_chk = 0
		)LEFT JOIN
		invty_doc ON (
		invty_doc.invty_encd =
		rtn_goods_sub.invty_encd
		)
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and rtn_goods_sub.whs_encd  in 
				<foreach collection="whsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND rtn_goods_sub.invty_encd  in 
				<foreach collection="invtyEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>

			<if test="batNum != null and batNum.size() >0">
				AND rtn_goods_sub.bat_num  in 
				<foreach collection="batNum" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd  in 
				<foreach collection="invtyClsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<!-- <if test="formDt1 != null and formDt1 != ''">
				AND rtn_goods.setup_tm &gt;= #{formDt1}
			</if>
			<if test="formDt2 != null and formDt2 != ''">
				AND rtn_goods.setup_tm &lt;= #{formDt2}
			</if> -->
		</where>

		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		UNION ALL
		SELECT
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd
		invtyEncd,
		sum(
		oth_out_into_whs_sub_tab.qty
		) qty,
		oth_out_into_whs_sub_tab.bat_num
		batNum
		FROM
		oth_out_into_whs
		JOIN
		oth_out_into_whs_sub_tab ON (
		oth_out_into_whs.form_num =
		oth_out_into_whs_sub_tab.form_num
		AND
		oth_out_into_whs.is_nt_chk = 0
		AND
		oth_out_into_whs.in_status IS NOT
		NULL
		)LEFT JOIN
		invty_doc ON (
		invty_doc.invty_encd = oth_out_into_whs_sub_tab.invty_encd
		)
		<where>
			<if test="whsEncd != null and whsEncd.size() >0">
				and oth_out_into_whs.whs_encd  in 
				<foreach collection="whsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				AND oth_out_into_whs_sub_tab.invty_encd  in 
				<foreach collection="invtyEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>

			<if test="batNum != null and batNum.size() >0">
				AND oth_out_into_whs_sub_tab.bat_num  in 
				<foreach collection="batNum" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0">
				AND invty_doc.invty_cls_encd  in 
				<foreach collection="invtyClsEncd" index="index" item="item"
					separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
			<!-- <if test="formDt1 != null and formDt1 != ''">
				AND oth_out_into_whs.setup_tm &gt;= #{formDt1}
			</if>
			<if test="formDt2 != null and formDt2 != ''">
				AND oth_out_into_whs.setup_tm &lt;= #{formDt2}
			</if> -->
		</where>
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		) a
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum


	</select>
<!-- 发货统计表总计 -->
	<select id="sellSellStatisticalReportSums"
		resultType="map">
SELECT
	SUM( qiChuQty ) qiChuQty,
	SUM( qiChuNoTaxAmt ) qiChuNoTaxAmt,
	SUM( qiChuTaxAmt ) qiChuTaxAmt,
	SUM( qiChuPrcTaxSum ) qiChuPrcTaxSum,
	SUM( sellQty ) sellQty,
	SUM( sellNoTaxAmt ) sellNoTaxAmt,
	SUM( sellTaxAmt ) sellTaxAmt,
	SUM( sellPrcTaxSum ) sellPrcTaxSum,
	SUM( KPQty ) KPQty,
	SUM( KPAmt ) KPAmt,
	SUM( KPTaxAmt ) KPTaxAmt,
	SUM( KPAmtSum ) KPAmtSum,
	IFNULL( SUM( qiChuQty ), 0 ) + IFNULL( SUM( sellQty ), 0 ) - IFNULL( SUM( KPQty ), 0 ) cumulativeQty,
	IFNULL( SUM( qiChuNoTaxAmt ), 0 ) + IFNULL( SUM( sellNoTaxAmt ), 0 ) - IFNULL( SUM( KPAmt ), 0 ) cumulativeNoTaxAmt,
	IFNULL( SUM( qiChuTaxAmt ), 0 ) + IFNULL( SUM( sellTaxAmt ), 0 ) - IFNULL( SUM( KPTaxAmt ), 0 ) cumulativeTaxAmt,
	IFNULL( SUM( qiChuPrcTaxSum ), 0 ) + IFNULL( SUM( sellPrcTaxSum ), 0 ) - IFNULL( SUM( KPAmtSum ), 0 ) cumulativePrcTaxSum,
	IFNULL( SUM( qiChuQty ), 0 ) + IFNULL( SUM( sellQty ), 0 ) - IFNULL( SUM( KPQty ), 0 ) differencesQty,
	IFNULL( SUM( qiChuNoTaxAmt ), 0 ) + IFNULL( SUM( sellNoTaxAmt ), 0 ) - IFNULL( SUM( KPAmt ), 0 ) differencesNoTaxAmt,
	IFNULL( SUM( qiChuTaxAmt ), 0 ) + IFNULL( SUM( sellTaxAmt ), 0 ) - IFNULL( SUM( KPTaxAmt ), 0 ) differencesTaxAmt,
	IFNULL( SUM( qiChuPrcTaxSum ), 0 ) + IFNULL( SUM( sellPrcTaxSum ), 0 ) - IFNULL( SUM( KPAmtSum ), 0 ) differencesPrcTaxSum
FROM
	(
	SELECT
		sell_sngl_sub.bat_num batNum,
		sell_sngl_sub.invty_encd invtyEncd,
		sell_sngl_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		NULL qiChuQty,
		NULL qiChuNoTaxAmt,
		NULL qiChuTaxAmt,
		NULL qiChuPrcTaxSum,
		SUM( sell_sngl_sub.qty ) sellQty,
		SUM( sell_sngl_sub.no_tax_amt ) sellNoTaxAmt,
		SUM( sell_sngl_sub.tax_amt ) sellTaxAmt,
		SUM( sell_sngl_sub.prc_tax_sum ) sellPrcTaxSum,
		SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) KPQty,
		( ( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * cntn_tax_uprc ) - ( ( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * no_tax_uprc ) KPAmt,
		( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * no_tax_uprc KPTaxAmt,
		( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * cntn_tax_uprc KPAmtSum,
		sell_sngl.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		sell_sngl.acc_num accNum 
	FROM
		sell_sngl
		JOIN sell_sngl_sub ON sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = sell_sngl.acc_num 
	<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_sngl.sell_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND sell_sngl.sell_sngl_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and sell_sngl_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and sell_sngl_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_sngl_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and sell_sngl.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and sell_sngl.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and sell_sngl.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and sell_sngl.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and sell_sngl.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		rtn_goods_sub.bat_num batNum,
		rtn_goods_sub.invty_encd invtyEncd,
		rtn_goods_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		NULL qiChuQty,
		NULL qiChuNoTaxAmt,
		NULL qiChuTaxAmt,
		NULL qiChuPrcTaxSum,
		SUM( rtn_goods_sub.qty ) sellQty,
		SUM( rtn_goods_sub.no_tax_amt ) sellNoTaxAmt,
		SUM( rtn_goods_sub.tax_amt ) sellTaxAmt,
		SUM( rtn_goods_sub.prc_tax_sum ) sellPrcTaxSum,
		SUM( rtn_goods_sub.qty ) - SUM( rtn_goods_sub.un_bllg_qty ) KPQty,
		( ( SUM( rtn_goods_sub.qty ) - SUM( rtn_goods_sub.un_bllg_qty ) ) * cntn_tax_uprc ) - ( ( SUM( rtn_goods_sub.qty ) - SUM( rtn_goods_sub.un_bllg_qty ) ) * no_tax_uprc ) KPAmt,
		( SUM( rtn_goods_sub.qty ) - SUM( rtn_goods_sub.un_bllg_qty ) ) * no_tax_uprc KPTaxAmt,
		( SUM( rtn_goods_sub.qty ) - SUM( rtn_goods_sub.un_bllg_qty ) ) * cntn_tax_uprc KPAmtSum,
		rtn_goods.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		rtn_goods.acc_num accNum 
	FROM
		rtn_goods
		JOIN rtn_goods_sub ON rtn_goods.rtn_goods_id = rtn_goods_sub.rtn_goods_id
		LEFT JOIN mis_user ON mis_user.acc_num = rtn_goods.acc_num
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND rtn_goods.rtn_goods_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND rtn_goods.rtn_goods_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and rtn_goods_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and rtn_goods_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and rtn_goods_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and rtn_goods.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and rtn_goods.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and rtn_goods.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and rtn_goods.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and rtn_goods.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		entrs_agn_delv_sub.bat_num batNum,
		entrs_agn_delv_sub.invty_encd invtyEncd,
		entrs_agn_delv_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		NULL qiChuQty,
		NULL qiChuNoTaxAmt,
		NULL qiChuTaxAmt,
		NULL qiChuPrcTaxSum,
		SUM( entrs_agn_delv_sub.qty ) sellQty,
		SUM( entrs_agn_delv_sub.no_tax_amt ) sellNoTaxAmt,
		SUM( entrs_agn_delv_sub.tax_amt ) sellTaxAmt,
		SUM( entrs_agn_delv_sub.prc_tax_sum ) sellPrcTaxSum,
		SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.un_bllg_qty ) KPQty,
		( ( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * cntn_tax_uprc ) - ( ( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * no_tax_uprc ) KPAmt,
		( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * no_tax_uprc KPTaxAmt,
		( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * cntn_tax_uprc KPAmtSum,
		entrs_agn_delv.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		entrs_agn_delv.acc_num accNum 
	FROM
		entrs_agn_delv
		JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id = entrs_agn_delv_sub.delv_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = entrs_agn_delv.acc_num 
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and entrs_agn_delv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and entrs_agn_delv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and entrs_agn_delv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and entrs_agn_delv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and entrs_agn_delv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and entrs_agn_delv.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and entrs_agn_delv.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and entrs_agn_delv.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		rtn_goods_sub.bat_num batNum,
		rtn_goods_sub.invty_encd invtyEncd,
		rtn_goods_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		SUM( rtn_goods_sub.un_bllg_qty ) qiChuQty,
		SUM( rtn_goods_sub.un_bllg_qty ) * no_tax_uprc qiChuNoTaxAmt,
		( SUM( rtn_goods_sub.un_bllg_qty ) * cntn_tax_uprc ) - ( SUM( rtn_goods_sub.un_bllg_qty ) * no_tax_uprc ) qiChuTaxAmt,
		SUM( rtn_goods_sub.un_bllg_qty ) * cntn_tax_uprc qiChuPrcTaxSum,
		NULL sellQty,
		NULL sellNoTaxAmt,
		NULL sellTaxAmt,
		NULL sellPrcTaxSum,
		NULL KPQty,
		NULL KPAmt,
		NULL KPTaxAmt,
		NULL KPAmtSum,
		rtn_goods.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		rtn_goods.acc_num accNum 
	FROM
		rtn_goods
		JOIN rtn_goods_sub ON rtn_goods.rtn_goods_id = rtn_goods_sub.rtn_goods_id
		LEFT JOIN mis_user ON mis_user.acc_num = rtn_goods.acc_num 
			<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND rtn_goods.rtn_goods_dt &lt;  #{fromDt1}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and rtn_goods_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and rtn_goods_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and rtn_goods_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and rtn_goods.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and rtn_goods.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and rtn_goods.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and rtn_goods.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and rtn_goods.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		entrs_agn_delv_sub.bat_num batNum,
		entrs_agn_delv_sub.invty_encd invtyEncd,
		entrs_agn_delv_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		SUM( entrs_agn_delv_sub.un_bllg_qty ) qiChuQty,
		( SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * no_tax_uprc qiChuNoTaxAmt,
		( ( SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * cntn_tax_uprc ) - ( ( SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * no_tax_uprc ) qiChuTaxAmt,
		( SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * cntn_tax_uprc qiChuPrcTaxSum,
		NULL sellQty,
		NULL sellNoTaxAmt,
		NULL sellTaxAmt,
		NULL sellPrcTaxSum,
		NULL KPQty,
		NULL KPAmt,
		NULL KPTaxAmt,
		NULL KPAmtSum,
		entrs_agn_delv.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		entrs_agn_delv.acc_num accNum 
	FROM
		entrs_agn_delv
		JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id = entrs_agn_delv_sub.delv_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = entrs_agn_delv.acc_num 
	<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND entrs_agn_delv.delv_sngl_dt &lt;  #{fromDt1}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and entrs_agn_delv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and entrs_agn_delv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and entrs_agn_delv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and entrs_agn_delv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and entrs_agn_delv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and entrs_agn_delv.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and entrs_agn_delv.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and entrs_agn_delv.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		sell_sngl_sub.bat_num batNum,
		sell_sngl_sub.invty_encd invtyEncd,
		sell_sngl_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		SUM( sell_sngl_sub.un_bllg_qty ) qiChuQty,
		SUM( sell_sngl_sub.un_bllg_qty ) * no_tax_uprc qiChuNoTaxAmt,
		( SUM( sell_sngl_sub.un_bllg_qty ) * cntn_tax_uprc ) - ( SUM( sell_sngl_sub.un_bllg_qty ) * no_tax_uprc ) qiChuTaxAmt,
		SUM( sell_sngl_sub.un_bllg_qty ) * cntn_tax_uprc qiChuPrcTaxSum,
		NULL sellQty,
		NULL sellNoTaxAmt,
		NULL sellTaxAmt,
		NULL sellPrcTaxSum,
		NULL KPQty,
		NULL KPAmt,
		NULL KPTaxAmt,
		NULL KPAmtSum,
		sell_sngl.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		sell_sngl.acc_num accNum 
	FROM
		sell_sngl
		JOIN sell_sngl_sub ON sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = sell_sngl.acc_num 
		
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_sngl.sell_sngl_dt &lt;  #{fromDt1}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and sell_sngl_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and sell_sngl_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_sngl_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and sell_sngl.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and sell_sngl.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and sell_sngl.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and sell_sngl.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and sell_sngl.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where> 
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId 
	) b
	
	LEFT JOIN cust_doc ON cust_doc.cust_id = b.custId
	LEFT JOIN invty_doc ON invty_doc.invty_encd = b.invtyEncd
	LEFT JOIN whs_doc ON whs_doc.whs_encd = b.whsEncd
	LEFT JOIN invty_cls ON invty_doc.invty_cls_encd = invty_cls.invty_Cls_Encd 
	<where>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
				invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
	</where> 	
	</select>

	<select id="sellSellStatisticalReport"
		resultType="com.px.mis.sell.entity.SellStatisticalReport">
SELECT
	SUM( qiChuQty ) qiChuQty,
	SUM( qiChuNoTaxAmt ) qiChuNoTaxAmt,
	SUM( qiChuTaxAmt ) qiChuTaxAmt,
	SUM( qiChuPrcTaxSum ) qiChuPrcTaxSum,
	SUM( sellQty ) sellQty,
	SUM( sellNoTaxAmt ) sellNoTaxAmt,
	SUM( sellTaxAmt ) sellTaxAmt,
	SUM( sellPrcTaxSum ) sellPrcTaxSum,
	SUM( KPQty ) KPQty,
	SUM( KPAmt ) KPAmt,
	SUM( KPTaxAmt ) KPTaxAmt,
	SUM( KPAmtSum ) KPAmtSum,
	IFNULL( SUM( qiChuQty ), 0 ) + IFNULL( SUM( sellQty ), 0 ) - IFNULL( SUM( KPQty ), 0 ) cumulativeQty,
	IFNULL( SUM( qiChuNoTaxAmt ), 0 ) + IFNULL( SUM( sellNoTaxAmt ), 0 ) - IFNULL( SUM( KPAmt ), 0 ) cumulativeNoTaxAmt,
	IFNULL( SUM( qiChuTaxAmt ), 0 ) + IFNULL( SUM( sellTaxAmt ), 0 ) - IFNULL( SUM( KPTaxAmt ), 0 ) cumulativeTaxAmt,
	IFNULL( SUM( qiChuPrcTaxSum ), 0 ) + IFNULL( SUM( sellPrcTaxSum ), 0 ) - IFNULL( SUM( KPAmtSum ), 0 ) cumulativePrcTaxSum,
	IFNULL( SUM( qiChuQty ), 0 ) + IFNULL( SUM( sellQty ), 0 ) - IFNULL( SUM( KPQty ), 0 ) differencesQty,
	IFNULL( SUM( qiChuNoTaxAmt ), 0 ) + IFNULL( SUM( sellNoTaxAmt ), 0 ) - IFNULL( SUM( KPAmt ), 0 ) differencesNoTaxAmt,
	IFNULL( SUM( qiChuTaxAmt ), 0 ) + IFNULL( SUM( sellTaxAmt ), 0 ) - IFNULL( SUM( KPTaxAmt ), 0 ) differencesTaxAmt,
	IFNULL( SUM( qiChuPrcTaxSum ), 0 ) + IFNULL( SUM( sellPrcTaxSum ), 0 ) - IFNULL( SUM( KPAmtSum ), 0 ) differencesPrcTaxSum,
	custId,
	batNum,
	invtyEncd,
	whsEncd,
	depId,
	depName,
	userName,
	accNum 
FROM
	(
	SELECT
		sell_sngl_sub.bat_num batNum,
		sell_sngl_sub.invty_encd invtyEncd,
		sell_sngl_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		NULL qiChuQty,
		NULL qiChuNoTaxAmt,
		NULL qiChuTaxAmt,
		NULL qiChuPrcTaxSum,
		SUM( sell_sngl_sub.qty ) sellQty,
		SUM( sell_sngl_sub.no_tax_amt ) sellNoTaxAmt,
		SUM( sell_sngl_sub.tax_amt ) sellTaxAmt,
		SUM( sell_sngl_sub.prc_tax_sum ) sellPrcTaxSum,
		SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) KPQty,
		( ( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * cntn_tax_uprc ) - ( ( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * no_tax_uprc ) KPAmt,
		( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * no_tax_uprc KPTaxAmt,
		( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * cntn_tax_uprc KPAmtSum,
		sell_sngl.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		sell_sngl.acc_num accNum 
	FROM
		sell_sngl
		JOIN sell_sngl_sub ON sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = sell_sngl.acc_num 
	<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_sngl.sell_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND sell_sngl.sell_sngl_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and sell_sngl_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and sell_sngl_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_sngl_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and sell_sngl.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and sell_sngl.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and sell_sngl.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and sell_sngl.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and sell_sngl.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		rtn_goods_sub.bat_num batNum,
		rtn_goods_sub.invty_encd invtyEncd,
		rtn_goods_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		NULL qiChuQty,
		NULL qiChuNoTaxAmt,
		NULL qiChuTaxAmt,
		NULL qiChuPrcTaxSum,
		SUM( rtn_goods_sub.qty ) sellQty,
		SUM( rtn_goods_sub.no_tax_amt ) sellNoTaxAmt,
		SUM( rtn_goods_sub.tax_amt ) sellTaxAmt,
		SUM( rtn_goods_sub.prc_tax_sum ) sellPrcTaxSum,
		SUM( rtn_goods_sub.qty ) - SUM( rtn_goods_sub.un_bllg_qty ) KPQty,
		( ( SUM( rtn_goods_sub.qty ) - SUM( rtn_goods_sub.un_bllg_qty ) ) * cntn_tax_uprc ) - ( ( SUM( rtn_goods_sub.qty ) - SUM( rtn_goods_sub.un_bllg_qty ) ) * no_tax_uprc ) KPAmt,
		( SUM( rtn_goods_sub.qty ) - SUM( rtn_goods_sub.un_bllg_qty ) ) * no_tax_uprc KPTaxAmt,
		( SUM( rtn_goods_sub.qty ) - SUM( rtn_goods_sub.un_bllg_qty ) ) * cntn_tax_uprc KPAmtSum,
		rtn_goods.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		rtn_goods.acc_num accNum 
	FROM
		rtn_goods
		JOIN rtn_goods_sub ON rtn_goods.rtn_goods_id = rtn_goods_sub.rtn_goods_id
		LEFT JOIN mis_user ON mis_user.acc_num = rtn_goods.acc_num
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND rtn_goods.rtn_goods_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND rtn_goods.rtn_goods_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and rtn_goods_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and rtn_goods_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and rtn_goods_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and rtn_goods.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and rtn_goods.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and rtn_goods.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and rtn_goods.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and rtn_goods.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		entrs_agn_delv_sub.bat_num batNum,
		entrs_agn_delv_sub.invty_encd invtyEncd,
		entrs_agn_delv_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		NULL qiChuQty,
		NULL qiChuNoTaxAmt,
		NULL qiChuTaxAmt,
		NULL qiChuPrcTaxSum,
		SUM( entrs_agn_delv_sub.qty ) sellQty,
		SUM( entrs_agn_delv_sub.no_tax_amt ) sellNoTaxAmt,
		SUM( entrs_agn_delv_sub.tax_amt ) sellTaxAmt,
		SUM( entrs_agn_delv_sub.prc_tax_sum ) sellPrcTaxSum,
		SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.un_bllg_qty ) KPQty,
		( ( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * cntn_tax_uprc ) - ( ( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * no_tax_uprc ) KPAmt,
		( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * no_tax_uprc KPTaxAmt,
		( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * cntn_tax_uprc KPAmtSum,
		entrs_agn_delv.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		entrs_agn_delv.acc_num accNum 
	FROM
		entrs_agn_delv
		JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id = entrs_agn_delv_sub.delv_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = entrs_agn_delv.acc_num 
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and entrs_agn_delv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and entrs_agn_delv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and entrs_agn_delv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and entrs_agn_delv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and entrs_agn_delv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and entrs_agn_delv.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and entrs_agn_delv.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and entrs_agn_delv.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		rtn_goods_sub.bat_num batNum,
		rtn_goods_sub.invty_encd invtyEncd,
		rtn_goods_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		SUM( rtn_goods_sub.un_bllg_qty ) qiChuQty,
		SUM( rtn_goods_sub.un_bllg_qty ) * no_tax_uprc qiChuNoTaxAmt,
		( SUM( rtn_goods_sub.un_bllg_qty ) * cntn_tax_uprc ) - ( SUM( rtn_goods_sub.un_bllg_qty ) * no_tax_uprc ) qiChuTaxAmt,
		SUM( rtn_goods_sub.un_bllg_qty ) * cntn_tax_uprc qiChuPrcTaxSum,
		NULL sellQty,
		NULL sellNoTaxAmt,
		NULL sellTaxAmt,
		NULL sellPrcTaxSum,
		NULL KPQty,
		NULL KPAmt,
		NULL KPTaxAmt,
		NULL KPAmtSum,
		rtn_goods.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		rtn_goods.acc_num accNum 
	FROM
		rtn_goods
		JOIN rtn_goods_sub ON rtn_goods.rtn_goods_id = rtn_goods_sub.rtn_goods_id
		LEFT JOIN mis_user ON mis_user.acc_num = rtn_goods.acc_num 
			<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND rtn_goods.rtn_goods_dt &lt;  #{fromDt1}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and rtn_goods_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and rtn_goods_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and rtn_goods_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and rtn_goods.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and rtn_goods.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and rtn_goods.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and rtn_goods.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and rtn_goods.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		entrs_agn_delv_sub.bat_num batNum,
		entrs_agn_delv_sub.invty_encd invtyEncd,
		entrs_agn_delv_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		SUM( entrs_agn_delv_sub.un_bllg_qty ) qiChuQty,
		( SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * no_tax_uprc qiChuNoTaxAmt,
		( ( SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * cntn_tax_uprc ) - ( ( SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * no_tax_uprc ) qiChuTaxAmt,
		( SUM( entrs_agn_delv_sub.un_bllg_qty ) ) * cntn_tax_uprc qiChuPrcTaxSum,
		NULL sellQty,
		NULL sellNoTaxAmt,
		NULL sellTaxAmt,
		NULL sellPrcTaxSum,
		NULL KPQty,
		NULL KPAmt,
		NULL KPTaxAmt,
		NULL KPAmtSum,
		entrs_agn_delv.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		entrs_agn_delv.acc_num accNum 
	FROM
		entrs_agn_delv
		JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id = entrs_agn_delv_sub.delv_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = entrs_agn_delv.acc_num 
	<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND entrs_agn_delv.delv_sngl_dt &lt;  #{fromDt1}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and entrs_agn_delv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and entrs_agn_delv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and entrs_agn_delv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and entrs_agn_delv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and entrs_agn_delv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and entrs_agn_delv.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and entrs_agn_delv.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and entrs_agn_delv.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		sell_sngl_sub.bat_num batNum,
		sell_sngl_sub.invty_encd invtyEncd,
		sell_sngl_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		SUM( sell_sngl_sub.un_bllg_qty ) qiChuQty,
		SUM( sell_sngl_sub.un_bllg_qty ) * no_tax_uprc qiChuNoTaxAmt,
		( SUM( sell_sngl_sub.un_bllg_qty ) * cntn_tax_uprc ) - ( SUM( sell_sngl_sub.un_bllg_qty ) * no_tax_uprc ) qiChuTaxAmt,
		SUM( sell_sngl_sub.un_bllg_qty ) * cntn_tax_uprc qiChuPrcTaxSum,
		NULL sellQty,
		NULL sellNoTaxAmt,
		NULL sellTaxAmt,
		NULL sellPrcTaxSum,
		NULL KPQty,
		NULL KPAmt,
		NULL KPTaxAmt,
		NULL KPAmtSum,
		sell_sngl.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		sell_sngl.acc_num accNum 
	FROM
		sell_sngl
		JOIN sell_sngl_sub ON sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = sell_sngl.acc_num 
		
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_sngl.sell_sngl_dt &lt;  #{fromDt1}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and sell_sngl_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and sell_sngl_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_sngl_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and sell_sngl.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and sell_sngl.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and sell_sngl.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and sell_sngl.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and sell_sngl.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where> 
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId 
	) b
	LEFT JOIN cust_doc ON cust_doc.cust_id = b.custId
	LEFT JOIN invty_doc ON invty_doc.invty_encd = b.invtyEncd
	LEFT JOIN whs_doc ON whs_doc.whs_encd = b.whsEncd
	LEFT JOIN invty_cls ON invty_doc.invty_cls_encd = invty_cls.invty_Cls_Encd 
	<where>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
				invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
	</where> 
		
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId
	
	<if test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
		ORDER BY ${sort} ${sortOrder}
	</if>
			
	<if test="index != null and num != null ">
		LIMIT #{index},#{num}
	</if>
		
	</select>

	<select id="sellSellStatisticalReportCount" resultType="Integer">
		SELECT
		count(*)
		FROM
		(
	SELECT
	SUM( qiChuQty ) qiChuQty,
	batNum,
	invtyEncd,
	whsEncd,
	depId,
	depName,
	userName,
	accNum 
FROM
	(
	SELECT
		sell_sngl_sub.bat_num batNum,
		sell_sngl_sub.invty_encd invtyEncd,
		sell_sngl_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		NULL qiChuQty,
		NULL qiChuNoTaxAmt,
		NULL qiChuTaxAmt,
		NULL qiChuPrcTaxSum,
		SUM( sell_sngl_sub.qty ) sellQty,
		SUM( sell_sngl_sub.no_tax_amt ) sellNoTaxAmt,
		SUM( sell_sngl_sub.tax_amt ) sellTaxAmt,
		SUM( sell_sngl_sub.prc_tax_sum ) sellPrcTaxSum,
		SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) KPQty,
		( ( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * cntn_tax_uprc ) - ( ( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * no_tax_uprc ) KPAmt,
		( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * no_tax_uprc KPTaxAmt,
		( SUM( sell_sngl_sub.qty ) - SUM( sell_sngl_sub.un_bllg_qty ) ) * cntn_tax_uprc KPAmtSum,
		sell_sngl.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		sell_sngl.acc_num accNum 
	FROM
		sell_sngl
		JOIN sell_sngl_sub ON sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = sell_sngl.acc_num 
	<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_sngl.sell_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND sell_sngl.sell_sngl_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and sell_sngl_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and sell_sngl_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_sngl_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and sell_sngl.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and sell_sngl.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and sell_sngl.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and sell_sngl.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and sell_sngl.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		rtn_goods_sub.bat_num batNum,
		rtn_goods_sub.invty_encd invtyEncd,
		rtn_goods_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		NULL qiChuQty,
		NULL qiChuNoTaxAmt,
		NULL qiChuTaxAmt,
		NULL qiChuPrcTaxSum,
		SUM( rtn_goods_sub.qty ) sellQty,
		SUM( rtn_goods_sub.no_tax_amt ) sellNoTaxAmt,
		SUM( rtn_goods_sub.tax_amt ) sellTaxAmt,
		SUM( rtn_goods_sub.prc_tax_sum ) sellPrcTaxSum,
		SUM( rtn_goods_sub.qty ) + SUM( rtn_goods_sub.un_bllg_qty ) KPQty,
		( ( SUM( rtn_goods_sub.qty ) + SUM( rtn_goods_sub.un_bllg_qty ) ) * cntn_tax_uprc ) - ( ( SUM( rtn_goods_sub.qty ) + SUM( rtn_goods_sub.un_bllg_qty ) ) * no_tax_uprc ) KPAmt,
		( SUM( rtn_goods_sub.qty ) + SUM( rtn_goods_sub.un_bllg_qty ) ) * no_tax_uprc KPTaxAmt,
		( SUM( rtn_goods_sub.qty ) + SUM( rtn_goods_sub.un_bllg_qty ) ) * cntn_tax_uprc KPAmtSum,
		rtn_goods.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		rtn_goods.acc_num accNum 
	FROM
		rtn_goods
		JOIN rtn_goods_sub ON rtn_goods.rtn_goods_id = rtn_goods_sub.rtn_goods_id
		LEFT JOIN mis_user ON mis_user.acc_num = rtn_goods.acc_num
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND rtn_goods.rtn_goods_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND rtn_goods.rtn_goods_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and rtn_goods_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and rtn_goods_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and rtn_goods_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and rtn_goods.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and rtn_goods.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and rtn_goods.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and rtn_goods.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and rtn_goods.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		entrs_agn_delv_sub.bat_num batNum,
		entrs_agn_delv_sub.invty_encd invtyEncd,
		entrs_agn_delv_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		NULL qiChuQty,
		NULL qiChuNoTaxAmt,
		NULL qiChuTaxAmt,
		NULL qiChuPrcTaxSum,
		SUM( entrs_agn_delv_sub.qty ) sellQty,
		SUM( entrs_agn_delv_sub.no_tax_amt ) sellNoTaxAmt,
		SUM( entrs_agn_delv_sub.tax_amt ) sellTaxAmt,
		SUM( entrs_agn_delv_sub.prc_tax_sum ) sellPrcTaxSum,
		SUM( bllg_qty ) KPQty,
		( SUM( bllg_qty ) * cntn_tax_uprc ) - ( SUM( bllg_qty ) * no_tax_uprc ) KPAmt,
		SUM( bllg_qty ) * no_tax_uprc KPTaxAmt,
		SUM( bllg_qty ) * cntn_tax_uprc KPAmtSum,
		entrs_agn_delv.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		entrs_agn_delv.acc_num accNum 
	FROM
		entrs_agn_delv
		JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id = entrs_agn_delv_sub.delv_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = entrs_agn_delv.acc_num 
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and entrs_agn_delv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and entrs_agn_delv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and entrs_agn_delv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and entrs_agn_delv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and entrs_agn_delv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and entrs_agn_delv.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and entrs_agn_delv.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and entrs_agn_delv.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		rtn_goods_sub.bat_num batNum,
		rtn_goods_sub.invty_encd invtyEncd,
		rtn_goods_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		SUM( rtn_goods_sub.un_bllg_qty ) qiChuQty,
		SUM( rtn_goods_sub.un_bllg_qty ) * no_tax_uprc qiChuNoTaxAmt,
		( SUM( rtn_goods_sub.un_bllg_qty ) * cntn_tax_uprc ) - ( SUM( rtn_goods_sub.un_bllg_qty ) * no_tax_uprc ) qiChuTaxAmt,
		SUM( rtn_goods_sub.un_bllg_qty ) * cntn_tax_uprc qiChuPrcTaxSum,
		NULL sellQty,
		NULL sellNoTaxAmt,
		NULL sellTaxAmt,
		NULL sellPrcTaxSum,
		NULL KPQty,
		NULL KPAmt,
		NULL KPTaxAmt,
		NULL KPAmtSum,
		rtn_goods.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		rtn_goods.acc_num accNum 
	FROM
		rtn_goods
		JOIN rtn_goods_sub ON rtn_goods.rtn_goods_id = rtn_goods_sub.rtn_goods_id
		LEFT JOIN mis_user ON mis_user.acc_num = rtn_goods.acc_num 
			<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND rtn_goods.rtn_goods_dt &lt;= #{fromDt1}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and rtn_goods_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and rtn_goods_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and rtn_goods_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and rtn_goods.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and rtn_goods.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and rtn_goods.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and rtn_goods.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and rtn_goods.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		entrs_agn_delv_sub.bat_num batNum,
		entrs_agn_delv_sub.invty_encd invtyEncd,
		entrs_agn_delv_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.qty ) qiChuQty,
		( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.qty ) ) * no_tax_uprc qiChuNoTaxAmt,
		( ( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.qty ) ) * cntn_tax_uprc ) - ( ( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.qty ) ) * no_tax_uprc ) qiChuTaxAmt,
		( SUM( entrs_agn_delv_sub.qty ) - SUM( entrs_agn_delv_sub.qty ) ) * cntn_tax_uprc qiChuPrcTaxSum,
		NULL sellQty,
		NULL sellNoTaxAmt,
		NULL sellTaxAmt,
		NULL sellPrcTaxSum,
		NULL KPQty,
		NULL KPAmt,
		NULL KPTaxAmt,
		NULL KPAmtSum,
		entrs_agn_delv.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		entrs_agn_delv.acc_num accNum 
	FROM
		entrs_agn_delv
		JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id = entrs_agn_delv_sub.delv_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = entrs_agn_delv.acc_num 
	<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt1}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and entrs_agn_delv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and entrs_agn_delv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and entrs_agn_delv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and entrs_agn_delv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and entrs_agn_delv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and entrs_agn_delv.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and entrs_agn_delv.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and entrs_agn_delv.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId UNION ALL
	SELECT
		sell_sngl_sub.bat_num batNum,
		sell_sngl_sub.invty_encd invtyEncd,
		sell_sngl_sub.whs_encd whsEncd,
		mis_user.dep_id depId,
		SUM( sell_sngl_sub.un_bllg_qty ) qiChuQty,
		SUM( sell_sngl_sub.un_bllg_qty ) * no_tax_uprc qiChuNoTaxAmt,
		( SUM( sell_sngl_sub.un_bllg_qty ) * cntn_tax_uprc ) - ( SUM( sell_sngl_sub.un_bllg_qty ) * no_tax_uprc ) qiChuTaxAmt,
		SUM( sell_sngl_sub.un_bllg_qty ) * cntn_tax_uprc qiChuPrcTaxSum,
		NULL sellQty,
		NULL sellNoTaxAmt,
		NULL sellTaxAmt,
		NULL sellPrcTaxSum,
		NULL KPQty,
		NULL KPAmt,
		NULL KPTaxAmt,
		NULL KPAmtSum,
		sell_sngl.cust_id custId,
		mis_user.dep_name depName,
		mis_user.user_name userName,
		sell_sngl.acc_num accNum 
	FROM
		sell_sngl
		JOIN sell_sngl_sub ON sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
		LEFT JOIN mis_user ON mis_user.acc_num = sell_sngl.acc_num 
		
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_sngl.sell_sngl_dt &lt;= #{fromDt1}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and sell_sngl_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and sell_sngl_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_sngl_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and sell_sngl.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and sell_sngl.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="bizTypId != null and bizTypId.size() >0">
				and sell_sngl.biz_typ_id 	  in  <foreach collection="bizTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="sellTypId != null and sellTypId.size() >0">
				and sell_sngl.sell_typ_id 	  in  <foreach collection="sellTypId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="recvSendCateId != null and recvSendCateId.size() >0">
				and sell_sngl.recv_send_cate_id 	  in  <foreach collection="recvSendCateId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where> 
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId 
	) b
	LEFT JOIN cust_doc ON cust_doc.cust_id = b.custId
	LEFT JOIN invty_doc ON invty_doc.invty_encd = b.invtyEncd
	LEFT JOIN whs_doc ON whs_doc.whs_encd = b.whsEncd
	LEFT JOIN invty_cls ON invty_doc.invty_cls_encd = invty_cls.invty_Cls_Encd 
	<where>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
				invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
	</where> 
		
	GROUP BY
		batNum,
		invtyEncd,
		whsEncd,
		depId) a

	</select>



	<select id="sellSalesStatisticsReport"
		resultType="com.px.mis.sell.entity.SalesStatisticsReport">
		SELECT
			date_format( sellSnglDt, '%Y-%m-%d %T' ) sellSnglDt,
			sellSnglId,
			SUM( cast( sellQty  AS DECIMAL ( 18, 2 ) ) ) sellQty,
			SUM( cast( sellnoTaxAmt  AS DECIMAL ( 18, 2 ) ) ) sellnoTaxAmt,
			SUM( cast( sellprcTaxSum   AS DECIMAL ( 18, 2 ) )) sellprcTaxSum,
			SUM( cast( sellOutQty   AS DECIMAL ( 18, 2 ) )) sellOutQty,
			SUM( cast( sellOutNoTaxAmt   AS DECIMAL ( 18, 2 ) )) sellOutNoTaxAmt,
			SUM( cast( sellOutPrcTaxSum  AS DECIMAL ( 18, 2 ) ) ) sellOutPrcTaxSum,
			SUM( cast( invQty  AS DECIMAL ( 18, 2 ) ) ) invQty,
			SUM( cast( invNoTaxAmt  AS DECIMAL ( 18, 2 ) ) ) invNoTaxAmt,
			SUM( cast( invPrcTaxSum  AS DECIMAL ( 18, 2 ) ) ) invPrcTaxSum,
			invtyEncd,
			custId,
			depName,
			depId,
			userName,
			accNum,
			custNm,
			invtyNm 
		FROM
			(
			SELECT
				sell_sngl.sell_sngl_dt sellSnglDt,
				sell_sngl.sell_sngl_id sellSnglId,
				SUM( sell_sngl_sub.qty ) sellQty,
				SUM( sell_sngl_sub.no_tax_amt ) sellnoTaxAmt,
				SUM( sell_sngl_sub.prc_tax_sum ) sellprcTaxSum,
				NULL sellOutQty,
				NULL sellOutNoTaxAmt,
				NULL sellOutPrcTaxSum,
				NULL invQty,
				NULL invNoTaxAmt,
				NULL invPrcTaxSum,
				sell_sngl_sub.invty_encd invtyEncd,
				sell_sngl.cust_id custId,
				mis_user.dep_name depName,
				mis_user.dep_id depId,
				mis_user.user_name userName,
				sell_sngl.acc_num accNum,
				cust_doc.cust_nm custNm,
				invty_doc.invty_nm invtyNm 
			FROM
				sell_sngl
				JOIN sell_sngl_sub ON sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
				LEFT JOIN cust_doc ON cust_doc.cust_id = sell_sngl.cust_id
				LEFT JOIN mis_user ON mis_user.acc_num = sell_sngl.acc_num
				LEFT JOIN invty_doc ON invty_doc.invty_encd = sell_sngl_sub.invty_encd 
				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND sell_sngl.sell_sngl_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND sell_sngl.sell_sngl_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and sell_sngl_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and sell_sngl_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and sell_sngl_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and sell_sngl.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and sell_sngl.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
				custId,
				invtyEncd 
				UNION ALL
			SELECT
				entrs_agn_delv.delv_sngl_dt sellSnglDt,
				entrs_agn_delv.delv_sngl_id sellSnglId,
				SUM( entrs_agn_delv_sub.qty ) sellQty,
				SUM( entrs_agn_delv_sub.no_tax_amt ) sellnoTaxAmt,
				SUM( entrs_agn_delv_sub.prc_tax_sum ) sellprcTaxSum,
				NULL sellOutQty,
				NULL sellOutNoTaxAmt,
				NULL sellOutPrcTaxSum,
				NULL invQty,
				NULL invNoTaxAmt,
				NULL invPrcTaxSum,
				entrs_agn_delv_sub.invty_encd invtyEncd,
				entrs_agn_delv.cust_id custId,
				mis_user.dep_name depName,
				mis_user.dep_id depId,
				mis_user.user_name userName,
				entrs_agn_delv.acc_num accNum,
				cust_doc.cust_nm custNm,
				invty_doc.invty_nm invtyNm  
			FROM
				entrs_agn_delv
				JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id = entrs_agn_delv_sub.delv_sngl_id
				LEFT JOIN cust_doc ON cust_doc.cust_id = entrs_agn_delv.cust_id
				LEFT JOIN mis_user ON mis_user.acc_num = entrs_agn_delv.acc_num
				LEFT JOIN invty_doc ON invty_doc.invty_encd = entrs_agn_delv_sub.invty_encd 
				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and entrs_agn_delv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and entrs_agn_delv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and entrs_agn_delv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and entrs_agn_delv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and entrs_agn_delv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and entrs_agn_delv.dept_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
				custId,
				invtyEncd 
				UNION ALL
	SELECT
		rtn_goods.rtn_goods_dt sellSnglDt,
		rtn_goods.rtn_goods_id sellSnglId,
		SUM( rtn_goods_sub.qty ) sellQty,
		SUM( rtn_goods_sub.no_tax_amt ) sellnoTaxAmt,
		SUM( rtn_goods_sub.prc_tax_sum ) sellprcTaxSum,
		NULL sellOutQty,
		NULL sellOutNoTaxAmt,
		NULL sellOutPrcTaxSum,
		NULL invQty,
		NULL invNoTaxAmt,
		NULL invPrcTaxSum,
		rtn_goods_sub.invty_encd invtyEncd,
		rtn_goods.cust_id custId,
		mis_user.dep_name depName,
		mis_user.dep_id depId,
		mis_user.user_name userName,
		rtn_goods.acc_num accNum,
		cust_doc.cust_nm custNm,
		invty_doc.invty_nm invtyNm 
	FROM
		rtn_goods
		JOIN rtn_goods_sub ON rtn_goods.rtn_goods_id = rtn_goods_sub.rtn_goods_id
		LEFT JOIN cust_doc ON cust_doc.cust_id = rtn_goods.cust_id
		LEFT JOIN mis_user ON mis_user.acc_num = rtn_goods.acc_num
		LEFT JOIN invty_doc ON invty_doc.invty_encd = rtn_goods_sub.invty_encd 

				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND rtn_goods.rtn_goods_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND rtn_goods.rtn_goods_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and rtn_goods_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and rtn_goods_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and rtn_goods_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and rtn_goods.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and rtn_goods.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
	GROUP BY
		custId,
		invtyEncd
		
				UNION ALL
				
				
				
				
			SELECT
				sell_out_whs.out_whs_dt sellOutWhsDt,
				sell_out_whs.out_whs_id sellOutWhsId,
				NULL sellQty,
				NULL sellnoTaxAmt,
				NULL sellprcTaxSum,
				SUM( sell_out_whs_sub.qty ) sellOutQty,
				SUM( sell_out_whs_sub.no_tax_amt ) sellOutNoTaxAmt,
				SUM( sell_out_whs_sub.prc_tax_sum ) sellOutPrcTaxSum,
				NULL invQty,
				NULL invNoTaxAmt,
				NULL invPrcTaxSum,
				sell_out_whs_sub.invty_encd invtyEncd,
				sell_out_whs.cust_id custId,
				mis_user.dep_name depName,
				mis_user.dep_id depId,
				mis_user.user_name userName,
				sell_out_whs.acc_num accNum,
				cust_doc.cust_nm custNm,
				invty_doc.invty_nm invtyNm 
			FROM
				sell_out_whs
				LEFT JOIN sell_out_whs_sub ON sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id
				LEFT JOIN cust_doc ON cust_doc.cust_id = sell_out_whs.cust_id
				LEFT JOIN mis_user ON mis_user.acc_num = sell_out_whs.acc_num
				LEFT JOIN invty_doc ON invty_doc.invty_encd = sell_out_whs_sub.invty_encd 
		<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND sell_out_whs.out_whs_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND sell_out_whs.out_whs_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and sell_out_whs_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and sell_out_whs_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and sell_out_whs_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and sell_out_whs.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and sell_out_whs.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
				custId,
				invtyEncd 
				
				
				UNION ALL
	SELECT
		sell_comn_inv.bllg_dt sellOutWhsDt,
		sell_comn_inv.sell_inv_num sellOutWhsId,
		NULL sellQty,
		NULL sellnoTaxAmt,
		NULL sellprcTaxSum,
		NULL sellOutQty,
		NULL sellOutNoTaxAmt,
		NULL sellOutPrcTaxSum,
		SUM( sell_comn_inv_sub.qty ) invQty,
		SUM( sell_comn_inv_sub.no_tax_amt ) invNoTaxAmt,
		SUM( sell_comn_inv_sub.prc_tax_sum ) invPrcTaxSum,
		sell_comn_inv_sub.invty_encd invtyEncd,
		sell_comn_inv.cust_id custId,
		mis_user.dep_name depName,
		mis_user.dep_id depId,
		mis_user.user_name userName,
		sell_comn_inv.acc_num accNum,
		cust_doc.cust_nm custNm,
		invty_doc.invty_nm invtyNm 
	FROM
		sell_comn_inv
		LEFT JOIN sell_comn_inv_sub ON sell_comn_inv.sell_inv_num = sell_comn_inv_sub.sell_inv_num
		LEFT JOIN cust_doc ON cust_doc.cust_id = sell_comn_inv.cust_id
		LEFT JOIN mis_user ON mis_user.acc_num = sell_comn_inv.acc_num
		LEFT JOIN invty_doc ON invty_doc.invty_encd = sell_comn_inv_sub.invty_encd 
				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND sell_comn_inv.bllg_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND sell_comn_inv.bllg_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and sell_comn_inv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and sell_comn_inv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and sell_comn_inv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and sell_comn_inv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and sell_comn_inv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
		custId,
		invtyEncd 
				
				
			) a 
		GROUP BY
			custId,
			invtyEncd
		
  	ORDER BY 
  	<if test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
		${sort} ${sortOrder},
	</if> 
	sellSnglDt DESC
	
	<if test="index != null  and  num != null ">
		LIMIT #{index},#{num}
	</if>	
	</select>
	<!--查询总计 -->
	<select id="sellSalesStatisticsReportSums"
		resultType="map">
		SELECT
			SUM( cast( sellQty  AS DECIMAL ( 18, 2 ) ) ) sellQty,
			SUM( cast( sellnoTaxAmt  AS DECIMAL ( 18, 2 ) ) ) sellnoTaxAmt,
			SUM( cast( sellprcTaxSum   AS DECIMAL ( 18, 2 ) )) sellprcTaxSum,
			SUM( cast( sellOutQty   AS DECIMAL ( 18, 2 ) )) sellOutQty,
			SUM( cast( sellOutNoTaxAmt   AS DECIMAL ( 18, 2 ) )) sellOutNoTaxAmt,
			SUM( cast( sellOutPrcTaxSum  AS DECIMAL ( 18, 2 ) ) ) sellOutPrcTaxSum,
			SUM( cast( invQty  AS DECIMAL ( 18, 2 ) ) ) invQty,
			SUM( cast( invNoTaxAmt  AS DECIMAL ( 18, 2 ) ) ) invNoTaxAmt,
			SUM( cast( invPrcTaxSum  AS DECIMAL ( 18, 2 ) ) ) invPrcTaxSum
		FROM
			(
			SELECT
				sell_sngl.sell_sngl_dt sellSnglDt,
				sell_sngl.sell_sngl_id sellSnglId,
				SUM( sell_sngl_sub.qty ) sellQty,
				SUM( sell_sngl_sub.no_tax_amt ) sellnoTaxAmt,
				SUM( sell_sngl_sub.prc_tax_sum ) sellprcTaxSum,
				NULL sellOutQty,
				NULL sellOutNoTaxAmt,
				NULL sellOutPrcTaxSum,
				NULL invQty,
				NULL invNoTaxAmt,
				NULL invPrcTaxSum,
				sell_sngl_sub.invty_encd invtyEncd,
				sell_sngl.cust_id custId,
				mis_user.dep_name depName,
				mis_user.dep_id depId,
				mis_user.user_name userName,
				sell_sngl.acc_num accNum,
				cust_doc.cust_nm custNm,
				invty_doc.invty_nm invtyNm 
			FROM
				sell_sngl
				JOIN sell_sngl_sub ON sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
				LEFT JOIN cust_doc ON cust_doc.cust_id = sell_sngl.cust_id
				LEFT JOIN mis_user ON mis_user.acc_num = sell_sngl.acc_num
				LEFT JOIN invty_doc ON invty_doc.invty_encd = sell_sngl_sub.invty_encd 
				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND sell_sngl.sell_sngl_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND sell_sngl.sell_sngl_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and sell_sngl_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and sell_sngl_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and sell_sngl_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and sell_sngl.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and sell_sngl.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
				custId,
				invtyEncd 
				UNION ALL
			SELECT
				entrs_agn_delv.delv_sngl_dt sellSnglDt,
				entrs_agn_delv.delv_sngl_id sellSnglId,
				SUM( entrs_agn_delv_sub.qty ) sellQty,
				SUM( entrs_agn_delv_sub.no_tax_amt ) sellnoTaxAmt,
				SUM( entrs_agn_delv_sub.prc_tax_sum ) sellprcTaxSum,
				NULL sellOutQty,
				NULL sellOutNoTaxAmt,
				NULL sellOutPrcTaxSum,
				NULL invQty,
				NULL invNoTaxAmt,
				NULL invPrcTaxSum,
				entrs_agn_delv_sub.invty_encd invtyEncd,
				entrs_agn_delv.cust_id custId,
				mis_user.dep_name depName,
				mis_user.dep_id depId,
				mis_user.user_name userName,
				entrs_agn_delv.acc_num accNum,
				cust_doc.cust_nm custNm,
				invty_doc.invty_nm invtyNm  
			FROM
				entrs_agn_delv
				JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id = entrs_agn_delv_sub.delv_sngl_id
				LEFT JOIN cust_doc ON cust_doc.cust_id = entrs_agn_delv.cust_id
				LEFT JOIN mis_user ON mis_user.acc_num = entrs_agn_delv.acc_num
				LEFT JOIN invty_doc ON invty_doc.invty_encd = entrs_agn_delv_sub.invty_encd 
				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and entrs_agn_delv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and entrs_agn_delv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and entrs_agn_delv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and entrs_agn_delv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and entrs_agn_delv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and entrs_agn_delv.dept_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
				custId,
				invtyEncd 
				UNION ALL
	SELECT
		rtn_goods.rtn_goods_dt sellSnglDt,
		rtn_goods.rtn_goods_id sellSnglId,
		SUM( rtn_goods_sub.qty ) sellQty,
		SUM( rtn_goods_sub.no_tax_amt ) sellnoTaxAmt,
		SUM( rtn_goods_sub.prc_tax_sum ) sellprcTaxSum,
		NULL sellOutQty,
		NULL sellOutNoTaxAmt,
		NULL sellOutPrcTaxSum,
		NULL invQty,
		NULL invNoTaxAmt,
		NULL invPrcTaxSum,
		rtn_goods_sub.invty_encd invtyEncd,
		rtn_goods.cust_id custId,
		mis_user.dep_name depName,
		mis_user.dep_id depId,
		mis_user.user_name userName,
		rtn_goods.acc_num accNum,
		cust_doc.cust_nm custNm,
		invty_doc.invty_nm invtyNm 
	FROM
		rtn_goods
		JOIN rtn_goods_sub ON rtn_goods.rtn_goods_id = rtn_goods_sub.rtn_goods_id
		LEFT JOIN cust_doc ON cust_doc.cust_id = rtn_goods.cust_id
		LEFT JOIN mis_user ON mis_user.acc_num = rtn_goods.acc_num
		LEFT JOIN invty_doc ON invty_doc.invty_encd = rtn_goods_sub.invty_encd 

				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND rtn_goods.rtn_goods_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND rtn_goods.rtn_goods_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and rtn_goods_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and rtn_goods_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and rtn_goods_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and rtn_goods.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and rtn_goods.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
	GROUP BY
		custId,
		invtyEncd
		
				UNION ALL
				
				
				
				
			SELECT
				sell_out_whs.out_whs_dt sellOutWhsDt,
				sell_out_whs.out_whs_id sellOutWhsId,
				NULL sellQty,
				NULL sellnoTaxAmt,
				NULL sellprcTaxSum,
				SUM( sell_out_whs_sub.qty ) sellOutQty,
				SUM( sell_out_whs_sub.no_tax_amt ) sellOutNoTaxAmt,
				SUM( sell_out_whs_sub.prc_tax_sum ) sellOutPrcTaxSum,
				NULL invQty,
				NULL invNoTaxAmt,
				NULL invPrcTaxSum,
				sell_out_whs_sub.invty_encd invtyEncd,
				sell_out_whs.cust_id custId,
				mis_user.dep_name depName,
				mis_user.dep_id depId,
				mis_user.user_name userName,
				sell_out_whs.acc_num accNum,
				cust_doc.cust_nm custNm,
				invty_doc.invty_nm invtyNm 
			FROM
				sell_out_whs
				LEFT JOIN sell_out_whs_sub ON sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id
				LEFT JOIN cust_doc ON cust_doc.cust_id = sell_out_whs.cust_id
				LEFT JOIN mis_user ON mis_user.acc_num = sell_out_whs.acc_num
				LEFT JOIN invty_doc ON invty_doc.invty_encd = sell_out_whs_sub.invty_encd 
		<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND sell_out_whs.out_whs_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND sell_out_whs.out_whs_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and sell_out_whs_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and sell_out_whs_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and sell_out_whs_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and sell_out_whs.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and sell_out_whs.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
				custId,
				invtyEncd 
				
				
				UNION ALL
	SELECT
		sell_comn_inv.bllg_dt sellOutWhsDt,
		sell_comn_inv.sell_inv_num sellOutWhsId,
		NULL sellQty,
		NULL sellnoTaxAmt,
		NULL sellprcTaxSum,
		NULL sellOutQty,
		NULL sellOutNoTaxAmt,
		NULL sellOutPrcTaxSum,
		SUM( sell_comn_inv_sub.qty ) invQty,
		SUM( sell_comn_inv_sub.no_tax_amt ) invNoTaxAmt,
		SUM( sell_comn_inv_sub.prc_tax_sum ) invPrcTaxSum,
		sell_comn_inv_sub.invty_encd invtyEncd,
		sell_comn_inv.cust_id custId,
		mis_user.dep_name depName,
		mis_user.dep_id depId,
		mis_user.user_name userName,
		sell_comn_inv.acc_num accNum,
		cust_doc.cust_nm custNm,
		invty_doc.invty_nm invtyNm 
	FROM
		sell_comn_inv
		LEFT JOIN sell_comn_inv_sub ON sell_comn_inv.sell_inv_num = sell_comn_inv_sub.sell_inv_num
		LEFT JOIN cust_doc ON cust_doc.cust_id = sell_comn_inv.cust_id
		LEFT JOIN mis_user ON mis_user.acc_num = sell_comn_inv.acc_num
		LEFT JOIN invty_doc ON invty_doc.invty_encd = sell_comn_inv_sub.invty_encd 
				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND sell_comn_inv.bllg_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND sell_comn_inv.bllg_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and sell_comn_inv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and sell_comn_inv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and sell_comn_inv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and sell_comn_inv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and sell_comn_inv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
		custId,
		invtyEncd 
				
				
			) a 
	</select>
	<select id="sellSalesStatisticsReportCount" resultType="Integer">
		
	SELECT
		count( * ) 
	FROM (

		SELECT
			sellSnglId,
			SUM( sellQty ) sellQty
		
		FROM
			(
			SELECT
				sell_sngl.sell_sngl_dt sellSnglDt,
				sell_sngl.sell_sngl_id sellSnglId,
				SUM( sell_sngl_sub.qty ) sellQty,
				SUM( sell_sngl_sub.no_tax_amt ) sellnoTaxAmt,
				SUM( sell_sngl_sub.prc_tax_sum ) sellprcTaxSum,
				NULL sellOutQty,
				NULL sellOutNoTaxAmt,
				NULL sellOutPrcTaxSum,
				NULL invQty,
				NULL invNoTaxAmt,
				NULL invPrcTaxSum,
				sell_sngl_sub.invty_encd invtyEncd,
				sell_sngl.cust_id custId,
				mis_user.dep_name depName,
				mis_user.dep_id depId,
				mis_user.user_name userName,
				sell_sngl.acc_num accNum,
				cust_doc.cust_nm custNm,
				invty_doc.invty_nm invtyNm 
			FROM
				sell_sngl
				JOIN sell_sngl_sub ON sell_sngl.sell_sngl_id = sell_sngl_sub.sell_sngl_id
				LEFT JOIN cust_doc ON cust_doc.cust_id = sell_sngl.cust_id
				LEFT JOIN mis_user ON mis_user.acc_num = sell_sngl.acc_num
				LEFT JOIN invty_doc ON invty_doc.invty_encd = sell_sngl_sub.invty_encd 
				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND sell_sngl.sell_sngl_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND sell_sngl.sell_sngl_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and sell_sngl_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and sell_sngl_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and sell_sngl_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and sell_sngl.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and sell_sngl.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
				custId,
				invtyEncd 
				UNION ALL
							SELECT
				entrs_agn_delv.delv_sngl_dt sellSnglDt,
				entrs_agn_delv.delv_sngl_id sellSnglId,
				SUM( entrs_agn_delv_sub.qty ) sellQty,
				SUM( entrs_agn_delv_sub.no_tax_amt ) sellnoTaxAmt,
				SUM( entrs_agn_delv_sub.prc_tax_sum ) sellprcTaxSum,
				NULL sellOutQty,
				NULL sellOutNoTaxAmt,
				NULL sellOutPrcTaxSum,
				NULL invQty,
				NULL invNoTaxAmt,
				NULL invPrcTaxSum,
				entrs_agn_delv_sub.invty_encd invtyEncd,
				entrs_agn_delv.cust_id custId,
				mis_user.dep_name depName,
				mis_user.dep_id depId,
				mis_user.user_name userName,
				entrs_agn_delv.acc_num accNum,
				cust_doc.cust_nm custNm,
				invty_doc.invty_nm invtyNm  
			FROM
				entrs_agn_delv
				JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id = entrs_agn_delv_sub.delv_sngl_id
				LEFT JOIN cust_doc ON cust_doc.cust_id = entrs_agn_delv.cust_id
				LEFT JOIN mis_user ON mis_user.acc_num = entrs_agn_delv.acc_num
				LEFT JOIN invty_doc ON invty_doc.invty_encd = entrs_agn_delv_sub.invty_encd 
				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and entrs_agn_delv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and entrs_agn_delv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and entrs_agn_delv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and entrs_agn_delv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and entrs_agn_delv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and entrs_agn_delv.dept_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
				custId,
				invtyEncd 
				UNION ALL
	SELECT
		rtn_goods.rtn_goods_dt sellSnglDt,
		rtn_goods.rtn_goods_id sellSnglId,
		SUM( rtn_goods_sub.qty ) sellQty,
		SUM( rtn_goods_sub.no_tax_amt ) sellnoTaxAmt,
		SUM( rtn_goods_sub.prc_tax_sum ) sellprcTaxSum,
		NULL sellOutQty,
		NULL sellOutNoTaxAmt,
		NULL sellOutPrcTaxSum,
		NULL invQty,
		NULL invNoTaxAmt,
		NULL invPrcTaxSum,
		rtn_goods_sub.invty_encd invtyEncd,
		rtn_goods.cust_id custId,
		mis_user.dep_name depName,
		mis_user.dep_id depId,
		mis_user.user_name userName,
		rtn_goods.acc_num accNum,
		cust_doc.cust_nm custNm,
		invty_doc.invty_nm invtyNm 
	FROM
		rtn_goods
		JOIN rtn_goods_sub ON rtn_goods.rtn_goods_id = rtn_goods_sub.rtn_goods_id
		LEFT JOIN cust_doc ON cust_doc.cust_id = rtn_goods.cust_id
		LEFT JOIN mis_user ON mis_user.acc_num = rtn_goods.acc_num
		LEFT JOIN invty_doc ON invty_doc.invty_encd = rtn_goods_sub.invty_encd 

				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND rtn_goods.rtn_goods_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND rtn_goods.rtn_goods_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and rtn_goods_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and rtn_goods_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and rtn_goods_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and rtn_goods.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and rtn_goods.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
	GROUP BY
		custId,
		invtyEncd
		
				UNION ALL
				
				
				
				
			SELECT
				sell_out_whs.out_whs_dt sellOutWhsDt,
				sell_out_whs.out_whs_id sellOutWhsId,
				NULL sellQty,
				NULL sellnoTaxAmt,
				NULL sellprcTaxSum,
				SUM( sell_out_whs_sub.qty ) sellOutQty,
				SUM( sell_out_whs_sub.no_tax_amt ) sellOutNoTaxAmt,
				SUM( sell_out_whs_sub.prc_tax_sum ) sellOutPrcTaxSum,
				NULL invQty,
				NULL invNoTaxAmt,
				NULL invPrcTaxSum,
				sell_out_whs_sub.invty_encd invtyEncd,
				sell_out_whs.cust_id custId,
				mis_user.dep_name depName,
				mis_user.dep_id depId,
				mis_user.user_name userName,
				sell_out_whs.acc_num accNum,
				cust_doc.cust_nm custNm,
				invty_doc.invty_nm invtyNm 
			FROM
				sell_out_whs
				LEFT JOIN sell_out_whs_sub ON sell_out_whs.out_whs_id = sell_out_whs_sub.out_whs_id
				LEFT JOIN cust_doc ON cust_doc.cust_id = sell_out_whs.cust_id
				LEFT JOIN mis_user ON mis_user.acc_num = sell_out_whs.acc_num
				LEFT JOIN invty_doc ON invty_doc.invty_encd = sell_out_whs_sub.invty_encd 
		<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND sell_out_whs.out_whs_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND sell_out_whs.out_whs_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and sell_out_whs_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and sell_out_whs_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and sell_out_whs_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and sell_out_whs.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and sell_out_whs.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
				custId,
				invtyEncd 
				
				
				UNION ALL
	SELECT
		sell_comn_inv.bllg_dt sellOutWhsDt,
		sell_comn_inv.sell_inv_num sellOutWhsId,
		NULL sellQty,
		NULL sellnoTaxAmt,
		NULL sellprcTaxSum,
		NULL sellOutQty,
		NULL sellOutNoTaxAmt,
		NULL sellOutPrcTaxSum,
		SUM( sell_comn_inv_sub.qty ) invQty,
		SUM( sell_comn_inv_sub.no_tax_amt ) invNoTaxAmt,
		SUM( sell_comn_inv_sub.prc_tax_sum ) invPrcTaxSum,
		sell_comn_inv_sub.invty_encd invtyEncd,
		sell_comn_inv.cust_id custId,
		mis_user.dep_name depName,
		mis_user.dep_id depId,
		mis_user.user_name userName,
		sell_comn_inv.acc_num accNum,
		cust_doc.cust_nm custNm,
		invty_doc.invty_nm invtyNm 
	FROM
		sell_comn_inv
		LEFT JOIN sell_comn_inv_sub ON sell_comn_inv.sell_inv_num = sell_comn_inv_sub.sell_inv_num
		LEFT JOIN cust_doc ON cust_doc.cust_id = sell_comn_inv.cust_id
		LEFT JOIN mis_user ON mis_user.acc_num = sell_comn_inv.acc_num
		LEFT JOIN invty_doc ON invty_doc.invty_encd = sell_comn_inv_sub.invty_encd 
				<where>
					<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
						AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="fromDt1 != null and fromDt1 != ''">
						AND sell_comn_inv.bllg_dt &gt;= #{fromDt1}
					</if>
					<if test="fromDt2 != null and fromDt2 != ''">
						AND sell_comn_inv.bllg_dt &lt;= #{fromDt2}
					</if>
					<if test="batNum != null and batNum.size() >0">
						and sell_comn_inv_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="invtyEncd != null and invtyEncd.size() >0">
						and sell_comn_inv_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="whsEncd != null and whsEncd.size() >0">
						and sell_comn_inv_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="custId != null and custId.size() >0">
						and sell_comn_inv.cust_id   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="accNum != null and accNum.size() >0">
						and sell_comn_inv.acc_num    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="depId != null and depId.size() >0">
						and mis_user.dep_id    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
					<if test="clsId != null and clsId.size() >0">
						and cust_doc.cls_id    in  <foreach collection="clsId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
					</if>
				</where>
			GROUP BY
		custId,
		invtyEncd 
			) a 
		GROUP BY
			custId,
			invtyEncd
		ORDER BY
			invtyEncd
	) s
	</select>

	<select id="sellProcurementNowStokReport"
		resultType="com.px.mis.sell.entity.ProcurementNowStokReport">
		SELECT
		whsEncd,
		invtyEncd,
		batNum,
		invty_doc.bx_rule  bxQty,
		intoWhsQty,
		intooutCannibQty,
		sellOutWhsQty,
		outCannibQty,
		invty_tab.now_stok nowStok,
		invty_tab.aval_qty avalQty,
		date_format(prdcDt,'%Y-%m-%d %T') prdcDt,
		baoZhQi,	
		date_format(invldtnDt,'%Y-%m-%d %T') invldtnDt,
		invty_doc.ref_cost refCost,
		whs_doc.whs_nm whsNm,
		invty_doc.invty_nm
		invtyNm,
		invty_doc.spc_model spcModel,
		measr_corp_doc.measr_corp_nm
		measrCorpNm
		FROM
		(
		SELECT
		whsEncd,
		invtyEncd,
		batNum,
		SUM(intoWhsQty)
		intoWhsQty,
		SUM(intooutCannibQty) intooutCannibQty,
		SUM(sellOutWhsQty)
		sellOutWhsQty,
		SUM(outCannibQty) outCannibQty,
		prdcDt,
		baoZhQi,
		invldtnDt
		FROM
		(
		SELECT
		into_whs_sub.whs_encd whsEncd,
		into_whs_sub.invty_encd
		invtyEncd,
		into_whs_sub.bat_num batNum,
		SUM(into_whs_sub.qty) intoWhsQty,
		0 intooutCannibQty,
		0 sellOutWhsQty,
		0
		outCannibQty,
		into_whs_sub.prdc_dt prdcDt,
		into_whs_sub.bao_zhi_qi
		baoZhQi,
		into_whs_sub.invldtn_dt invldtnDt
		FROM
		into_whs
		LEFT JOIN
		into_whs_sub ON into_whs.into_whs_sngl_id =
		into_whs_sub.into_whs_sngl_id
		

		<where>
		AND into_whs.is_nt_chk = 0
			<!-- <if test="fromDt1 != null and fromDt1 != ''">
				AND into_whs.into_whs_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND into_whs.into_whs_dt &lt;= #{fromDt2}
			</if> -->
			<if test="batNum != null and batNum.size() >0">
				and into_whs_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and into_whs_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and into_whs_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		UNION ALL
		SELECT
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd
		invtyEncd,
		oth_out_into_whs_sub_tab.bat_num batNum,
		SUM(
		oth_out_into_whs_sub_tab.qty
		) intoWhsQty,
		0 intooutCannibQty,
		0
		sellOutWhsQty,
		0 outCannibQty,
		NULL prdcDt,
		NULL baoZhQi,
		NULL invldtnDt
		FROM
		oth_out_into_whs
		LEFT JOIN oth_out_into_whs_sub_tab ON
		oth_out_into_whs.form_num =
		oth_out_into_whs_sub_tab.form_num

		<where>
			oth_out_into_whs.is_nt_chk = 0
		AND oth_out_into_whs.form_typ_encd = "014" 
			<!-- <if test="fromDt1 != null and fromDt1 != ''">
				AND oth_out_into_whs.form_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND oth_out_into_whs.form_dt &lt;= #{fromDt2}
			</if> -->
			<if test="batNum != null and batNum.size() >0">
				and oth_out_into_whs_sub_tab.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and oth_out_into_whs_sub_tab.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and oth_out_into_whs.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>

		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		UNION ALL
		SELECT
		cannib_sngl.tran_in_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id
		invtyEncd,
		cannib_sngl_sub_tab.bat_num batNum,
		0 intoWhsQty,
		SUM(
		cannib_sngl_sub_tab.cannib_qty
		) intooutCannibQty,
		0 sellOutWhsQty,
		0 outCannibQty,
		NULL prdcDt,
		NULL baoZhQi,
		NULL invldtnDt
		FROM
		cannib_sngl
		LEFT JOIN cannib_sngl_sub_tab ON cannib_sngl.form_num =
		cannib_sngl_sub_tab.form_num

		<where>
				AND cannib_sngl.is_nt_chk = 0
			<!-- <if test="fromDt1 != null and fromDt1 != ''">
				AND cannib_sngl.form_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND cannib_sngl.form_dt &lt;= #{fromDt2}
			</if> -->
			<if test="batNum != null and batNum.size() >0">
				and cannib_sngl_sub_tab.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and cannib_sngl_sub_tab.invty_id 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and cannib_sngl.tran_in_whs_encd  	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>


		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		UNION ALL
		SELECT
		cannib_sngl.tran_out_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id
		invtyEncd,
		cannib_sngl_sub_tab.bat_num batNum,
		0 intoWhsQty,
		0 intooutCannibQty,
		0 sellOutWhsQty,
		SUM(
		cannib_sngl_sub_tab.cannib_qty
		) outCannibQty,
		NULL prdcDt,
		NULL baoZhQi,
		NULL invldtnDt
		FROM
		cannib_sngl
		LEFT JOIN cannib_sngl_sub_tab ON cannib_sngl.form_num =
		cannib_sngl_sub_tab.form_num

		<where>
				cannib_sngl.is_nt_chk = 0
			<!-- <if test="fromDt1 != null and fromDt1 != ''">
				AND cannib_sngl.form_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND cannib_sngl.form_dt &lt;= #{fromDt2}
			</if> -->
			<if test="batNum != null and batNum.size() >0">
				and cannib_sngl_sub_tab.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and cannib_sngl_sub_tab.invty_id 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and cannib_sngl.tran_out_whs_encd  	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>

		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		UNION ALL
		SELECT
		sell_out_whs_sub.whs_encd whsEncd,
		sell_out_whs_sub.invty_encd
		invtyEncd,
		sell_out_whs_sub.bat_num batNum,
		0 intoWhsQty,
		0
		intooutCannibQty,
		SUM(sell_out_whs_sub.qty) sellOutWhsQty,
		0
		outCannibQty,
		NULL prdcDt,
		NULL baoZhQi,
		NULL invldtnDt
		FROM
		sell_out_whs
		LEFT JOIN sell_out_whs_sub ON sell_out_whs.out_whs_id =
		sell_out_whs_sub.out_whs_id
		<where>
				sell_out_whs.is_nt_chk = 0
			<!-- <if test="fromDt1 != null and fromDt1 != ''">
				AND sell_out_whs.out_whs_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND sell_out_whs.out_whs_dt &lt;= #{fromDt2}
			</if> -->
			<if test="batNum != null and batNum.size() >0">
				and sell_out_whs_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and sell_out_whs_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_out_whs_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		) a
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		) s
		LEFT JOIN invty_tab ON (
		invty_tab.invty_encd = s.invtyEncd
		AND
		invty_tab.bat_Num = s.batNum
		AND invty_tab.whs_encd = s.whsEncd
		)
		LEFT
		JOIN invty_doc ON (
		invty_doc.invty_encd = s.invtyEncd
		)
		LEFT JOIN
		measr_corp_doc ON (
		invty_doc.measr_corp_id =
		measr_corp_doc.measr_corp_id
		)
		LEFT JOIN whs_doc ON (whs_doc.whs_encd =
		s.whsEncd)
		LEFT JOIN invty_cls ON (
		invty_doc.invty_cls_encd =
		invty_cls.invty_cls_encd

		)
		<where>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
				AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	<if test="sort != null and sort != '' and sortOrder !=null and sortOrder != '' ">
			ORDER BY ${sort} ${sortOrder}
	</if>
	<if test="index != null  and  num != null ">
		LIMIT #{index},#{num}
	</if>	
	</select>
	<!--销售现存量报表总计  -->
	<select id="sellProcurementNowStokReportSums"
		resultType="map">
		SELECT
		intoWhsQty,
		intooutCannibQty,
		sellOutWhsQty,
		outCannibQty,
		invty_tab.now_stok nowStok,
		invty_tab.aval_qty avalQty
		FROM
		(
		SELECT
		SUM(intoWhsQty) intoWhsQty,
    	SUM(intooutCannibQty) intooutCannibQty,
    	SUM(sellOutWhsQty) sellOutWhsQty,
   	 	SUM(outCannibQty) outCannibQty,
    	invtyEncd,
    	batNum,
    	whsEncd
		FROM
		(
		SELECT
		into_whs_sub.whs_encd whsEncd,
      	into_whs_sub.invty_encd invtyEncd,
      	into_whs_sub.bat_num batNum,
      	SUM(into_whs_sub.qty) intoWhsQty,
      	0 intooutCannibQty,
      	0 sellOutWhsQty,
      	0 outCannibQty
		FROM
		into_whs
		LEFT JOIN
		into_whs_sub ON into_whs.into_whs_sngl_id =
		into_whs_sub.into_whs_sngl_id
		

		<where>
		AND into_whs.is_nt_chk = 0
			<!-- <if test="fromDt1 != null and fromDt1 != ''">
				AND into_whs.into_whs_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND into_whs.into_whs_dt &lt;= #{fromDt2}
			</if> -->
			<if test="batNum != null and batNum.size() >0">
				and into_whs_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and into_whs_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and into_whs_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
		UNION ALL
		SELECT
		oth_out_into_whs.whs_encd whsEncd,
      oth_out_into_whs_sub_tab.invty_encd invtyEncd,
      oth_out_into_whs_sub_tab.bat_num batNum,
      SUM(oth_out_into_whs_sub_tab.qty) intoWhsQty,
      0 intooutCannibQty,
      0 sellOutWhsQty,
      0 outCannibQty
		FROM
		oth_out_into_whs
		LEFT JOIN oth_out_into_whs_sub_tab ON
		oth_out_into_whs.form_num =
		oth_out_into_whs_sub_tab.form_num

		<where>
			oth_out_into_whs.is_nt_chk = 0
		AND oth_out_into_whs.form_typ_encd = "014" 
			<!-- <if test="fromDt1 != null and fromDt1 != ''">
				AND oth_out_into_whs.form_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND oth_out_into_whs.form_dt &lt;= #{fromDt2}
			</if> -->
			<if test="batNum != null and batNum.size() >0">
				and oth_out_into_whs_sub_tab.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and oth_out_into_whs_sub_tab.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and oth_out_into_whs.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
		UNION ALL
		SELECT
		cannib_sngl.tran_in_whs_encd whsEncd,
      cannib_sngl_sub_tab.invty_id invtyEncd,
      cannib_sngl_sub_tab.bat_num batNum,
      0 intoWhsQty,
      SUM(cannib_sngl_sub_tab.cannib_qty) intooutCannibQty,
      0 sellOutWhsQty,
      0 outCannibQty
		FROM
		cannib_sngl
		LEFT JOIN cannib_sngl_sub_tab ON cannib_sngl.form_num =
		cannib_sngl_sub_tab.form_num

		<where>
				AND cannib_sngl.is_nt_chk = 0
			<!-- <if test="fromDt1 != null and fromDt1 != ''">
				AND cannib_sngl.form_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND cannib_sngl.form_dt &lt;= #{fromDt2}
			</if> -->
			<if test="batNum != null and batNum.size() >0">
				and cannib_sngl_sub_tab.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and cannib_sngl_sub_tab.invty_id 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and cannib_sngl.tran_in_whs_encd  	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
		UNION ALL
		SELECT
		cannib_sngl.tran_out_whs_encd whsEncd,
      cannib_sngl_sub_tab.invty_id invtyEncd,
      cannib_sngl_sub_tab.bat_num batNum,
      0 intoWhsQty,
      0 intooutCannibQty,
      0 sellOutWhsQty,
      SUM(cannib_sngl_sub_tab.cannib_qty) outCannibQty
		FROM
		cannib_sngl
		LEFT JOIN cannib_sngl_sub_tab ON cannib_sngl.form_num =
		cannib_sngl_sub_tab.form_num

		<where>
				cannib_sngl.is_nt_chk = 0
			<!-- <if test="fromDt1 != null and fromDt1 != ''">
				AND cannib_sngl.form_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND cannib_sngl.form_dt &lt;= #{fromDt2}
			</if> -->
			<if test="batNum != null and batNum.size() >0">
				and cannib_sngl_sub_tab.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and cannib_sngl_sub_tab.invty_id 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and cannib_sngl.tran_out_whs_encd  	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>

		UNION ALL
		SELECT
		      sell_out_whs_sub.whs_encd whsEncd,
      sell_out_whs_sub.invty_encd invtyEncd,
      sell_out_whs_sub.bat_num batNum,
      0 intoWhsQty,
      0 intooutCannibQty,
      SUM(sell_out_whs_sub.qty) sellOutWhsQty,
      0 outCannibQty
      FROM
		sell_out_whs
		LEFT JOIN sell_out_whs_sub ON sell_out_whs.out_whs_id =
		sell_out_whs_sub.out_whs_id
		<where>
				sell_out_whs.is_nt_chk = 0
			<!-- <if test="fromDt1 != null and fromDt1 != ''">
				AND sell_out_whs.out_whs_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND sell_out_whs.out_whs_dt &lt;= #{fromDt2}
			</if> -->
			<if test="batNum != null and batNum.size() >0">
				and sell_out_whs_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and sell_out_whs_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_out_whs_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
		) a ) s
		LEFT JOIN invty_tab ON (
		invty_tab.invty_encd = s.invtyEncd
		AND
		invty_tab.bat_Num = s.batNum
		AND invty_tab.whs_encd = s.whsEncd
		)
		LEFT
		JOIN invty_doc ON (
		invty_doc.invty_encd = s.invtyEncd
		)
		LEFT JOIN
		measr_corp_doc ON (
		invty_doc.measr_corp_id =
		measr_corp_doc.measr_corp_id
		)
		LEFT JOIN whs_doc ON (whs_doc.whs_encd =
		s.whsEncd)
		LEFT JOIN invty_cls ON (
		invty_doc.invty_cls_encd =
		invty_cls.invty_cls_encd

		)
		<where>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
				AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
	</select>
	
	<select id="sellProcurementNowStokReportCount"
		resultType="Integer">

		SELECT
		count(*)
		FROM
		(
		SELECT
		whsEncd,
		invtyEncd,
		batNum,
		bxQty,
		SUM(intoWhsQty) intoWhsQty,
		SUM(intooutCannibQty) intooutCannibQty,
		SUM(sellOutWhsQty) sellOutWhsQty,
		SUM(outCannibQty) outCannibQty,
		prdcDt,
		baoZhQi,
		invldtnDt
		FROM
		(
		SELECT
		into_whs_sub.whs_encd whsEncd,
		into_whs_sub.invty_encd invtyEncd,
		into_whs_sub.bat_num batNum,
		into_whs_sub.bx_qty bxQty,
		SUM(into_whs_sub.qty) intoWhsQty,
		0
		intooutCannibQty,
		0 sellOutWhsQty,
		0 outCannibQty,
		into_whs_sub.prdc_dt
		prdcDt,
		into_whs_sub.bao_zhi_qi baoZhQi,
		into_whs_sub.invldtn_dt
		invldtnDt
		FROM
		into_whs
		LEFT JOIN into_whs_sub ON
		into_whs.into_whs_sngl_id =
		into_whs_sub.into_whs_sngl_id
		

		<where>
		AND
		into_whs.is_nt_chk = 0
			<if test="fromDt1 != null and fromDt1 != ''">
				AND into_whs.into_whs_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND into_whs.into_whs_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and into_whs_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and into_whs_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and into_whs_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		UNION ALL
		SELECT
		oth_out_into_whs.whs_encd whsEncd,
		oth_out_into_whs_sub_tab.invty_encd
		invtyEncd,
		oth_out_into_whs_sub_tab.bat_num batNum,
		NULL bxQty,
		SUM(
		oth_out_into_whs_sub_tab.qty
		) intoWhsQty,
		0 intooutCannibQty,
		0
		sellOutWhsQty,
		0 outCannibQty,
		NULL prdcDt,
		NULL baoZhQi,
		NULL invldtnDt
		FROM
		oth_out_into_whs
		LEFT JOIN oth_out_into_whs_sub_tab ON
		oth_out_into_whs.form_num =
		oth_out_into_whs_sub_tab.form_num
	
		<where>
			AND
		oth_out_into_whs.is_nt_chk = 0
		AND oth_out_into_whs.form_typ_encd = "014" 
		
			<if test="fromDt1 != null and fromDt1 != ''">
				AND oth_out_into_whs.form_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND oth_out_into_whs.form_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and oth_out_into_whs_sub_tab.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and oth_out_into_whs_sub_tab.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and oth_out_into_whs.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>

		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		UNION ALL
		SELECT
		cannib_sngl.tran_in_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id
		invtyEncd,
		cannib_sngl_sub_tab.bat_num batNum,
		NULL bxQty,
		0 intoWhsQty,
		SUM(
		cannib_sngl_sub_tab.cannib_qty
		) intooutCannibQty,
		0 sellOutWhsQty,
		0 outCannibQty,
		NULL prdcDt,
		NULL baoZhQi,
		NULL invldtnDt
		FROM
		cannib_sngl
		LEFT JOIN cannib_sngl_sub_tab ON cannib_sngl.form_num =
		cannib_sngl_sub_tab.form_num

		<where>
				AND cannib_sngl.is_nt_chk = 0
			<if test="fromDt1 != null and fromDt1 != ''">
				AND cannib_sngl.form_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND cannib_sngl.form_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and cannib_sngl_sub_tab.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and cannib_sngl_sub_tab.invty_id 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and cannib_sngl.tran_in_whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>


		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		UNION ALL
		SELECT
		cannib_sngl.tran_out_whs_encd whsEncd,
		cannib_sngl_sub_tab.invty_id
		invtyEncd,
		cannib_sngl_sub_tab.bat_num batNum,
		NULL bxQty,
		0 intoWhsQty,
		0 intooutCannibQty,
		0 sellOutWhsQty,
		SUM(
		cannib_sngl_sub_tab.cannib_qty
		) outCannibQty,
		NULL prdcDt,
		NULL baoZhQi,
		NULL invldtnDt
		FROM
		cannib_sngl
		LEFT JOIN cannib_sngl_sub_tab ON cannib_sngl.form_num =
		cannib_sngl_sub_tab.form_num

		<where>
				AND cannib_sngl.is_nt_chk = 0
			<if test="fromDt1 != null and fromDt1 != ''">
				AND cannib_sngl.form_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND cannib_sngl.form_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and cannib_sngl_sub_tab.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and cannib_sngl_sub_tab.invty_id 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and cannib_sngl.tran_out_whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>

		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		UNION ALL
		SELECT
		sell_out_whs_sub.whs_encd whsEncd,
		sell_out_whs_sub.invty_encd
		invtyEncd,
		sell_out_whs_sub.bat_num batNum,
		NULL bxQty,
		0 intoWhsQty,
		0
		intooutCannibQty,
		SUM(sell_out_whs_sub.qty) sellOutWhsQty,
		0
		outCannibQty,
		NULL prdcDt,
		NULL baoZhQi,
		NULL invldtnDt
		FROM
		sell_out_whs
		LEFT JOIN sell_out_whs_sub ON sell_out_whs.out_whs_id =
		sell_out_whs_sub.out_whs_id
		<where>
				AND sell_out_whs.is_nt_chk = 0
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_out_whs.out_whs_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND sell_out_whs.out_whs_dt &lt;= #{fromDt2}
			</if>
			<if test="batNum != null and batNum.size() >0">
				and sell_out_whs_sub.bat_num 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="invtyEncd != null and invtyEncd.size() >0">
				and sell_out_whs_sub.invty_encd 	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and sell_out_whs_sub.whs_encd    	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
		</where>


		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		) a
		GROUP BY
		whsEncd,
		invtyEncd,
		batNum
		) s
		LEFT JOIN invty_tab ON (
		invty_tab.invty_encd = s.invtyEncd
		AND
		invty_tab.bat_Num = s.batNum
		AND invty_tab.whs_encd = s.whsEncd
		)
		LEFT
		JOIN invty_doc ON (
		invty_doc.invty_encd = s.invtyEncd
		)
		LEFT JOIN
		measr_corp_doc ON (
		invty_doc.measr_corp_id =
		measr_corp_doc.measr_corp_id
		)
		LEFT JOIN whs_doc ON (whs_doc.whs_encd =
		s.whsEncd)
		LEFT JOIN invty_cls ON (
		invty_doc.invty_cls_encd =
		invty_cls.invty_cls_encd

		)
		<where>
			<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
				AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>

		</where>
	</select>
	
    <select id="sellSnglXSTJ" resultType="Integer">
		SELECT * FROM KPView LEFT JOIN 
		(SELECT sow.sell_ordr_ind,sows.invty_encd,sows.bat_num,sum(sows.no_tax_amt) AS CBJE,sows.no_tax_uprc
		FROM sell_out_whs sow
		JOIN sell_out_whs_sub sows ON sow.out_whs_id = sows.out_whs_id 
		GROUP BY sow.sell_ordr_ind,sows.invty_encd,sows.bat_num) AS CB 
		ON kpview.sell_sngl_nums = cb.sell_ordr_ind AND kpview.invtyEncd=cb.invty_encd AND KPView.batnum = cb.bat_num 

	</select>
<select id="sellStatisticalCountList"
	resultType="com.px.mis.sell.entity.StatisticalCount">

	SELECT
	a.invtyEncd,
	a.depId,
	IFNULL( SUM( a.rtnChuQty ), 0 ) rtnChuQty,
	IFNULL( SUM( a.rtnNoTaxAmt ), 0 ) rtnNoTaxAmt,
	IFNULL( SUM(
	a.rtnPrcTaxSum ), 0 ) rtnPrcTaxSum,
	IFNULL( SUM( a.sellQty ), 0 )
	sellQty,
	IFNULL( SUM( a.sellNoTaxAmt ), 0 ) sellNoTaxAmt,
	IFNULL( SUM(
	a.sellPrcTaxSum ), 0 ) sellPrcTaxSum,
	IFNULL( SUM( a.KPQty ), 0 ) KPQty,
	IFNULL( SUM( a.KPAmt ), 0 ) KPAmt,
	IFNULL( SUM( a.KPAmtSum ), 0 )
	KPAmtSum,
	IFNULL( SUM( a.sellOutQty ), 0 ) sellOutQty,
	IFNULL( SUM(
	a.sellOutNoTaxAmt ), 0 ) sellOutNoTaxAmt,
	IFNULL( SUM(
	a.sellOutPrcTaxSum ), 0 ) sellOutPrcTaxSum,
	IFNULL( SUM( a.rtnChuQty ),
	0 ) + IFNULL( SUM( a.sellQty ), 0 ) rtnSellQty,
	IFNULL( SUM(
	a.rtnNoTaxAmt ), 0 ) + IFNULL( SUM( a.sellNoTaxAmt ), 0 )
	rtnSellNoTaxAmt,
	IFNULL( SUM( a.rtnPrcTaxSum ), 0 ) + IFNULL( SUM(
	a.sellPrcTaxSum ), 0 ) rtnSellPrcTaxSum,
	a.custId,
	a.depName,
	a.userName,
	a.accNum,
	a.custNm,
	a.custShtNm,
	invty_doc.spc_model spcModel,
	invty_doc.invty_nm invtyNm
	FROM
	( 
	SELECT
	sell_sngl_sub.bat_num
	batNum,
	sell_sngl_sub.invty_encd invtyEncd,
	sell_sngl_sub.whs_encd
	whsEncd,
	mis_user.dep_id depId,
	NULL rtnChuQty,
	NULL rtnNoTaxAmt,
	NULL
	rtnPrcTaxSum,
	SUM( sell_sngl_sub.qty ) sellQty,
	SUM(
	sell_sngl_sub.no_tax_amt ) sellNoTaxAmt,
	SUM( sell_sngl_sub.prc_tax_sum
	) sellPrcTaxSum,
	NULL KPQty,
	NULL KPAmt,
	NULL KPAmtSum,
	NULL sellOutQty,
	NULL sellOutNoTaxAmt,
	NULL sellOutPrcTaxSum,
	sell_sngl.cust_id custId,
	mis_user.dep_name depName,
	mis_user.user_name userName,
	sell_sngl.acc_num accNum,
	cust_doc.cust_nm custNm ,cust_doc.cust_sht_nm
	custShtNm

	FROM
	sell_sngl
	JOIN sell_sngl_sub ON sell_sngl.sell_sngl_id =
	sell_sngl_sub.sell_sngl_id
	LEFT JOIN mis_user ON mis_user.acc_num =
	sell_sngl.acc_num
	LEFT JOIN cust_doc ON cust_doc.cust_id =
	sell_sngl.cust_id
	
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_sngl.sell_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND sell_sngl.sell_sngl_dt &lt;= #{fromDt2}
			</if>
		</where>

	
	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId UNION ALL 
	SELECT
	entrs_agn_delv_sub.bat_num
	batNum,
	entrs_agn_delv_sub.invty_encd invtyEncd,
	entrs_agn_delv_sub.whs_encd whsEncd,
	mis_user.dep_id depId,
	NULL
	rtnChuQty,
	NULL rtnNoTaxAmt,
	NULL rtnPrcTaxSum,
	SUM(
	entrs_agn_delv_sub.qty ) sellQty,
	SUM( entrs_agn_delv_sub.no_tax_amt )
	sellNoTaxAmt,
	SUM( entrs_agn_delv_sub.prc_tax_sum ) sellPrcTaxSum,
	NULL
	KPQty,
	NULL KPAmt,
	NULL KPAmtSum,
	NULL sellOutQty,
	NULL sellOutNoTaxAmt,
	NULL sellOutPrcTaxSum,
	entrs_agn_delv.cust_id custId,
	mis_user.dep_name
	depName,
	mis_user.user_name userName,
	entrs_agn_delv.acc_num accNum,
	cust_doc.cust_nm custNm ,cust_doc.cust_sht_nm custShtNm

	FROM
	entrs_agn_delv
	JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id =
	entrs_agn_delv_sub.delv_sngl_id
	AND is_nt_rtn_good = 0
	LEFT JOIN mis_user
	ON mis_user.acc_num = entrs_agn_delv.acc_num
	LEFT JOIN cust_doc ON
	cust_doc.cust_id = entrs_agn_delv.cust_id
	
	
	<where>
		<if test="fromDt1 != null and fromDt1 != ''">
				AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
			</if>
		</where>
	
	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId UNION ALL 
	SELECT
	entrs_agn_delv_sub.bat_num
	batNum,
	entrs_agn_delv_sub.invty_encd invtyEncd,
	entrs_agn_delv_sub.whs_encd whsEncd,
	mis_user.dep_id depId,
	SUM(
	entrs_agn_delv_sub.qty ) rtnChuQty,
	SUM( entrs_agn_delv_sub.no_tax_amt )
	rtnNoTaxAmt,
	SUM( entrs_agn_delv_sub.prc_tax_sum ) rtnPrcTaxSum,
	NULL
	sellQty,
	NULL sellNoTaxAmt,
	NULL sellPrcTaxSum,
	NULL KPQty,
	NULL KPAmt,
	NULL KPAmtSum,
	NULL sellOutQty,
	NULL sellOutNoTaxAmt,
	NULL
	sellOutPrcTaxSum,
	entrs_agn_delv.cust_id custId,
	mis_user.dep_name
	depName,
	mis_user.user_name userName,
	entrs_agn_delv.acc_num accNum,
	cust_doc.cust_nm custNm ,cust_doc.cust_sht_nm custShtNm
	FROM
	entrs_agn_delv
	JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id =
	entrs_agn_delv_sub.delv_sngl_id
	AND is_nt_rtn_good = 1
	LEFT JOIN mis_user
	ON mis_user.acc_num = entrs_agn_delv.acc_num
	LEFT JOIN cust_doc ON
	cust_doc.cust_id = entrs_agn_delv.cust_id
	
	
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
			</if>
		</where>

	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId UNION ALL-- 退货
	SELECT
	rtn_goods_sub.bat_num batNum,
	rtn_goods_sub.invty_encd invtyEncd,
	rtn_goods_sub.whs_encd whsEncd,
	mis_user.dep_id depId,
	SUM( rtn_goods_sub.qty ) rtnChuQty,
	SUM(
	rtn_goods_sub.no_tax_amt ) rtnNoTaxAmt,
	SUM( rtn_goods_sub.prc_tax_sum )
	rtnPrcTaxSum,
	NULL sellQty,
	NULL sellNoTaxAmt,
	NULL sellPrcTaxSum,
	NULL
	KPQty,
	NULL KPAmt,
	NULL KPAmtSum,
	NULL sellOutQty,
	NULL sellOutNoTaxAmt,
	NULL sellOutPrcTaxSum,
	rtn_goods.cust_id custId,
	mis_user.dep_name
	depName,
	mis_user.user_name userName,
	rtn_goods.acc_num accNum,
	cust_doc.cust_nm custNm ,cust_doc.cust_sht_nm custShtNm
	FROM
	rtn_goods
	JOIN rtn_goods_sub ON rtn_goods.rtn_goods_id =
	rtn_goods_sub.rtn_goods_id
	LEFT JOIN mis_user ON mis_user.acc_num =
	rtn_goods.acc_num
	LEFT JOIN cust_doc ON cust_doc.cust_id =
	rtn_goods.cust_id
	
	
			<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND rtn_goods.rtn_goods_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND rtn_goods.rtn_goods_dt &lt;= #{fromDt2}
			</if>
		</where>

	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId
	UNION ALL
	SELECT
	sell_comn_inv_sub.bat_num batNum,
	sell_comn_inv_sub.invty_encd
	invtyEncd,
	sell_comn_inv_sub.whs_encd
	whsEncd,
	mis_user.dep_id depId,
	NULL
	rtnChuQty,
	NULL rtnNoTaxAmt,
	NULL
	rtnPrcTaxSum,
	NULL sellQty,
	NULL
	sellNoTaxAmt,
	NULL sellPrcTaxSum,
	SUM(
	sell_comn_inv_sub.qty ) KPQty,
	SUM(
	sell_comn_inv_sub.no_tax_amt )
	KPAmt,
	SUM( sell_comn_inv_sub.prc_tax_sum
	) KPAmtSum,
	NULL sellOutQty,
	NULL sellOutNoTaxAmt,
	NULL sellOutPrcTaxSum,
	sell_comn_inv.cust_id
	custId,
	mis_user.dep_name depName,
	mis_user.user_name userName,
	sell_comn_inv.acc_num accNum,
	cust_doc.cust_nm custNm
	,cust_doc.cust_sht_nm custShtNm
	FROM
	sell_comn_inv
	JOIN sell_comn_inv_sub
	ON sell_comn_inv.sell_inv_num =
	sell_comn_inv_sub.sell_inv_num
	LEFT JOIN
	mis_user ON mis_user.acc_num =
	sell_comn_inv.acc_num
	LEFT JOIN cust_doc
	ON cust_doc.cust_id =
	sell_comn_inv.cust_id

	<where>
		sell_comn_inv_sub.sell_sngl_nums in (
		select sell_sngl_id from
		sell_sngl
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_sngl.sell_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND sell_sngl.sell_sngl_dt &lt;= #{fromDt2}
			</if>
		</where>
		union all
		SELECT
		entrs_agn_delv.delv_sngl_id
		FROM
		entrs_agn_delv
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
			</if>
		</where>
		union all
		SELECT
		rtn_goods.rtn_goods_id
		FROM
		rtn_goods
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND rtn_goods.rtn_goods_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND rtn_goods.rtn_goods_dt &lt;= #{fromDt2}
			</if>
		</where>
		)
	</where>

	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId UNION ALL
	SELECT
	sell_out_whs_sub.bat_num batNum,
	sell_out_whs_sub.invty_encd invtyEncd,
	sell_out_whs_sub.whs_encd whsEncd,
	mis_user.dep_id depId,
	NULL rtnChuQty,
	NULL rtnNoTaxAmt,
	NULL rtnPrcTaxSum,
	NULL sellQty,
	NULL sellNoTaxAmt,
	NULL
	sellPrcTaxSum,
	NULL KPQty,
	NULL KPAmt,
	NULL KPAmtSum,
	SUM(
	sell_out_whs_sub.qty ) sellOutQty,
	SUM( sell_out_whs_sub.no_tax_amt )
	sellOutNoTaxAmt,
	SUM( sell_out_whs_sub.prc_tax_sum ) sellOutPrcTaxSum,
	sell_out_whs.cust_id custId,
	mis_user.dep_name depName,
	mis_user.user_name userName,
	sell_out_whs.acc_num accNum,
	cust_doc.cust_nm custNm ,cust_doc.cust_sht_nm custShtNm
	FROM
	sell_out_whs
	LEFT JOIN sell_out_whs_sub ON sell_out_whs.out_whs_id =
	sell_out_whs_sub.out_whs_id
	LEFT JOIN mis_user ON mis_user.acc_num =
	sell_out_whs.acc_num
	LEFT JOIN cust_doc ON cust_doc.cust_id =
	sell_out_whs.cust_id
	
	
			<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_out_whs.out_whs_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND sell_out_whs.out_whs_dt &lt;= #{fromDt2}
			</if>
		</where>
	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId
	) a
	LEFT JOIN invty_doc ON a.invtyEncd =
	invty_doc.invty_encd


	<where>
		<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
			AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND a.invtyEncd	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
		</if>
			<if test="batNum != null and batNum.size() >0">
				and a.batNum 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="whsEncd != null and whsEncd.size() >0">
				and a.whsEncd  	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="depId != null and depId.size() >0">
				and a.depId    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="accNum != null and accNum.size() >0">
				and a.accNum    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
			<if test="custId != null and custId.size() >0">
				and a.custId   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
			</if>
	</where>
	GROUP BY
		invtyEncd,
		custId
	<if test="index != null  and  num != null ">
		LIMIT #{index},#{num}
	</if>
</select>


<select id="sellStatisticalCountCount" resultType="Integer">
	SELECT

	Count(*)

	FROM (
	SELECT
	a.invtyEncd,
	a.depId,
	IFNULL( SUM( a.rtnChuQty
	), 0 ) rtnChuQty,
	IFNULL( SUM( a.rtnNoTaxAmt ), 0 ) rtnNoTaxAmt,
	IFNULL(
	SUM(
	a.rtnPrcTaxSum ), 0 ) rtnPrcTaxSum,
	IFNULL( SUM( a.sellQty ), 0 )
	sellQty,
	IFNULL( SUM( a.sellNoTaxAmt ), 0 ) sellNoTaxAmt,
	IFNULL( SUM(
	a.sellPrcTaxSum ), 0 ) sellPrcTaxSum,
	IFNULL( SUM( a.KPQty ), 0 ) KPQty,
	IFNULL( SUM( a.KPAmt ), 0 ) KPAmt,
	IFNULL( SUM( a.KPAmtSum ), 0 )
	KPAmtSum,
	IFNULL( SUM( a.sellOutQty ), 0 ) sellOutQty,
	IFNULL( SUM(
	a.sellOutNoTaxAmt ), 0 ) sellOutNoTaxAmt,
	IFNULL( SUM(
	a.sellOutPrcTaxSum ), 0 ) sellOutPrcTaxSum,
	IFNULL( SUM( a.rtnChuQty ),
	0 ) + IFNULL( SUM( a.sellQty ), 0 ) rtnSellQty,
	IFNULL( SUM(
	a.rtnNoTaxAmt ), 0 ) + IFNULL( SUM( a.sellNoTaxAmt ), 0 )
	rtnSellNoTaxAmt,
	IFNULL( SUM( a.rtnPrcTaxSum ), 0 ) + IFNULL( SUM(
	a.sellPrcTaxSum ), 0 ) rtnSellPrcTaxSum,
	a.custId,
	a.depName,
	a.userName,
	a.accNum,
	a.custNm,
	a.custShtNm,
	invty_doc.spc_model spcModel,
	invty_doc.invty_nm invtyNm
	FROM
	(
	SELECT
	sell_sngl_sub.bat_num
	batNum,
	sell_sngl_sub.invty_encd invtyEncd,
	sell_sngl_sub.whs_encd
	whsEncd,
	mis_user.dep_id depId,
	NULL rtnChuQty,
	NULL rtnNoTaxAmt,
	NULL
	rtnPrcTaxSum,
	SUM( sell_sngl_sub.qty ) sellQty,
	SUM(
	sell_sngl_sub.no_tax_amt ) sellNoTaxAmt,
	SUM(
	sell_sngl_sub.prc_tax_sum
	)
	sellPrcTaxSum,
	NULL KPQty,
	NULL KPAmt,
	NULL
	KPAmtSum,
	NULL sellOutQty,
	NULL
	sellOutNoTaxAmt,
	NULL sellOutPrcTaxSum,
	sell_sngl.cust_id custId,
	mis_user.dep_name depName,
	mis_user.user_name
	userName,
	sell_sngl.acc_num
	accNum,
	cust_doc.cust_nm custNm
	,cust_doc.cust_sht_nm
	custShtNm

	FROM
	sell_sngl
	JOIN sell_sngl_sub ON
	sell_sngl.sell_sngl_id =
	sell_sngl_sub.sell_sngl_id
	LEFT JOIN mis_user ON
	mis_user.acc_num =
	sell_sngl.acc_num
	LEFT JOIN cust_doc ON
	cust_doc.cust_id =
	sell_sngl.cust_id

	<where>
		<if test="fromDt1 != null and fromDt1 != ''">
			AND sell_sngl.sell_sngl_dt &gt;= #{fromDt1}
		</if>
		<if test="fromDt2 != null and fromDt2 != ''">
			AND sell_sngl.sell_sngl_dt &lt;= #{fromDt2}
		</if>
	</where>


	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId UNION ALL
	SELECT
	entrs_agn_delv_sub.bat_num
	batNum,
	entrs_agn_delv_sub.invty_encd
	invtyEncd,
	entrs_agn_delv_sub.whs_encd whsEncd,
	mis_user.dep_id depId,
	NULL
	rtnChuQty,
	NULL rtnNoTaxAmt,
	NULL rtnPrcTaxSum,
	SUM(
	entrs_agn_delv_sub.qty ) sellQty,
	SUM( entrs_agn_delv_sub.no_tax_amt )
	sellNoTaxAmt,
	SUM( entrs_agn_delv_sub.prc_tax_sum ) sellPrcTaxSum,
	NULL
	KPQty,
	NULL KPAmt,
	NULL KPAmtSum,
	NULL sellOutQty,
	NULL sellOutNoTaxAmt,
	NULL sellOutPrcTaxSum,
	entrs_agn_delv.cust_id custId,
	mis_user.dep_name
	depName,
	mis_user.user_name userName,
	entrs_agn_delv.acc_num accNum,
	cust_doc.cust_nm custNm ,cust_doc.cust_sht_nm custShtNm

	FROM
	entrs_agn_delv
	JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id =
	entrs_agn_delv_sub.delv_sngl_id
	AND is_nt_rtn_good = 0
	LEFT JOIN mis_user
	ON mis_user.acc_num = entrs_agn_delv.acc_num
	LEFT JOIN cust_doc ON
	cust_doc.cust_id = entrs_agn_delv.cust_id


	<where>
		<if test="fromDt1 != null and fromDt1 != ''">
			AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
		</if>
		<if test="fromDt2 != null and fromDt2 != ''">
			AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
		</if>
	</where>

	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId UNION ALL
	SELECT
	entrs_agn_delv_sub.bat_num
	batNum,
	entrs_agn_delv_sub.invty_encd
	invtyEncd,
	entrs_agn_delv_sub.whs_encd whsEncd,
	mis_user.dep_id depId,
	SUM(
	entrs_agn_delv_sub.qty ) rtnChuQty,
	SUM(
	entrs_agn_delv_sub.no_tax_amt )
	rtnNoTaxAmt,
	SUM(
	entrs_agn_delv_sub.prc_tax_sum ) rtnPrcTaxSum,
	NULL
	sellQty,
	NULL
	sellNoTaxAmt,
	NULL sellPrcTaxSum,
	NULL KPQty,
	NULL KPAmt,
	NULL KPAmtSum,
	NULL sellOutQty,
	NULL sellOutNoTaxAmt,
	NULL
	sellOutPrcTaxSum,
	entrs_agn_delv.cust_id custId,
	mis_user.dep_name
	depName,
	mis_user.user_name userName,
	entrs_agn_delv.acc_num accNum,
	cust_doc.cust_nm custNm ,cust_doc.cust_sht_nm custShtNm
	FROM
	entrs_agn_delv
	JOIN entrs_agn_delv_sub ON entrs_agn_delv.delv_sngl_id =
	entrs_agn_delv_sub.delv_sngl_id
	AND is_nt_rtn_good = 1
	LEFT JOIN mis_user
	ON mis_user.acc_num = entrs_agn_delv.acc_num
	LEFT JOIN cust_doc ON
	cust_doc.cust_id = entrs_agn_delv.cust_id


	<where>
		<if test="fromDt1 != null and fromDt1 != ''">
			AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
		</if>
		<if test="fromDt2 != null and fromDt2 != ''">
			AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
		</if>
	</where>

	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId UNION ALL-- 退货
	SELECT
	rtn_goods_sub.bat_num batNum,
	rtn_goods_sub.invty_encd invtyEncd,
	rtn_goods_sub.whs_encd whsEncd,
	mis_user.dep_id depId,
	SUM(
	rtn_goods_sub.qty ) rtnChuQty,
	SUM(
	rtn_goods_sub.no_tax_amt )
	rtnNoTaxAmt,
	SUM( rtn_goods_sub.prc_tax_sum )
	rtnPrcTaxSum,
	NULL sellQty,
	NULL sellNoTaxAmt,
	NULL sellPrcTaxSum,
	NULL
	KPQty,
	NULL KPAmt,
	NULL
	KPAmtSum,
	NULL sellOutQty,
	NULL sellOutNoTaxAmt,
	NULL sellOutPrcTaxSum,
	rtn_goods.cust_id custId,
	mis_user.dep_name
	depName,
	mis_user.user_name
	userName,
	rtn_goods.acc_num accNum,
	cust_doc.cust_nm custNm
	,cust_doc.cust_sht_nm custShtNm
	FROM
	rtn_goods
	JOIN rtn_goods_sub ON
	rtn_goods.rtn_goods_id =
	rtn_goods_sub.rtn_goods_id
	LEFT JOIN mis_user ON
	mis_user.acc_num =
	rtn_goods.acc_num
	LEFT JOIN cust_doc ON
	cust_doc.cust_id =
	rtn_goods.cust_id


	<where>
		<if test="fromDt1 != null and fromDt1 != ''">
			AND rtn_goods.rtn_goods_dt &gt;= #{fromDt1}
		</if>
		<if test="fromDt2 != null and fromDt2 != ''">
			AND rtn_goods.rtn_goods_dt &lt;= #{fromDt2}
		</if>
	</where>

	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId
	UNION ALL
	SELECT
	sell_comn_inv_sub.bat_num batNum,
	sell_comn_inv_sub.invty_encd
	invtyEncd,
	sell_comn_inv_sub.whs_encd
	whsEncd,
	mis_user.dep_id depId,
	NULL
	rtnChuQty,
	NULL rtnNoTaxAmt,
	NULL
	rtnPrcTaxSum,
	NULL sellQty,
	NULL
	sellNoTaxAmt,
	NULL sellPrcTaxSum,
	SUM(
	sell_comn_inv_sub.qty ) KPQty,
	SUM(
	sell_comn_inv_sub.no_tax_amt )
	KPAmt,
	SUM( sell_comn_inv_sub.prc_tax_sum
	) KPAmtSum,
	NULL sellOutQty,
	NULL sellOutNoTaxAmt,
	NULL sellOutPrcTaxSum,
	sell_comn_inv.cust_id
	custId,
	mis_user.dep_name depName,
	mis_user.user_name userName,
	sell_comn_inv.acc_num accNum,
	cust_doc.cust_nm custNm
	,cust_doc.cust_sht_nm custShtNm
	FROM
	sell_comn_inv
	JOIN sell_comn_inv_sub
	ON sell_comn_inv.sell_inv_num =
	sell_comn_inv_sub.sell_inv_num
	LEFT JOIN
	mis_user ON mis_user.acc_num =
	sell_comn_inv.acc_num
	LEFT JOIN cust_doc
	ON cust_doc.cust_id =
	sell_comn_inv.cust_id

	<where>
		sell_comn_inv_sub.sell_sngl_nums in (
		select sell_sngl_id from
		sell_sngl
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND sell_sngl.sell_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND sell_sngl.sell_sngl_dt &lt;= #{fromDt2}
			</if>
		</where>
		union all
		SELECT
		entrs_agn_delv.delv_sngl_id
		FROM
		entrs_agn_delv
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND entrs_agn_delv.delv_sngl_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND entrs_agn_delv.delv_sngl_dt &lt;= #{fromDt2}
			</if>
		</where>
		union all
		SELECT
		rtn_goods.rtn_goods_id
		FROM
		rtn_goods
		<where>
			<if test="fromDt1 != null and fromDt1 != ''">
				AND rtn_goods.rtn_goods_dt &gt;= #{fromDt1}
			</if>
			<if test="fromDt2 != null and fromDt2 != ''">
				AND rtn_goods.rtn_goods_dt &lt;= #{fromDt2}
			</if>
		</where>
		)
	</where>

	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId UNION ALL
	SELECT
	sell_out_whs_sub.bat_num batNum,
	sell_out_whs_sub.invty_encd invtyEncd,
	sell_out_whs_sub.whs_encd whsEncd,
	mis_user.dep_id depId,
	NULL rtnChuQty,
	NULL rtnNoTaxAmt,
	NULL rtnPrcTaxSum,
	NULL sellQty,
	NULL sellNoTaxAmt,
	NULL
	sellPrcTaxSum,
	NULL KPQty,
	NULL KPAmt,
	NULL KPAmtSum,
	SUM(
	sell_out_whs_sub.qty ) sellOutQty,
	SUM( sell_out_whs_sub.no_tax_amt )
	sellOutNoTaxAmt,
	SUM( sell_out_whs_sub.prc_tax_sum ) sellOutPrcTaxSum,
	sell_out_whs.cust_id custId,
	mis_user.dep_name depName,
	mis_user.user_name userName,
	sell_out_whs.acc_num accNum,
	cust_doc.cust_nm custNm ,cust_doc.cust_sht_nm custShtNm
	FROM
	sell_out_whs
	LEFT JOIN sell_out_whs_sub ON sell_out_whs.out_whs_id =
	sell_out_whs_sub.out_whs_id
	LEFT JOIN mis_user ON mis_user.acc_num =
	sell_out_whs.acc_num
	LEFT JOIN cust_doc ON cust_doc.cust_id =
	sell_out_whs.cust_id


	<where>
		<if test="fromDt1 != null and fromDt1 != ''">
			AND sell_out_whs.out_whs_dt &gt;= #{fromDt1}
		</if>
		<if test="fromDt2 != null and fromDt2 != ''">
			AND sell_out_whs.out_whs_dt &lt;= #{fromDt2}
		</if>
	</where>
	GROUP BY
	batNum,
	invtyEncd,
	whsEncd,
	custId
	) a
	LEFT JOIN invty_doc ON
	a.invtyEncd =
	invty_doc.invty_encd


	<where>
		<if test="invtyClsEncd != null and invtyClsEncd.size() >0 ">
			AND invty_doc.invty_cls_encd	  in  <foreach collection="invtyClsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
		</if>
		<if test="invtyEncd != null and invtyEncd.size() >0">
			AND a.invtyEncd	   in  <foreach collection="invtyEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
		</if>
		<if test="batNum != null and batNum.size() >0">
			and a.batNum 	  in <foreach collection="batNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
		</if>
		<if test="whsEncd != null and whsEncd.size() >0">
			and a.whsEncd 	   	   in  <foreach collection="whsEncd" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
		</if>
		<if test="depId != null and depId.size() >0">
			and a.depId    in  <foreach collection="depId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
		</if>
		<if test="accNum != null and accNum.size() >0">
			and a.accNum    in  <foreach collection="accNum" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
		</if>
		<if test="custId != null and custId.size() >0">
			and a.custId   in  <foreach collection="custId" index="index" item="item" separator="," open="(" close=")"> #{item} </foreach>
		</if>
	</where>
	GROUP BY
	invtyEncd,
	custId
	) asda
</select>
</mapper>